;
; Campaign script - DLV Americas
;

script

;==========================================================================
;=         I          Garrison Script by derdrakken                       =
;==========================================================================

;------------------- faction check and initializing -----------------------


declare_counter spain_start
declare_counter aztecs_start
declare_counter mayans_start
declare_counter apachean_start
declare_counter chichimeca_start
declare_counter tlaxcalans_start
declare_counter tarascans_start
declare_counter england_start
declare_counter france_start


set_counter spain_start 0
set_counter aztecs_start 0
set_counter mayans_start 0
set_counter apachean_start 0
set_counter chichimeca_start 0
set_counter tlaxcalans_start 0
set_counter tarascans_start 0
set_counter england_start 0
set_counter france_start 0

declare_counter is_player_faction

set_counter is_player_faction 0

monitor_event Transgression TransgressionName = TC_INSTIGATE_SIEGE
and FactionIsLocal
and not TargetFactionIsLocal
	set_counter is_player_faction 1
end_monitor

monitor_event Transgression TransgressionName = TC_INSTIGATE_SIEGE
and not FactionIsLocal
	set_counter is_player_faction 0
end_monitor

monitor_event FactionTurnStart FactionIsLocal
	if I_LocalFaction spain
		set_counter spain_start 1
		historic_event introduction
	end_if
	if I_LocalFaction tarascans
		set_counter tarascans_start 1
		historic_event introduction
	end_if
	if I_LocalFaction aztecs
		set_counter aztecs_start 1
		historic_event introduction
	end_if
	if I_LocalFaction mayans
		set_counter mayans_start 1
		historic_event introduction
	end_if
	if I_LocalFaction apachean
		set_counter apachean_start 1
		historic_event introduction
	end_if
	if I_LocalFaction chichimeca
		set_counter chichimeca_start 1
		historic_event introduction
	end_if
	if I_LocalFaction tlaxcalans
		set_counter tlaxcalans_start 1
		historic_event introduction
	end_if
	if I_LocalFaction england
		set_counter england_start 1
		historic_event introduction
	end_if
	if I_LocalFaction france
		set_counter france_start 1
		historic_event introduction
	end_if
terminate_monitor
end_monitor

;/// spain /// Havana /// Cuba /// Capital 

declare_counter Havana_siege
declare_counter Havana_spawn

monitor_conditions not I_SettlementUnderSiege Havana
	set_counter Havana_siege 0
	set_counter Havana_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Havana
and I_CompareCounter Havana_siege = 0
if I_SettlementOwner Havana = spain
and I_CompareCounter spain_start 0
	create_unit Havana, Musketeers, num 2, exp 0, arm 0, wep 0
	create_unit Havana, Crossbow Militia, num 3, exp 0, arm 0, wep 0
	create_unit Havana, Sword and Buckler Men, num 3, exp 0, arm 0, wep 0
	create_unit Havana, Pike Militia, num 4, exp 0, arm 0, wep 0
	set_counter Havana_spawn 1
end_if
set_counter Havana_siege 1
end_monitor
monitor_conditions I_SettlementUnderSiege Havana
and I_CompareCounter Havana_spawn = 1
	if I_SettlementOwner Havana = spain
	spawn_army 
	faction spain
	character	random_name, general, age 28, x 194, y 66, direction E	       
			unit		Conquistadores	exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers	exp 0 armour 0 weapon_lvl 0
			unit		Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			unit		Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			unit		Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men	exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men	exp 0 armour 0 weapon_lvl 0
			unit		Pike Militia	exp 0 armour 0 weapon_lvl 0
			unit		Pike Militia	exp 0 armour 0 weapon_lvl 0
			unit		Pike Militia	exp 0 armour 0 weapon_lvl 0
			unit		Pike Militia	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Havana_spawn 0
	end_if		
end_monitor

;/// spain /// Vera_Cruz /// Vera Cruz /// Borderlands

declare_counter Vera_Cruz_siege
declare_counter Vera_Cruz_spawn

monitor_conditions not I_SettlementUnderSiege Vera_Cruz
	set_counter Vera_Cruz_siege 0
	set_counter Vera_Cruz_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Vera_Cruz
and I_CompareCounter Vera_Cruz_siege = 0
	if I_SettlementOwner Vera_Cruz = spain
	and I_CompareCounter spain_start 0
		create_unit Vera_Cruz, Musketeers, 					num 1, exp 0, arm 0, wep 0
		create_unit Vera_Cruz, Crossbow Militia, 			num 1, exp 0, arm 0, wep 0
		create_unit Vera_Cruz, Sword and Buckler Men, 		num 1, exp 0, arm 0, wep 0
		create_unit Vera_Cruz, Dismounted Conquistadores, 	num 3, exp 0, arm 0, wep 0
		create_unit Vera_Cruz, Conquistadores, 				num 1, exp 0, arm 0, wep 0
		create_unit Vera_Cruz, Pike Militia, 				num 2, exp 0, arm 0, wep 0
		
		set_counter Vera_Cruz_spawn 1
		add_money spain 10000
	end_if
	
	set_counter Vera_Cruz_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Vera_Cruz
and I_CompareCounter Vera_Cruz_spawn = 1
	if I_SettlementOwner Vera_Cruz = spain
		spawn_army 
			faction spain
			character	random_name, general, age 29, x 106, y 30
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Pike Militia				exp 0 armour 0 weapon_lvl 0
			unit		Pike Militia				exp 0 armour 0 weapon_lvl 0
		end
	
		set_counter Vera_Cruz_spawn 0
	end_if		
end_monitor

;/// spain /// Coatzalcoalcos /// Coatzalcoalcos /// Borderlands

declare_counter Coatzalcoalcos_siege
declare_counter Coatzalcoalcos_spawn

monitor_conditions not I_SettlementUnderSiege Coatzalcoalcos
	set_counter Coatzalcoalcos_siege 0
	set_counter Coatzalcoalcos_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Coatzalcoalcos
and I_CompareCounter Coatzalcoalcos_siege = 0
	if I_SettlementOwner Coatzalcoalcos = spain
	and I_CompareCounter spain_start 0
		create_unit Coatzalcoalcos, Musketeers, num 1, exp 0, arm 0, wep 0
		create_unit Coatzalcoalcos, Crossbow Militia, num 1, exp 0, arm 0, wep 0
		create_unit Coatzalcoalcos, Sword and Buckler Men, num 1, exp 0, arm 0, wep 0
		create_unit Coatzalcoalcos, Dismounted Conquistadores, num 3, exp 0, arm 0, wep 0
		create_unit Coatzalcoalcos, Conquistadores, num 1, exp 0, arm 0, wep 0
		create_unit Coatzalcoalcos, Pike Militia, num 2, exp 0, arm 0, wep 0
		
		set_counter Coatzalcoalcos_spawn 1
	end_if

	set_counter Coatzalcoalcos_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Coatzalcoalcos
and I_CompareCounter Coatzalcoalcos_spawn = 1
	if I_SettlementOwner Coatzalcoalcos = spain
 		add_money spain 10000

		spawn_army 
			faction spain
			character	random_name, general, age 29, x 112, y 26
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
		end
	
		set_counter Coatzalcoalcos_spawn 0
	end_if		
end_monitor

;---------------------------------------------------------------
;/// aztecs /// Tenochtitlan - Tenochtitlan /// Tenochtitlan_r - Tenochtitlan Region /// Capital

declare_counter Tenochtitlan_siege
declare_counter Tenochtitlan_spawn

monitor_conditions not I_SettlementUnderSiege Tenochtitlan
	set_counter Tenochtitlan_siege 0
	set_counter Tenochtitlan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tenochtitlan
and I_CompareCounter Tenochtitlan_siege = 0
	if I_SettlementOwner Tenochtitlan = aztecs
	and I_CompareCounter aztecs_start 0
		create_unit Tenochtitlan, Aztec Warriors, num 3, exp 0, arm 0, wep 0
		create_unit Tenochtitlan, Aztec Spearmen, num 4, exp 0, arm 0, wep 0
		create_unit Tenochtitlan, Aztec Spear Throwers, num 4, exp 0, arm 0, wep 0
		create_unit Tenochtitlan, Aztec Archers, num 5, exp 0, arm 0, wep 0
		set_counter Tenochtitlan_spawn 1
	end_if
	
	add_money aztecs 7000
	set_counter Tenochtitlan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tenochtitlan
and I_CompareCounter Tenochtitlan_spawn = 1
	if I_SettlementOwner Tenochtitlan = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 83, y 35, direction N	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tenochtitlan_spawn 0
	end_if		
end_monitor

;/// aztecs /// Tuxpan - Tochpan /// Tuxpan_r - Tochpan Region /// Homelands

declare_counter Tuxpan_siege
declare_counter Tuxpan_spawn
monitor_conditions not I_SettlementUnderSiege Tuxpan
set_counter Tuxpan_siege 0
set_counter Tuxpan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tuxpan
and I_CompareCounter Tuxpan_siege = 0
if I_SettlementOwner Tuxpan = aztecs
and I_CompareCounter aztecs_start 0
and I_CompareCounter is_player_faction 1
	create_unit Tuxpan, Aztec Warriors, num 2, exp 0, arm 0, wep 0
	create_unit Tuxpan, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
	create_unit Tuxpan, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
	create_unit Tuxpan, Aztec Archers, num 4, exp 0, arm 0, wep 0
	set_counter Tuxpan_spawn 1
end_if
set_counter Tuxpan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tuxpan
and I_CompareCounter Tuxpan_spawn = 1
	if I_SettlementOwner Tuxpan = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 88, y 48, direction W	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tuxpan_spawn 0
	end_if		
end_monitor

;/// aztecs /// Tula - Tollan /// Tula_r - Tollan Region /// Homelands

declare_counter Tula_siege
declare_counter Tula_spawn
monitor_conditions not I_SettlementUnderSiege Tula
set_counter Tula_siege 0
set_counter Tula_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tula
and I_CompareCounter Tula_siege = 0
	if I_SettlementOwner Tula = aztecs
	and I_CompareCounter aztecs_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Tula, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Tula, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Tula, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Tula, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Tula_spawn 1
	end_if
	
	set_counter Tula_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tula
and I_CompareCounter Tula_spawn = 1
	if I_SettlementOwner Tula = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 79, y 43, direction NW	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tula_spawn 0
	end_if		
end_monitor

;/// aztecs /// Toluca - Tolocan /// Toluca_r - Tolocan Region /// Homelands

declare_counter Toluca_siege
declare_counter Toluca_spawn
monitor_conditions not I_SettlementUnderSiege Toluca
set_counter Toluca_siege 0
set_counter Toluca_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Toluca
and I_CompareCounter Toluca_siege = 0
	if I_SettlementOwner Toluca = aztecs
	and I_CompareCounter aztecs_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Toluca, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Toluca, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Toluca, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Toluca, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Toluca_spawn 1
	end_if
	
	set_counter Toluca_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Toluca
and I_CompareCounter Toluca_spawn = 1
	if I_SettlementOwner Toluca = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 77, y 34, direction NW	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Toluca_spawn 0
	end_if		
end_monitor

;/// aztecs /// Huaxtepec - Huaxtepec /// Huaxtepec_r - Huaxtepec Region /// Homelands

declare_counter Huaxtepec_siege
declare_counter Huaxtepec_spawn
monitor_conditions not I_SettlementUnderSiege Huaxtepec
set_counter Huaxtepec_siege 0
set_counter Huaxtepec_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Huaxtepec
and I_CompareCounter Huaxtepec_siege = 0
	if I_SettlementOwner Huaxtepec = aztecs
	and I_CompareCounter aztecs_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Huaxtepec, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Huaxtepec, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Huaxtepec, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Huaxtepec, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Huaxtepec_spawn 1
	end_if
	
	set_counter Huaxtepec_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Huaxtepec
and I_CompareCounter Huaxtepec_spawn = 1
	if I_SettlementOwner Huaxtepec = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 83, y 27, direction W	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Huaxtepec_spawn 0
	end_if		
end_monitor

;/// aztecs /// Tixtla - Tixtla /// Tixta_r - Tixtla Region /// Homelands

declare_counter Tixtla_siege
declare_counter Tixtla_spawn
monitor_conditions not I_SettlementUnderSiege Tixtla
set_counter Tixtla_siege 0
set_counter Tixtla_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tixtla
and I_CompareCounter Tixtla_siege = 0
	if I_SettlementOwner Tixtla = aztecs
	and I_CompareCounter aztecs_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Tixtla, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Tixtla, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Tixtla, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Tixtla, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Tixtla_spawn 1
	end_if
	
	set_counter Tixtla_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tixtla
and I_CompareCounter Tixtla_spawn = 1
	if I_SettlementOwner Tixtla = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 80, y 19, direction W	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tixtla_spawn 0
	end_if		
end_monitor

;/// aztecs /// Tehuacan - Tehuacan /// Tehuacan_r - Tehuacan Region /// Homelands

declare_counter Tehuacan_siege
declare_counter Tehuacan_spawn

monitor_conditions not I_SettlementUnderSiege Tehuacan
	set_counter Tehuacan_siege 0
	set_counter Tehuacan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tehuacan 
and I_CompareCounter Tehuacan_siege = 0
	if I_SettlementOwner Tehuacan = aztecs
	and I_CompareCounter is_player_faction 1
		create_unit Tehuacan, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Tehuacan, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Tehuacan, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Tehuacan, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Tehuacan_spawn 1
	end_if
	set_counter Tehuacan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tehuacan
and I_CompareCounter Tehuacan_spawn = 1
	if I_SettlementOwner Tehuacan = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 96, y 25, direction S	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tehuacan_spawn 0
	end_if		
end_monitor

;/// aztecs /// Danipaguache - Taniquiecache /// Danipaguache_r - Taniquiecache Region /// Homelands

declare_counter Danipaguache_siege
declare_counter Danipaguache_spawn
monitor_conditions not I_SettlementUnderSiege Danipaguache
set_counter Danipaguache_siege 0
set_counter Danipaguache_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Danipaguache
and I_CompareCounter Danipaguache_siege = 0
	if I_SettlementOwner Danipaguache = aztecs
	and I_CompareCounter aztecs_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Danipaguache, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Danipaguache, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Danipaguache, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Danipaguache, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Danipaguache_spawn 1
	end_if
	
	set_counter Danipaguache_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Danipaguache
and I_CompareCounter Danipaguache_spawn = 1
	if I_SettlementOwner Danipaguache = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 97, y 23, direction N	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Danipaguache_spawn 0
	end_if		
end_monitor

;/// aztecs /// Mitla - Mictlan /// Mitla_r - Mictlan Region /// Homelands

declare_counter Mitla_siege
declare_counter Mitla_spawn
monitor_conditions not I_SettlementUnderSiege Mitla
set_counter Mitla_siege 0
set_counter Mitla_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Mitla
and I_CompareCounter Mitla_siege = 0
	if I_SettlementOwner Mitla = aztecs
	and I_CompareCounter aztecs_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Mitla, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Mitla, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Mitla, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Mitla, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Mitla_spawn 1
	end_if
	
	set_counter Mitla_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Mitla
and I_CompareCounter Mitla_spawn = 1
	if I_SettlementOwner Mitla = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 99, y 16, direction W	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Mitla_spawn 0
	end_if		
end_monitor

;/// aztecs /// Tehuantepec - Tecuantepec /// Tehuantepec_r - Tecuantepec Region /// Homelands

declare_counter Tehuantepec_siege
declare_counter Tehuantepec_spawn
monitor_conditions not I_SettlementUnderSiege Tehuantepec
set_counter Tehuantepec_siege 0
set_counter Tehuantepec_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tehuantepec
and I_CompareCounter Tehuantepec_siege = 0
	if I_SettlementOwner Tehuantepec = aztecs
	and I_CompareCounter aztecs_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Tehuantepec, Aztec Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Tehuantepec, Aztec Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Tehuantepec, Aztec Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Tehuantepec, Aztec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Tehuantepec_spawn 1
	end_if
	
	set_counter Tehuantepec_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tehuantepec
and I_CompareCounter Tehuantepec_spawn = 1
	if I_SettlementOwner Tehuantepec = aztecs
	spawn_army 
	faction aztecs
	character	random_name, general, age 28, x 105, y 13, direction W	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Aztec Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	
	set_counter Tehuantepec_spawn 0
	
	add_money aztecs 5000
	end_if		
end_monitor

;/// tlaxcalans /// Tlaxcala - Tlaxcallan /// Tlaxcala_r - Tlaxcallan Region /// Capital

declare_counter Tlaxcala_siege
declare_counter Tlaxcala_spawn

monitor_conditions not I_SettlementUnderSiege Tlaxcala
	set_counter Tlaxcala_siege 0
	set_counter Tlaxcala_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tlaxcala
and I_CompareCounter Tlaxcala_siege = 0
	if I_SettlementOwner Tlaxcala = tlaxcalans
	and I_CompareCounter tlaxcalans_start 0
		create_unit Tlaxcala, Tlaxcalan Warriors, num 3, exp 0, arm 0, wep 0
		create_unit Tlaxcala, Tlaxcalan Spearmen, num 4, exp 0, arm 0, wep 0
		create_unit Tlaxcala, Tlaxcalan Spear Throwers, num 4, exp 0, arm 0, wep 0
		create_unit Tlaxcala, Tlaxcalan Archers, num 5, exp 0, arm 0, wep 0
		set_counter Tlaxcala_spawn 1
	end_if
	set_counter Tlaxcala_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tlaxcala
and I_CompareCounter Tlaxcala_spawn = 1
	if I_SettlementOwner Tlaxcala = tlaxcalans
	spawn_army 
	faction tlaxcalans
	character	random_name, general, age 28, x 96, y 33, direction W	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tlaxcala_spawn 0
	end_if		
end_monitor

;/// tlaxcalans /// Cholula - Cholollan /// Cholula_r - Cholollan Region /// Homelands

declare_counter Cholula_siege
declare_counter Cholula_spawn
monitor_conditions not I_SettlementUnderSiege Cholula
set_counter Cholula_siege 0
set_counter Cholula_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Cholula
and I_CompareCounter Cholula_siege = 0
if I_SettlementOwner Cholula = tlaxcalans
and I_CompareCounter tlaxcalans_start 0
	create_unit Cholula, Tlaxcalan Warriors, num 2, exp 0, arm 0, wep 0
	create_unit Cholula, Tlaxcalan Spearmen, num 3, exp 0, arm 0, wep 0
	create_unit Cholula, Tlaxcalan Spear Throwers, num 3, exp 0, arm 0, wep 0
	create_unit Cholula, Tlaxcalan Archers, num 4, exp 0, arm 0, wep 0
	set_counter Cholula_spawn 1
end_if
set_counter Cholula_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Cholula
and I_CompareCounter Cholula_spawn = 1
	if I_SettlementOwner Cholula = tlaxcalans
	and I_CompareCounter is_player_faction 1
	spawn_army 
	faction tlaxcalans
	character	random_name, general, age 28, x 90, y 27, direction SW	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tlaxcalan Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Cholula_spawn 0
	end_if		
end_monitor

;/// tarascans /// Apatzignan - Apatzingan /// Apatzignan_r - Apatzingan Region /// Capital

declare_counter Apatzignan_siege
declare_counter Apatzignan_spawn
monitor_conditions not I_SettlementUnderSiege Apatzignan
set_counter Apatzignan_siege 0
set_counter Apatzignan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Apatzignan
and I_CompareCounter Apatzignan_siege = 0
if I_SettlementOwner Apatzignan = tarascans
and I_CompareCounter tarascans_start 0
	create_unit Apatzignan, Tarascan Warriors, num 3, exp 0, arm 0, wep 0
	create_unit Apatzignan, Tarascan Spearmen, num 4, exp 0, arm 0, wep 0
	create_unit Apatzignan, Tarascan Spear Throwers, num 4, exp 0, arm 0, wep 0
	create_unit Apatzignan, Tarascan Archers, num 5, exp 0, arm 0, wep 0
	set_counter Apatzignan_spawn 1
end_if
set_counter Apatzignan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Apatzignan
and I_CompareCounter Apatzignan_spawn = 1
	if I_SettlementOwner Apatzignan = tarascans
	spawn_army 
	faction tarascans
	character	random_name, general, age 28, x 52, y 38, direction W	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Apatzignan_spawn 0
	end_if		
end_monitor

;/// tarascans /// Zacapu - Zacapu /// Zacapu_r - Zacapu Region /// Homelands

declare_counter Zacapu_siege
declare_counter Zacapu_spawn
monitor_conditions not I_SettlementUnderSiege Zacapu
set_counter Zacapu_siege 0
set_counter Zacapu_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Zacapu
and I_CompareCounter Zacapu_siege = 0
	if I_SettlementOwner Zacapu = tarascans
	and I_CompareCounter tarascans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Zacapu, Tarascan Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Zacapu, Tarascan Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Zacapu, Tarascan Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Zacapu, Tarascan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Zacapu_spawn 1
	end_if
	
	set_counter Zacapu_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Zacapu
and I_CompareCounter Zacapu_spawn = 1
	if I_SettlementOwner Zacapu = tarascans
	spawn_army 
	faction tarascans
	character	random_name, general, age 28, x 58, y 45, direction N	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Zacapu_spawn 0
	end_if		
end_monitor

;/// tarascans ///  Ocotlan - Ocotlan /// Ocotlan_r - Ocotlan Region /// Homelands

declare_counter Ocotlan_siege
declare_counter Ocotlan_spawn
monitor_conditions not I_SettlementUnderSiege Ocotlan
set_counter Ocotlan_siege 0
set_counter Ocotlan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Ocotlan
and I_CompareCounter Ocotlan_siege = 0
	if I_SettlementOwner Ocotlan = tarascans
	and I_CompareCounter tarascans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Ocotlan, Tarascan Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Ocotlan, Tarascan Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Ocotlan, Tarascan Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Ocotlan, Tarascan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Ocotlan_spawn 1
	end_if
	
	set_counter Ocotlan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Ocotlan
and I_CompareCounter Ocotlan_spawn = 1
	if I_SettlementOwner Ocotlan = tarascans
	spawn_army 
	faction tarascans
	character	random_name, general, age 28, x 54, y 50, direction NW	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Ocotlan_spawn 0
	end_if		
end_monitor

;/// tarascans ///  Ahuacatlan - Ahuacatlan /// Ahuacatlan_r - Ahuacatlan Region /// Homelands

declare_counter Ahuacatlan_siege
declare_counter Ahuacatlan_spawn
monitor_conditions not I_SettlementUnderSiege Ahuacatlan
set_counter Ahuacatlan_siege 0
set_counter Ahuacatlan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Ahuacatlan
and I_CompareCounter Ahuacatlan_siege = 0
	if I_SettlementOwner Ahuacatlan = tarascans
	and I_CompareCounter tarascans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Ahuacatlan, Tarascan Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Ahuacatlan, Tarascan Spearmen, num 2, exp 0, arm 0, wep 0
		create_unit Ahuacatlan, Tarascan Spear Throwers, num 2, exp 0, arm 0, wep 0
		create_unit Ahuacatlan, Tarascan Archers, num 3, exp 0, arm 0, wep 0
		set_counter Ahuacatlan_spawn 1
	end_if
	
	set_counter Ahuacatlan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Ahuacatlan
and I_CompareCounter Ahuacatlan_spawn = 1
	if I_SettlementOwner Ahuacatlan = tarascans
	spawn_army 
	faction tarascans
	character	random_name, general, age 28, x 40, y 58, direction NW	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Ahuacatlan_spawn 0
	end_if		
end_monitor

;/// tarascans ///  Tecoman - Tecoman /// Tecoman_r - Tecoman Region /// Homelands

declare_counter Tecoman_siege
declare_counter Tecoman_spawn
monitor_conditions not I_SettlementUnderSiege Tecoman
set_counter Tecoman_siege 0
set_counter Tecoman_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tecoman
and I_CompareCounter Tecoman_siege = 0
	if I_SettlementOwner Tecoman = tarascans
	and I_CompareCounter tarascans_start 0
		create_unit Tecoman, Tarascan Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Tecoman, Tarascan Spearmen, num 3, exp 0, arm 0, wep 0
		create_unit Tecoman, Tarascan Spear Throwers, num 3, exp 0, arm 0, wep 0
		create_unit Tecoman, Tarascan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Tecoman_spawn 1
	end_if
	
	set_counter Tecoman_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tecoman
and I_CompareCounter Tecoman_spawn = 1
	if I_SettlementOwner Tecoman = tarascans
	and I_CompareCounter is_player_faction 1
	spawn_army 
	faction tarascans
	character	random_name, general, age 28, x 45, y 39, direction N	       
			unit		Eagle Warriors	exp 1 armour 0 weapon_lvl 0
			unit		Jaguar Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spearmen	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Tarascan Spear Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tecoman_spawn 0
	end_if		
end_monitor

;/// chichimeca ///  Zacatecas - Zacatecas /// Zacatecas_r - Zacatecas Region /// Homelands

declare_counter Zacatecas_siege
declare_counter Zacatecas_spawn

monitor_conditions not I_SettlementUnderSiege Zacatecas
	set_counter Zacatecas_siege 0
	set_counter Zacatecas_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Zacatecas
and I_CompareCounter Zacatecas_siege = 0

	if I_SettlementOwner Zacatecas = chichimeca
	and I_CompareCounter chichimeca_start 0
		create_unit Zacatecas, Guachichil Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Zacatecas, Chichimec Lancers, num 3, exp 0, arm 0, wep 0
		create_unit Zacatecas, Zacatecos Raiders, num 3, exp 0, arm 0, wep 0
		create_unit Zacatecas, Chichimec Archers, num 4, exp 0, arm 0, wep 0
		
		set_counter Zacatecas_spawn 1
	end_if
	
	set_counter Zacatecas_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Zacatecas
and I_CompareCounter Zacatecas_spawn = 1
	if I_SettlementOwner Zacatecas = chichimeca
		spawn_army 
		faction chichimeca
		character	random_name, general, age 28, x 52, y 72, direction N	       
				unit		Chichimec Shamen	exp 1 armour 0 weapon_lvl 0
				unit		Chichimec Shamen	exp 0 armour 0 weapon_lvl 0
				unit		Guachichil Warriors	exp 0 armour 0 weapon_lvl 0
				unit		Guachichil Warriors	exp 0 armour 0 weapon_lvl 0
				unit		Guachichil Warriors	exp 0 armour 0 weapon_lvl 0
				unit		Chichimec Lancers	exp 0 armour 0 weapon_lvl 0
				unit		Chichimec Lancers	exp 0 armour 0 weapon_lvl 0
				unit		Chichimec Lancers	exp 0 armour 0 weapon_lvl 0
				unit		Chichimec Archers	exp 0 armour 0 weapon_lvl 0
				unit		Chichimec Archers	exp 0 armour 0 weapon_lvl 0
				unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
				unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
				unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
				unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
		end
	
		set_counter Zacatecas_spawn 0
	end_if		
end_monitor

;/// chichimeca ///  Colotan - Colotan /// Colotan_r - Colotan Region /// Homelands

declare_counter Colotan_siege
declare_counter Colotan_spawn
monitor_conditions not I_SettlementUnderSiege Colotan
set_counter Colotan_siege 0
set_counter Colotan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Colotan
and I_CompareCounter Colotan_siege = 0
	if I_SettlementOwner Colotan = chichimeca
	and I_CompareCounter chichimeca_start 0
		create_unit Colotan, Guachichil Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Colotan, Chichimec Lancers, num 3, exp 0, arm 0, wep 0
		create_unit Colotan, Zacatecos Raiders, num 3, exp 0, arm 0, wep 0
		create_unit Colotan, Chichimec Archers, num 4, exp 0, arm 0, wep 0
		set_counter Colotan_spawn 1
	end_if
	set_counter Colotan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Colotan
and I_CompareCounter Colotan_spawn = 1
	if I_SettlementOwner Colotan = chichimeca

	spawn_army 
	faction chichimeca
	character	random_name, general, age 28, x 50, y 65, direction N	       
			unit		Chichimec Shamen	exp 1 armour 0 weapon_lvl 0
			unit		Chichimec Shamen	exp 0 armour 0 weapon_lvl 0
			unit		Guachichil Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Guachichil Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Guachichil Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Chichimec Lancers	exp 0 armour 0 weapon_lvl 0
			unit		Chichimec Lancers	exp 0 armour 0 weapon_lvl 0
			unit		Chichimec Lancers	exp 0 armour 0 weapon_lvl 0
			unit		Chichimec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Chichimec Archers	exp 0 armour 0 weapon_lvl 0
			unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
			unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
			unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
			unit		Zacatecos Raiders	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Colotan_spawn 0
	end_if		
end_monitor

;/// mayans ///  Chichen_Itza - Chichen Itza /// Chichen_Itza_r - Chichen Itza Region /// Capital

declare_counter Chichen_Itza_siege
declare_counter Chichen_Itza_spawn
monitor_conditions not I_SettlementUnderSiege Chichen_Itza
set_counter Chichen_Itza_siege 0
set_counter Chichen_Itza_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Chichen_Itza
and I_CompareCounter Chichen_Itza_siege = 0
	if I_SettlementOwner Chichen_Itza = mayans
	and I_CompareCounter mayans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Chichen_Itza, Nacom Warriors, num 3, exp 0, arm 0, wep 0
		create_unit Chichen_Itza, Mayan Javelinmen, num 4, exp 0, arm 0, wep 0
		create_unit Chichen_Itza, Batab Militia, num 4, exp 0, arm 0, wep 0
		create_unit Chichen_Itza, Mayan Archers, num 5, exp 0, arm 0, wep 0
		set_counter Chichen_Itza_spawn 1
	end_if
	
	set_counter Chichen_Itza_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Chichen_Itza
and I_CompareCounter Chichen_Itza_spawn = 1
	if I_SettlementOwner Chichen_Itza = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 160, y 47, direction SE	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Chichen_Itza_spawn 0
	end_if		
end_monitor

;/// mayans ///  Potochan - Potochan /// Potochan_r - Potochan Region /// Homelands

declare_counter Potochan_siege
declare_counter Potochan_spawn
monitor_conditions not I_SettlementUnderSiege Potochan
set_counter Potochan_siege 0
set_counter Potochan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Potochan
and I_CompareCounter Potochan_siege = 0
	if I_SettlementOwner Potochan = mayans
	and I_CompareCounter mayans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Potochan, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Potochan, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Potochan, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Potochan, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Potochan_spawn 1
	end_if
	
	set_counter Potochan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Potochan
and I_CompareCounter Potochan_spawn = 1
	if I_SettlementOwner Potochan = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 130, y 25, direction SE	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Potochan_spawn 0
	end_if		
end_monitor

;/// mayans ///  Xicalango - Xicallanco /// Xicalango_r - Xicallanco Region /// Homelands

declare_counter Xicalango_siege
declare_counter Xicalango_spawn
monitor_conditions not I_SettlementUnderSiege Xicalango
set_counter Xicalango_siege 0
set_counter Xicalango_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Xicalango
and I_CompareCounter Xicalango_siege = 0
	if I_SettlementOwner Xicalango = mayans
	and I_CompareCounter mayans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Xicalango, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Xicalango, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Xicalango, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Xicalango, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Xicalango_spawn 1
	end_if
	
	set_counter Xicalango_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Xicalango
and I_CompareCounter Xicalango_spawn = 1
	if I_SettlementOwner Xicalango = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 138, y 30, direction SE	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Xicalango_spawn 0
	end_if		
end_monitor

;/// mayans ///  Canpech - Canpech /// Canpech_r - Canpech Region /// Homelands

declare_counter Canpech_siege
declare_counter Canpech_spawn
monitor_conditions not I_SettlementUnderSiege Canpech
set_counter Canpech_siege 0
set_counter Canpech_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Canpech
and I_CompareCounter Canpech_siege = 0
	if I_SettlementOwner Canpech = mayans
	and I_CompareCounter mayans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Canpech, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Canpech, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Canpech, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Canpech, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Canpech_spawn 1
	end_if
	
	set_counter Canpech_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Canpech
and I_CompareCounter Canpech_spawn = 1
	if I_SettlementOwner Canpech = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 146, y 42, direction SE	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Canpech_spawn 0
	end_if		
end_monitor

;/// mayans ///  Uxmal - Uxmal /// Uxmal_r - Uxmal Region /// Homelands

declare_counter Uxmal_siege
declare_counter Uxmal_spawn
monitor_conditions not I_SettlementUnderSiege Uxmal
set_counter Uxmal_siege 0
set_counter Uxmal_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Uxmal
and I_CompareCounter Uxmal_siege = 0
	if I_SettlementOwner Uxmal = mayans
	and I_CompareCounter mayans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Uxmal, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Uxmal, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Uxmal, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Uxmal, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Uxmal_spawn 1
	end_if
	
	set_counter Uxmal_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Uxmal
and I_CompareCounter Uxmal_spawn = 1
	if I_SettlementOwner Uxmal = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 151, y 43, direction SE	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Uxmal_spawn 0
	end_if		
end_monitor

;/// mayans ///  Chetumal - Chetumal /// Chetumal_r - Chetumal Region /// Homelands

declare_counter Chetumal_siege
declare_counter Chetumal_spawn
monitor_conditions not I_SettlementUnderSiege Chetumal
set_counter Chetumal_siege 0
set_counter Chetumal_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Chetumal
and I_CompareCounter Chetumal_siege = 0
	if I_SettlementOwner Chetumal = mayans
	and I_CompareCounter mayans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Chetumal, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Chetumal, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Chetumal, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Chetumal, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Chetumal_spawn 1
	end_if
	
	set_counter Chetumal_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Chetumal
and I_CompareCounter Chetumal_spawn = 1
	if I_SettlementOwner Chetumal = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 155, y 31, direction W	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Chetumal_spawn 0
	end_if		
end_monitor

;/// mayans ///  Althun_Ha - Altun Ha /// Althun_Ha_r - Altun Ha Region /// Homelands

declare_counter Althun_Ha_siege
declare_counter Althun_Ha_spawn
monitor_conditions not I_SettlementUnderSiege Althun_Ha
set_counter Althun_Ha_siege 0
set_counter Althun_Ha_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Althun_Ha
and I_CompareCounter Althun_Ha_siege = 0
	if I_SettlementOwner Althun_Ha = mayans
	and I_CompareCounter mayans_start 0
	and I_CompareCounter is_player_faction 1
		create_unit Althun_Ha, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Althun_Ha, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Althun_Ha, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Althun_Ha, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Althun_Ha_spawn 1
	end_if
	
	set_counter Althun_Ha_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Althun_Ha
and I_CompareCounter Althun_Ha_spawn = 1
	if I_SettlementOwner Althun_Ha = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 155, y 24, direction W	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Althun_Ha_spawn 0
	end_if		
end_monitor

;/// mayans ///  Tikal - Tikal /// Tikal_r - Tikal Region /// Homelands

declare_counter Tikal_siege
declare_counter Tikal_spawn
monitor_conditions not I_SettlementUnderSiege Tikal
set_counter Tikal_siege 0
set_counter Tikal_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Tikal
and I_CompareCounter Tikal_siege = 0
	if I_SettlementOwner Tikal = mayans
	and I_CompareCounter mayans_start 0
		create_unit Tikal, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Tikal, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Tikal, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Tikal, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Tikal_spawn 1
	end_if
	
	set_counter Tikal_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Tikal
and I_CompareCounter Tikal_spawn = 1
	if I_SettlementOwner Tikal = mayans
	spawn_army 
	faction mayans
	character	random_name, general, age 28, x 147, y 26, direction N	       
			unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
			unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
			unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Tikal_spawn 0
	end_if		
end_monitor

;/// mayans ///  Yaxchilan - Yaxchilan /// Yaxchilan_r - Yaxchilan Region /// Homelands

declare_counter Yaxchilan_siege
declare_counter Yaxchilan_spawn
monitor_conditions not I_SettlementUnderSiege Yaxchilan
set_counter Yaxchilan_siege 0
set_counter Yaxchilan_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Yaxchilan
and I_CompareCounter Yaxchilan_siege = 0
	if I_SettlementOwner Yaxchilan = mayans
	and I_CompareCounter mayans_start 0
		create_unit Yaxchilan, Nacom Warriors, num 2, exp 0, arm 0, wep 0
		create_unit Yaxchilan, Mayan Javelinmen, num 3, exp 0, arm 0, wep 0
		create_unit Yaxchilan, Batab Militia, num 3, exp 0, arm 0, wep 0
		create_unit Yaxchilan, Mayan Archers, num 4, exp 0, arm 0, wep 0
		set_counter Yaxchilan_spawn 1
	end_if
	
	set_counter Yaxchilan_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Yaxchilan
and I_CompareCounter Yaxchilan_spawn = 1
	if I_SettlementOwner Yaxchilan = mayans
	and I_CompareCounter is_player_faction 1
		spawn_army 
		faction mayans
		character	random_name, general, age 28, x 140, y 23, direction N	       
				unit		Priests Of Kukulcan	exp 1 armour 0 weapon_lvl 0
				unit		Priests Of Kukulcan	exp 0 armour 0 weapon_lvl 0
				unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
				unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
				unit		Nacom Warriors	exp 0 armour 0 weapon_lvl 0
				unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
				unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
				unit		Mayan Javelinmen	exp 0 armour 0 weapon_lvl 0
				unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
				unit		Mayan Archers	exp 0 armour 0 weapon_lvl 0
				unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
				unit		Batab Militia	exp 0 armour 0 weapon_lvl 0
				unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
				unit		Hornet Throwers	exp 0 armour 0 weapon_lvl 0
		end
	set_counter Yaxchilan_spawn 0
	end_if		
end_monitor

;/// apachean ///  Apache_Camp - Apache Camp /// Apache_Camp_r - Apache Lands Region /// Homelands

declare_counter Apache_Camp_siege
declare_counter Apache_Camp_spawn
monitor_conditions not I_SettlementUnderSiege Apache_Camp
set_counter Apache_Camp_siege 0
set_counter Apache_Camp_spawn 0
end_monitor

monitor_conditions I_SettlementUnderSiege Apache_Camp
and I_CompareCounter Apache_Camp_siege = 0
if I_SettlementOwner Apache_Camp = apachean
and I_CompareCounter apachean_start 0
	create_unit Apache_Camp, Apachean Brave, num 2, exp 0, arm 0, wep 0
	create_unit Apache_Camp, Apachean Scouts, num 3, exp 0, arm 0, wep 0
	create_unit Apache_Camp, Dog Soldiers, num 3, exp 0, arm 0, wep 0
	create_unit Apache_Camp, Rabbit Boys, num 4, exp 0, arm 0, wep 0
	set_counter Apache_Camp_spawn 1
end_if
set_counter Apache_Camp_siege 1
end_monitor

monitor_conditions I_SettlementUnderSiege Apache_Camp
and I_CompareCounter Apache_Camp_spawn = 1
	if I_SettlementOwner Apache_Camp = apachean
	spawn_army 
	faction apachean
	character	random_name, general, age 28, x 42, y 138, direction W	       
			unit		Apachean Brave	exp 1 armour 0 weapon_lvl 0
			unit		Apachean Brave	exp 0 armour 0 weapon_lvl 0
			unit		Medicine Men	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
	end
	spawn_army 
	faction apachean
	character	random_name, general, age 30, x 53, y 140, direction NE	       
			unit		Apachean Brave	exp 1 armour 0 weapon_lvl 0
			unit		Apachean Brave	exp 0 armour 0 weapon_lvl 0
			unit		Medicine Men	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Brave	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
	end
	spawn_army 
	faction apachean
	character	random_name, general, age 24, x 52, y 133, direction SE	       
			unit		Apachean Brave	exp 1 armour 0 weapon_lvl 0
			unit		Apachean Brave	exp 0 armour 0 weapon_lvl 0
			unit		Medicine Men	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Apachean Scouts	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Dog Soldiers	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
			unit		Rabbit Boys	exp 0 armour 0 weapon_lvl 0
	end
	set_counter Apache_Camp_spawn 0
	end_if		
end_monitor
;---------------------------------------------------------------
;======================================================================
;        II	  Upkeep Fieldcost: Generals & Captains 
;======================================================================	

	monitor_event CharacterTurnEnd FactionType spain
	and I_LocalFaction spain
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money spain, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType spain
	and I_LocalFaction spain
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money spain, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType spain
	and I_LocalFaction spain
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money spain, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType aztecs
	and I_LocalFaction aztecs
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and InEnemyLands

	console_command add_money aztecs, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType aztecs
	and I_LocalFaction aztecs
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and InEnemyLands

	console_command add_money aztecs, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType aztecs
	and I_LocalFaction aztecs
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money aztecs, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType mayans
	and I_LocalFaction mayans
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and InEnemyLands

	console_command add_money mayans, -100

	end_monitor
	
	monitor_event CharacterTurnEnd FactionType mayans
	and I_LocalFaction mayans
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and InEnemyLands

	console_command add_money mayans, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType mayans
	and I_LocalFaction mayans
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money mayans, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType apachean
	and I_LocalFaction apachean
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and InEnemyLands

	console_command add_money apachean, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType apachean
	and I_LocalFaction apachean
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and InEnemyLands

	console_command add_money apachean, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType apachean
	and I_LocalFaction apachean
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money apachean, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType chichimeca
	and I_LocalFaction chichimeca
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money chichimeca, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType chichimeca
	and I_LocalFaction chichimeca
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money chichimeca, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType chichimeca
	and I_LocalFaction chichimeca
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money chichimeca, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType tlaxcalans
	and I_LocalFaction tlaxcalans
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money tlaxcalans, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType tlaxcalans
	and I_LocalFaction tlaxcalans
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money tlaxcalans, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType tlaxcalans
	and I_LocalFaction tlaxcalans
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money tlaxcalans, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType tarascans
	and I_LocalFaction tarascans
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money tarascans, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType tarascans
	and I_LocalFaction tarascans
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money tarascans, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType tarascans
	and I_LocalFaction tarascans
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money tarascans, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType england
	and I_LocalFaction england
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money england, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType england
	and I_LocalFaction england
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money england, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType england
	and I_LocalFaction england
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money england, -50

	end_monitor

	monitor_event CharacterTurnEnd FactionType france
	and I_LocalFaction france
	and not EndedInSettlement
	and not IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money france, -100

	end_monitor

	monitor_event CharacterTurnEnd FactionType france
	and I_LocalFaction france
	and not EndedInSettlement
	and IsBesieging
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant	
	and InEnemyLands

	console_command add_money france, -500

	end_monitor

	monitor_event CharacterTurnEnd FactionType france
	and I_LocalFaction france
	and not EndedInSettlement
	and not AgentType = admiral
	and not AgentType = spy
	and not AgentType = diplomat
	and not AgentType = assassin
	and not AgentType = priest
	and not AgentType = princess
	and not AgentType = merchant
	and not AtSea
	and not InEnemyLands

	console_command add_money france, -200

	end_monitor

;==========================================================================
;           III             Dynamic Events
;==========================================================================
;--------------------------------Market---------------------------------

declare_counter trading
set_counter trading  0


monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= corn_exchange
and RandomPercent < 20
and I_CompareCounter trading > 0
	add_events
		event historic tokus_normal_event_market 
		date 0
	end_add_events
set_counter trading  0
set_event_counter tokus_negative_event_market 0
set_event_counter tokus_positive_event_market 0
end_monitor 

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= corn_exchange
and RandomPercent < 10
and I_CompareCounter trading < 1
	add_events
		event historic tokus_negative_event_market 
		date 0
	end_add_events
set_counter trading  1
set_event_counter tokus_negative_event_market 1
set_event_counter tokus_positive_event_market 0
end_monitor 

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= corn_exchange
and RandomPercent < 10
and I_CompareCounter trading < 1
	add_events
		event historic tokus_positive_event_market
		date 0
	end_add_events
set_counter trading  1
set_event_counter tokus_positive_event_market 1
set_event_counter tokus_negative_event_market 0
end_monitor

;------------------------------------Harbour--------------------------

declare_counter harbour
set_counter harbour 0

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= port
and RandomPercent < 20
and I_CompareCounter harbour > 0
	add_events
		event historic tokus_normal_event_harbour 
		date 0
	end_add_events
set_counter harbour  0
set_event_counter tokus_negative_event_harbour 0
set_event_counter tokus_positive_event_harbour 0
end_monitor  

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= port
and RandomPercent < 10
and I_CompareCounter harbour < 1
	add_events
		event historic tokus_negative_event_harbour 
		date 0
	end_add_events
set_counter harbour  1
set_event_counter tokus_negative_event_harbour 1
set_event_counter tokus_positive_event_harbour 0
end_monitor 

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= port
and RandomPercent < 10
and I_CompareCounter harbour < 1
	add_events
		event historic tokus_positive_event_harbour
		date 0
	end_add_events
set_counter harbour  1
set_event_counter tokus_positive_event_harbour 1
set_event_counter tokus_negative_event_harbour 0
end_monitor

;------------------------------------mines-------------------------

declare_counter mining
set_counter mining  0

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= mines
and RandomPercent < 20
and I_CompareCounter mining > 0
	add_events
		event historic tokus_normal_event_mines
		date 0
	end_add_events
set_counter mining  0
set_event_counter tokus_negative_event_mines 0
set_event_counter tokus_positive_event_mines 0
end_monitor

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= mines
and RandomPercent < 10
and I_CompareCounter mining < 1
	add_events
		event historic tokus_negative_event_mines
		date 0
	end_add_events
set_counter mining  1
set_event_counter tokus_negative_event_mines 1
set_event_counter tokus_positive_event_mines 0
end_monitor

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= mines
and RandomPercent < 10
and I_CompareCounter mining < 1
	add_events
		event historic tokus_positive_event_mines
		date 0
	end_add_events
set_counter mining  1
set_event_counter tokus_positive_event_mines 1
set_event_counter tokus_negative_event_mines 0
end_monitor

;------------------------------------city roads----------------------

declare_counter traveling
set_counter traveling  0

monitor_event FactionTurnEnd FactionIsLocal
and I_CompareCounter traveling > 0
set_event_counter tokus_negative_event_roads 0
set_counter traveling  0
end_monitor

monitor_event FactionTurnEnd FactionIsLocal
and FactionBuildingExists >= roads
and RandomPercent < 10
and I_CompareCounter traveling < 1
	add_events
		event historic tokus_negative_event_roads
		date 0
	end_add_events
set_counter traveling  1
set_event_counter tokus_negative_event_roads 1
end_monitor
;------------------Becomes King  thanks to Pnutmaster, Lord Finga-----------




        declare_counter spain_becomesking
        declare_counter aztecs_becomesking
        declare_counter mayans_becomesking
        declare_counter apachean_becomesking
        declare_counter chichimeca_becomesking
        declare_counter tlaxcalans_becomesking
	declare_counter tarascans_becomesking
	declare_counter england_becomesking
	declare_counter france_becomesking
        

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType spain
		add_events
			event historic tokus_spain_king_event
			date 0
		end_add_events
	end_monitor

	
	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType aztecs
		add_events
			event historic tokus_aztecs_king_event
			date 0
		end_add_events
	end_monitor

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType mayans
		add_events
			event historic tokus_mayans_king_event
			date 0
		end_add_events
	end_monitor

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType apachean
		add_events
			event historic tokus_apachean_king_event
			date 0
		end_add_events
	end_monitor

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType chichimeca
		add_events
			event historic tokus_chichimeca_king_event
			date 0
		end_add_events
	end_monitor

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType tlaxcalans
		add_events
			event historic tokus_tlaxcalans_king_event
			date 0
		end_add_events
	end_monitor

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType tarascans
		add_events
			event historic tokus_tarascans_king_event
			date 0
		end_add_events
	end_monitor

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType england
		add_events
			event historic tokus_england_king_event
			date 0
		end_add_events
	end_monitor

	monitor_event BecomesFactionLeader not FactionIsLocal
		and FactionType france
		add_events
			event historic tokus_france_king_event
			date 0
		end_add_events
	end_monitor

	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	;; Princess Comes Of Age - Messages ;; Pnutmaster
	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	monitor_event CharacterComesOfAge FactionIsLocal
		and AgentType = princess
		add_events
			event historic tokus_princess_local
		date 0
	end_add_events
	end_monitor

	monitor_event CharacterComesOfAge not FactionIsLocal
		and AgentType = princess
		and FactionType spain
		add_events
			event historic tokus_princess_spain
		date 0
	end_add_events
	end_monitor

	monitor_event CharacterComesOfAge not FactionIsLocal
		and AgentType = princess
		and FactionType england
		add_events
			event historic tokus_princess_england
		date 0
	end_add_events
	end_monitor

	monitor_event CharacterComesOfAge not FactionIsLocal
		and AgentType = princess
		and FactionType france
		add_events
			event historic tokus_princess_france
		date 0
	end_add_events
	end_monitor











;---------------------------------------------------------------
	;show the whole map
	restrict_strat_radar false

	declare_counter prestige_points
	declare_counter warpath_called
	declare_counter apachean_settlements_captured
	declare_counter apachean_battles_won
	declare_counter apachean_missile_recruited
	declare_counter apachean_infantry_recruited
	declare_counter apachean_cavalry_killed
	declare_counter apachean_gunpowder_killed
	declare_counter chichimeca_cavalry_killed
	declare_counter chichimeca_gunpowder_killed
	
;------------------- FACTION LEADER MODELS -------------------;	

	monitor_event BecomesFactionLeader FactionType spain
		change_battle_model spain leader Spanish_Viceroy
	end_monitor
	
	monitor_event BecomesFactionLeader FactionType aztecs
		change_battle_model aztecs leader Mesoamerican_King
	end_monitor
	
	monitor_event BecomesFactionLeader FactionType mayans
		change_battle_model mayans leader Mesoamerican_King
	end_monitor
	
	monitor_event BecomesFactionLeader FactionType tlaxcalans
		change_battle_model tlaxcalans leader Mesoamerican_King
	end_monitor
	
	monitor_event BecomesFactionLeader FactionType tarascans
		change_battle_model tarascans leader Mesoamerican_King
	end_monitor
	
	monitor_event BecomesFactionLeader FactionType chichimeca
		change_battle_model chichimeca leader Indian_General
	end_monitor
	
;;;;;;;;;;;;;;;;;;;;;;;; Warpath Event Message ;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	
	monitor_event FactionTurnStart FactionType spain
		and I_LocalFaction spain
 		and I_TurnNumber = 1

	 	historic_event use_mercenaries factions { spain, }

		terminate_monitor
	end_monitor
		
;;;;;;;;;;;;;;;;;;;;;;;; Warpath Event Message ;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	
	monitor_event CrusadeCalled
	
		set_counter warpath_called 1
	
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType apachean
		and I_LocalFaction apachean
 		and I_TurnNumber = 1

 		if I_CompareCounter warpath_called = 0
 			historic_event time_for_warpath factions { apachean, }
	 	end_if

		terminate_monitor
	end_monitor
		
;;;;;;;;;;;;;;;;;;;;;;;; Mercenary Pool Events ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;Faction standing events for native mercenary recruitment

; -	Spain must be allied with native factions to recruit mercenaries from those factions
; -	Events tracked through the script will keep track of standing and prohibit or allow access to mercenary pools
; -	Spain will have separate mercenary pools setup for each region where special mercenaries are available


;;; Spain is allied with Aztecs
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_aztecs == 0
		and DiplomaticStanceFromFaction aztecs = Allied
		
		add_events
			event	counter	spain_allied_aztecs
	   		date	0
	 	end_add_events

	end_monitor

;;; Spain is allied with Tarascans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_tarascans == 0
		and DiplomaticStanceFromFaction tarascans = Allied
		
		add_events
			event	counter	spain_allied_tarascans
	   		date	0
	 	end_add_events

	end_monitor

;;; Spain is allied with Tlaxcalans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_tlaxcalans == 0
		and DiplomaticStanceFromFaction tlaxcalans = Allied
		
		add_events
			event	counter	spain_allied_tlaxcalans
	   		date	0
	 	end_add_events

	end_monitor

;;; Spain is allied with Chichimeca
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_chichimeca == 0
		and DiplomaticStanceFromFaction chichimeca = Allied
		
		add_events
			event	counter	spain_allied_chichimeca
	   		date	0
	 	end_add_events

	end_monitor

;;; Spain is allied with Mayans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_mayans == 0
		and DiplomaticStanceFromFaction mayans = Allied
		
		add_events
			event	counter	spain_allied_mayans
	   		date	0
	 	end_add_events

	end_monitor

;;; Spain is allied with Apacheans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_apachean == 0
		and DiplomaticStanceFromFaction apachean = Allied
		
		add_events
			event	counter	spain_allied_apachean
	   		date	0
	 	end_add_events

	end_monitor

;;; Spain no longer allied with Aztecs
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_aztecs == 1
		and DiplomaticStanceFromFaction aztecs > Allied
		
		set_event_counter spain_allied_aztecs 0

	end_monitor

;;; Spain no longer allied with Tarascans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_tarascans == 1
		and DiplomaticStanceFromFaction tarascans > Allied
		
		set_event_counter spain_allied_tarascans 0

	end_monitor

;;; Spain no longer allied with Tlaxcalans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_tlaxcalans == 1
		and DiplomaticStanceFromFaction tlaxcalans > Allied
		
		set_event_counter spain_allied_tlaxcalans 0

	end_monitor

;;; Spain no longer allied with Chichimeca
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_chichimeca == 1
		and DiplomaticStanceFromFaction chichimeca > Allied
		
		set_event_counter spain_allied_chichimeca 0

	end_monitor

;;; Spain no longer allied with Mayans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_mayans == 1
		and DiplomaticStanceFromFaction mayans > Allied
		
		set_event_counter spain_allied_mayans 0

	end_monitor

;;; Spain no longer allied with Apacheans
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter spain_allied_apachean == 1
		and DiplomaticStanceFromFaction apachean > Allied
		
		set_event_counter spain_allied_apachean 0

	end_monitor


;;;;;;;;;;;;;;;;;;;;;;;; Native Tech Tree Events ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; chichi_horses_1	Defeat an army with cavalry 2 times
	monitor_event FactionTurnStart FactionType chichimeca
		and I_CompareCounter chichimeca_cavalry_killed > 1

		add_events
			event	counter	chichi_horses_1
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction chichimeca
	 		historic_event chichimeca_cavalry_1 factions { chichimeca, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; chichi_guns_1		Defeat an army with gunpowder 2 times
	monitor_event FactionTurnStart FactionType chichimeca
		and I_CompareCounter chichimeca_gunpowder_killed > 1

		add_events
			event	counter	chichi_guns_1
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction chichimeca
	 		historic_event chichimeca_guns_1 factions { chichimeca, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_hunters_1	Recruit 10 missile units & Capture 3 settlements
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_missile_recruited > 9
		and I_CompareCounter apachean_settlements_captured > 2

		add_events
			event	counter	 
	   		date	0
	 	end_add_events

	 	if I_LocalFaction apachean
	 		historic_event apachean_hunters_1 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_hunters_2	Recruit 20 missile units & Capture 6 settlements
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_missile_recruited > 19
		and I_CompareCounter apachean_settlements_captured > 5

		add_events
			event	counter	indian_hunters_2
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_hunters_2 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_raiders_1	10 infantry units & Capture 6 settlements
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_infantry_recruited > 9
		and I_CompareCounter apachean_settlements_captured > 5

		add_events
			event	counter	indian_raiders_1
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_raiders_1 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_raiders_2	Recruit 15 infantry units & Capture 8 settlements
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_infantry_recruited > 14
		and I_CompareCounter apachean_settlements_captured > 7

		add_events
			event	counter	indian_raiders_2
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_raiders_2 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_horses_1	Defeat an army with cavalry 2 times
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_cavalry_killed > 1

		add_events
			event	counter	indian_horses_1
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_cavalry_1 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_horses_2	Defeat an army with cavalry 3 times
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_cavalry_killed > 2

		add_events
			event	counter	indian_horses_2
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_cavalry_2 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_horses_3	Defeat an army with cavalry 4 times
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_cavalry_killed > 3

		add_events
			event	counter	indian_horses_3
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_cavalry_3 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_guns_1		Defeat an army with gunpowder 2 times
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_gunpowder_killed > 1

		add_events
			event	counter	indian_guns_1
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_guns_1 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

; indian_guns_2		Defeat an army with gunpowder 3 times
	monitor_event FactionTurnStart FactionType apachean
		and I_CompareCounter apachean_gunpowder_killed > 2

		add_events
			event	counter	indian_guns_2
	   		date	0
	 	end_add_events
	 	
	 	if I_LocalFaction apachean
	 		historic_event apachean_guns_2 factions { apachean, }
	 	end_if
	 	
		terminate_monitor
	end_monitor

;;; Counter - Apachean settlements captures
	monitor_event OccupySettlement FactionType apachean
		inc_counter apachean_settlements_captured 1
	end_monitor

	monitor_event SackSettlement FactionType apachean
		inc_counter apachean_settlements_captured 1
	end_monitor

	monitor_event ExterminatePopulation FactionType apachean
		inc_counter apachean_settlements_captured 1
	end_monitor

;;; Counter - Apachean missile units recruited
	monitor_event UnitTrained FactionType apachean
		and TrainedUnitClass missile
		inc_counter apachean_missile_recruited 1
	end_monitor
	
;;; Counter - Apachean infantry units recruited
	monitor_event UnitTrained FactionType apachean
		and TrainedUnitCategory infantry
		inc_counter apachean_infantry_recruited 1
	end_monitor

;;; Counter - Apachean battles won
	monitor_event PostBattle FactionType apachean
		and WonBattle
		inc_counter apachean_battles_won 1
	end_monitor

;;; Counter - Apachean beat army with cavalry
	monitor_event PostBattle not WonBattle
		and GeneralFoughtFaction apachean
		and PercentageUnitCategory cavalry > 0
		inc_counter apachean_cavalry_killed 1
	end_monitor

;;; Counter - Apachean beat army with gunpowder units
	monitor_event PostBattle not WonBattle
		and GeneralFoughtFaction apachean
		and PercentageUnitAttribute gunpowder_unit > 0
		inc_counter apachean_gunpowder_killed 1
	end_monitor

;;; Counter - Chichimeca beat army with cavalry
	monitor_event PostBattle not WonBattle
		and GeneralFoughtFaction chichimeca
		and PercentageUnitCategory cavalry > 0
		inc_counter chichimeca_cavalry_killed 1
	end_monitor

;;; Counter - Chichimeca beat army with gunpowder units
	monitor_event PostBattle not WonBattle
		and GeneralFoughtFaction chichimeca
		and PercentageUnitAttribute gunpowder_unit > 0
		inc_counter chichimeca_gunpowder_killed 1
	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; England Arrives ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	add_events
		event	counter	england_arrives
   		date	40 50
 	end_add_events

 	;;; Mosquito Coast 1630
	;;; - Providence Island Company -  Earl of Warwick
	;;; - established friendly relations with local inhabitants
	monitor_event FactionTurnStart I_EventCounter england_arrives == 1	 
			
		spawn_army 
			faction england
			character	Robert Rich, named character, age 40, x 192, y 5
			traits GoodCommander 2 , Intelligent 1 , ReligionStarter 1 
			unit		New World Bodyguard		exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Grand Bombard		exp 0 armour 0 weapon_lvl 0
			unit		NE Ribault				exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin				exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction england
			character	random_name, general, age 23, x 190, y 4
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin				exp 0 armour 0 weapon_lvl 0
		end

		spawn_character england random_name, priest, age 27, x 189, y 6 
		spawn_character england random_name, diplomat, age 36, x 190, y 7   

		spawn_army 
			faction england
			character	random_name, admiral, age 26, x 195, y 6 
			unit		carrack				exp 1 armour 0 weapon_lvl 0
			unit		carrack				exp 1 armour 0 weapon_lvl 0
		end

		add_events
			event	counter	england_arrives
 	 		date	5 10
	 	end_add_events

		add_events
			event	counter	england_arrives
 	 		date	10 15
	 	end_add_events

		add_events
			event	counter	england_arrives
 	 		date	15 20
	 	end_add_events

		add_events
			event	counter	england_arrives
 	 		date	20 30
	 	end_add_events

		historic_event england_arrives_1 event/england_france_arrive.bik

		terminate_monitor
	end_monitor

	;; small intermediate stack
	monitor_event FactionTurnStart I_EventCounter england_arrives == 2	 
			
		spawn_army 
			faction england
			character	random_name, general, age 23, x 180, y 14
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

	;; small intermediate stack
	monitor_event FactionTurnStart I_EventCounter england_arrives == 3 
			
		spawn_army 
			faction england
			character	random_name, general, age 23, x 163, y 12
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

	;; small intermediate stack
	monitor_event FactionTurnStart I_EventCounter england_arrives == 4 
			
		spawn_army 
			faction england
			character	random_name, general, age 23, x 157, y 18
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
		
	;;; Belize 1638 - British Honduras
	;;; - used for production of dyes and mahogany lumber
	monitor_event FactionTurnStart I_EventCounter england_arrives == 5	 
			
		spawn_army 
			faction england
			character	Peter Wallace, named character, age 35, x 159, y 20
			traits GoodCommander 2 , Intelligent 1 , ReligionStarter 1 
			unit		New World Bodyguard		exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin				exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction england
			character	random_name, general, age 23, x 158, y 19
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		spawn_character england random_name, priest, age 27, x 158, y 23 
		spawn_character england random_name, diplomat, age 36, x 158, y 25   

		spawn_army 
			faction england
			character	random_name, admiral, age 31, x 161, y 20 
			unit		carrack				exp 1 armour 0 weapon_lvl 0
			unit		carrack				exp 1 armour 0 weapon_lvl 0
		end

		add_events
			event	counter	england_arrives
 	 		date	5 10
	 	end_add_events

		add_events
			event	counter	england_arrives
 	 		date	10 15
	 	end_add_events

		add_events
			event	counter	england_arrives
 	 		date	15 20
	 	end_add_events

	 	historic_event england_arrives_2 event/england_france_arrive.bik

		terminate_monitor
	end_monitor

	;; small intermediate stack
	monitor_event FactionTurnStart I_EventCounter england_arrives == 6	 
			
		spawn_army 
			faction england
			character	random_name, general, age 23, x 159, y 20
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

	;; small intermediate stack
	monitor_event FactionTurnStart I_EventCounter england_arrives == 7 
			
		spawn_army 
			faction england
			character	random_name, general, age 23, x 162, y 35
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
		
	;; small intermediate stack
	monitor_event FactionTurnStart I_EventCounter england_arrives == 8 
			
		spawn_army 
			faction england
			character	random_name, general, age 23, x 163, y 41
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Mortar				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
		

;;;;;;;;;;;;;;;;;;;;;;;; France Arrives ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	add_events
		event	counter	france_arrives
  		date	20 30
 	end_add_events

	;;; French arrive in Jascksonville, 1562 - Jean Ribault
	monitor_event FactionTurnStart I_EventCounter france_arrives == 1	 
			
		spawn_army 
			faction france
			character	Jean Ribault, named character, age 35, x 204, y 103
			traits GoodCommander 2 , Intelligent 1 , ReligionStarter 1 
			unit		New World Bodyguard		exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction france
			character	random_name, general, age 23, x 205, y 101
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		spawn_character france random_name, priest, age 27, x 203, y 105 
		spawn_character france random_name, diplomat, age 36, x 202, y 102   
		
		spawn_army 
			faction france
			character	random_name, admiral, age 26, x 207, y 103 
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
		end

		add_events
			event	counter	france_arrives
	 		date	5 10
	 	end_add_events

		add_events
			event	counter	france_arrives
	 		date	10 15
	 	end_add_events

		add_events
			event	counter	france_arrives
	 		date	20 25
	 	end_add_events

		add_events
			event	counter	france_arrives
	 		date	25 30
	 	end_add_events

		add_events
			event	counter	france_arrives
	 		date	30 50
	 	end_add_events

		historic_event france_arrives_1 event/england_france_arrive.bik

		terminate_monitor
	end_monitor
	
	;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 2	 

		spawn_army 
			faction france
			character	random_name, general, age 26, x 202, y 111
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
	
	;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 3	 

		spawn_army 
			faction france
			character	random_name, general, age 26, x 195, y 131
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
	
	;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 4	 

		spawn_army 
			faction france
			character	random_name, general, age 26, x 177, y 144
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
	
	;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 5	 

		spawn_army 
			faction france
			character	random_name, general, age 26, x 148, y 145
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
	
	;;; French arrive at mouth of Mississippi, 1684
	monitor_event FactionTurnStart I_EventCounter france_arrives == 6	 

		spawn_army
			faction france
			character	Robert de_La_Salle, named character, age 42, x 108, y 114
			traits GoodCommander 2 , Intelligent 1 , ReligionStarter 1 
			unit		New World Bodyguard		exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers		exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers		exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers		exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers		exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Basilisk				exp 0 armour 0 weapon_lvl 0
			unit		NE Serpentine			exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction france
			character	random_name, general, age 23, x 109, y 114
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		spawn_character france random_name, priest, age 27, x 110, y 118 
		spawn_character france random_name, diplomat, age 36, x 110, y 117   

		spawn_army 
			faction france
			character	random_name, admiral, age 26, x 109, y 111 
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
		end

		add_events
			event	counter	france_arrives
	 		date	5 10
	 	end_add_events

		add_events
			event	counter	france_arrives
	 		date	10 15
	 	end_add_events

		add_events
			event	counter	france_arrives
	 		date	15 20
	 	end_add_events

		add_events
			event	counter	france_arrives
	 		date	20 25
	 	end_add_events

		historic_event france_arrives_2 event/england_france_arrive.bik

		terminate_monitor
	end_monitor

	;;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 7	 

		spawn_army 
			faction france
			character	random_name, general, age 25, x 114, y 144
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

	;;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 8	 

		spawn_army 
			faction france
			character	random_name, general, age 31, x 94, y 144
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

	;;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 9	 

		spawn_army 
			faction france
			character	random_name, general, age 21, x 73, y 144
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

	;;; small intermediate force
	monitor_event FactionTurnStart I_EventCounter france_arrives == 10	 

		spawn_army 
			faction france
			character	random_name, general, age 28, x 150, y 144
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; Europeans Found Settlements ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;;;; Mexico - Tenochtitlan

	declare_counter Tenochtitlan_Spain
	
	;;; Spain captures Tenochtitlan
	monitor_conditions I_SettlementOwner Tenochtitlan = spain
		and I_CompareCounter Tenochtitlan_Spain = 0
		
		set_counter Tenochtitlan_Spain 1
		change_settlement_name Tenochtitlan Mexico

 	end_monitor

	;;; Natives capture Tenochtitlan
	monitor_conditions not I_SettlementOwner Tenochtitlan = spain
		and not I_SettlementOwner Tenochtitlan = england
		and not I_SettlementOwner Tenochtitlan = france
		and I_CompareCounter Tenochtitlan_Spain = 1

		set_counter Tenochtitlan_Spain 0
		change_settlement_name Tenochtitlan Tenochtitlan

 	end_monitor

;;;;; Louisiana - Choctaw

	declare_counter Choctaw_France
	
	;;; France captures Choctaw
	monitor_conditions I_SettlementOwner Choctaw = france
		and I_CompareCounter Choctaw_France = 0
		
		set_counter Choctaw_France 1
		change_settlement_name Choctaw Louisiana

 	end_monitor

	;;; Natives capture Choctaw
	monitor_conditions not I_SettlementOwner Choctaw = spain
		and not I_SettlementOwner Choctaw = england
		and not I_SettlementOwner Choctaw = france
		and I_CompareCounter Choctaw_France = 1

		set_counter Choctaw_France 0
		change_settlement_name Choctaw Choctaw

 	end_monitor
 		
;;;;; Fort Caroline - Calusa

	declare_counter Calusa_France
	
	;;; France captures Calusa
	monitor_conditions I_SettlementOwner Calusa = france
		and I_CompareCounter Calusa_France = 0
		
		set_counter Calusa_France 1
		change_settlement_name Calusa Caroline

 	end_monitor

	;;; Natives capture Calusa
	monitor_conditions not I_SettlementOwner Calusa = spain
		and not I_SettlementOwner Calusa = england
		and not I_SettlementOwner Calusa = france
		and I_CompareCounter Calusa_France = 1

		set_counter Calusa_France 0
		change_settlement_name Calusa Calusa

 	end_monitor

;;;;; Fort Saint Louis - Coahulia

	declare_counter Coahulia_France
	
	;;; France captures Coahulia
	monitor_conditions I_SettlementOwner Coahulia = france
		and I_CompareCounter Coahulia_France = 0
		
		set_counter Coahulia_France 1
		change_settlement_name Coahulia Saint_Louis

 	end_monitor

	;;; Natives capture Coahulia
	monitor_conditions not I_SettlementOwner Coahulia = spain
		and not I_SettlementOwner Coahulia = england
		and not I_SettlementOwner Coahulia = france
		and I_CompareCounter Coahulia_France = 1

		set_counter Coahulia_France 0
		change_settlement_name Coahulia Coahulia

 	end_monitor

;;;;; Althun Ha - Honduras

	declare_counter Althun_England
	
	;;; England captures Althun_Ha
	monitor_conditions I_SettlementOwner Althun_Ha = england
		and I_CompareCounter Althun_England = 0
		
		set_counter Althun_England 1
		change_settlement_name Althun_Ha Honduras

 	end_monitor

	;;; Natives capture Althun_Ha
	monitor_conditions not I_SettlementOwner Althun_Ha = spain
		and not I_SettlementOwner Althun_Ha = england
		and not I_SettlementOwner Althun_Ha = france
		and I_CompareCounter Althun_England = 1

		set_counter Althun_England 0
		change_settlement_name Althun_Ha Althun_Ha

 	end_monitor

;;;;; Trujillo - Mosquito Coast

	declare_counter Trujillo_England
	
	;;; England captures Trujillo
	monitor_conditions I_SettlementOwner Trujillo = england
		and I_CompareCounter Trujillo_England = 0
		
		set_counter Trujillo_England 1
		change_settlement_name Trujillo Mosquito

 	end_monitor

	;;; Natives capture Trujillo
	monitor_conditions not I_SettlementOwner Trujillo = spain
		and not I_SettlementOwner Trujillo = england
		and not I_SettlementOwner Trujillo = france
		and I_CompareCounter Trujillo_England = 1

		set_counter Trujillo_England 0
		change_settlement_name Trujillo Trujillo

 	end_monitor

;;;;; Danipaguache - Monte Alban

	declare_counter Danipaguache_Spain
	
	;;; Spain captures Danipaguache
	monitor_conditions I_SettlementOwner Danipaguache = spain
		and I_CompareCounter Danipaguache_Spain = 0
		
		set_counter Danipaguache_Spain 1
		change_settlement_name Danipaguache Monte_Alban

 	end_monitor

	;;; Natives capture Danipaguache
	monitor_conditions not I_SettlementOwner Danipaguache = spain
		and not I_SettlementOwner Danipaguache = england
		and not I_SettlementOwner Danipaguache = france
		and I_CompareCounter Danipaguache_Spain = 1

		set_counter Danipaguache_Spain 0
		change_settlement_name Danipaguache Danipaguache

 	end_monitor

;;;;; Tehuantepec - Salina Cruz

	declare_counter Tehuantepec_Spain
	
	;;; Spain captures Tehuantepec
	monitor_conditions I_SettlementOwner Tehuantepec = spain
		and I_CompareCounter Tehuantepec_Spain = 0
		
		set_counter Tehuantepec_Spain 1
		change_settlement_name Tehuantepec Salina_Cruz

 	end_monitor

	;;; Natives capture Tehuantepec
	monitor_conditions not I_SettlementOwner Tehuantepec = spain
		and not I_SettlementOwner Tehuantepec = england
		and not I_SettlementOwner Tehuantepec = france
		and I_CompareCounter Tehuantepec_Spain = 1

		set_counter Tehuantepec_Spain 0
		change_settlement_name Tehuantepec Tehuantepec

 	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; AI French Expeditions ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	monitor_event FactionTurnStart FactionType france
		and I_IsFactionAIControlled france	 	
 		and I_TurnNumber = 1
		and I_NumberOfSettlements france > 0

		spawn_army 
			faction france
			character	random_name, general, age 35, x 145, y 117
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		Aventurier				exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
	
	
;;;;;;;;;;;;;;;;;;;;;;;; AI England Expeditions ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	monitor_event FactionTurnStart FactionType england
		and I_IsFactionAIControlled england

		spawn_army 
			faction england
			character	random_name, general, age 35, x 22, y 87
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Pikemen					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers				exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		Demi Lancers			exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin				exp 0 armour 0 weapon_lvl 0
			unit		NE Bombard				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor


;;;;;;;;;;;;;;;;;;;;;;;; AI Spanish Expeditions ;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_IsFactionAIControlled spain
		and I_IsFactionAIControlled mayans		

		spawn_army 
			faction spain
			character	random_name, general, age 42, x 112, y 26
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores		exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin			exp 0 armour 0 weapon_lvl 0
		end
		
		spawn_army 
			faction spain
			character	random_name, general, age 42, x 114, y 26
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin			exp 0 armour 0 weapon_lvl 0
		end
		
		add_money spain 15000
		
		terminate_monitor
	end_monitor

 	;;; Small force near Trujillo
	monitor_event FactionTurnStart FactionType spain
		and I_IsFactionAIControlled spain	 	
 		and I_TurnNumber = 1
		and I_NumberOfSettlements spain > 0

 		add_money spain 10000

		spawn_army 
			faction spain
			character	random_name, general, age 29, x 178, y 10
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin			exp 0 armour 0 weapon_lvl 0
		end
		
		spawn_army 
			faction spain
			character	random_name, general, age 29, x 166, y 2
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 0 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin			exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor

    ;;; Reinforcements for Spain AI, 
    ;;; cause with new reqruit system(1 unit spawn time about 5-10 turns) faction needs 
    ;;; about 7 settlements for normal reqruiments. Spain AI cant capture anything at the start
	
	monitor_event FactionTurnStart FactionType spain
		and I_IsFactionAIControlled spain
		and I_NumberOfSettlements spain < 7
		and I_NumberOfSettlements spain > 0
		
		spawn_army 
			faction spain
			character	random_name, general, age 29, x 196, y 68
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
		end
		
		add_money spain 2000
	end_monitor
	
	monitor_event FactionTurnStart FactionType england
		and I_IsFactionAIControlled england
		and I_NumberOfSettlements england < 7
		and I_NumberOfSettlements england > 0
		
		spawn_army 
			faction england
			character	random_name, general, age 29, x 9, y 78
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
		end
	end_monitor
	
	monitor_event FactionTurnStart FactionType france
		and I_IsFactionAIControlled france
		and I_NumberOfSettlements france < 7
		and I_NumberOfSettlements france > 0
		
		spawn_army 
			faction france
			character	random_name, general, age 29, x 200, y 106
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
			unit		New World Cuirassers	exp 0 armour 0 weapon_lvl 0
		end
	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; Spanish Expeditions ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	monitor_event FactionTurnStart FactionType spain
 		and I_TurnNumber = 10

		add_events
			event	counter	explorers
	 		date	0 10
	 	end_add_events

		terminate_monitor
	end_monitor
	
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter explorers == 1	 	

		; Francisco de_Montejo	1528
		; - Yucatan
		; - attempted to conquer it along the east coast (Tulum, Chetumal) 

		; Turn 10-20
		spawn_army 
			faction spain
			character	Francisco de_Montejo, named character, age 50, x 164, y 40
			traits LoyaltyStarter 1 , GoodCommander 1 , Intelligent 1 , ReligionStarter 1 
			unit		New World Bodyguard			exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Crossbowmen				exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin			exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction spain
			character	Garcia, admiral, age 32, x 166, y 40 
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
		end

		add_events
			event	counter	explorers
	 		date	10 20
	 	end_add_events
		
	 	if I_LocalFaction spain

			add_events
			 	event	historic spanish_explorers_1 factions { spain, }
			 	date 0
				position	164, 40
			 	movie	event/Spanish_Expedition.bik
		 	end_add_events

		end_if
	 	
		terminate_monitor
	end_monitor

	; Turn 20-40
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter explorers == 2	 	

		; Francisco Coronado	1540
		; - northern Mexico, Pueblo Indians
		; - searching for Seven Golden Cities of Cibola
		
		spawn_army 
			faction spain
			character	Francisco Coronado, named character, age 30, x 98, y 41
			traits LoyaltyStarter 1 , GoodCommander 2 , ReligionStarter 1 
			unit		New World Bodyguard			exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		Sword and Buckler Men		exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin			exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction spain
			character	Rodrigo, admiral, age 32, x 100, y 41 
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
		end

		add_events
			event	counter	explorers
	 		date	10 20
	 	end_add_events
		
	 	if I_LocalFaction spain
			add_events
			 	event	historic spanish_explorers_2 factions { spain, }
			 	date 0
				position	98, 41
			 	movie	event/Spanish_Expedition.bik
		 	end_add_events
		end_if
		
		terminate_monitor
	end_monitor

	; Turn 30-60
	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter explorers == 3	 	
		
		; Pedro Menendez		1565
		; - Florida
		; - founds St Augustine
	
		spawn_army 
			faction spain
			character	Pedro Menendez, named character, age 46, x 205, y 102
			traits LoyaltyStarter 1 , GoodCommander 1 , Intelligent 1 , ReligionStarter 1 
			unit		New World Bodyguard			exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Conquistadores				exp 1 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Spanish Dragoons			exp 1 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Musketeers					exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		Dismounted Conquistadores	exp 0 armour 0 weapon_lvl 0
			unit		NE Culverin			exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction spain
			character	Pablo, admiral, age 32, x 207, y 102 
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
			unit		grande carrack				exp 1 armour 0 weapon_lvl 0
		end
		
	 	if I_LocalFaction spain
			add_events
			 	event	historic spanish_explorers_3 event/Spanish_Expedition.bik factions { spain, }
			 	date 0
				position	205, 102
			 	movie	event/Spanish_Expedition.bik
		 	end_add_events
		end_if

		terminate_monitor
	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; Reveal Settlements ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	monitor_event FactionTurnStart FactionType mayans
		and I_LocalFaction mayans

		reveal_tile 160, 24		;Althun Ha
		reveal_tile 160, 31		;Chetumal
		reveal_tile 134, 33		;Xicalango
		reveal_tile 138, 20		;Yaxchilan
		
		hide_all_revealed_tiles
		
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType chichimeca
		and I_LocalFaction chichimeca

		reveal_tile 42, 54		;Ahuacatlan
		reveal_tile 89, 64		;Cuahtemoc

		hide_all_revealed_tiles
		
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType tarascans
		and I_LocalFaction tarascans

		reveal_tile 52, 47		;Ocotlan
		reveal_tile 47, 36		;Tecoman

		hide_all_revealed_tiles
		
		terminate_monitor
	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; Sacrifice ;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	
	;;;;;;; Convert Settlement (Occupy) ;;;;;;;
	monitor_event OccupySettlement FactionType spain
		change_population_religion spain catholic 3 pagan
		change_population_religion spain catholic 3 islam
	end_monitor

	monitor_event OccupySettlement FactionType england
		change_population_religion england catholic 3 pagan
		change_population_religion england catholic 3 islam
	end_monitor

	monitor_event OccupySettlement FactionType france
		change_population_religion france catholic 3 pagan
		change_population_religion france catholic 3 islam
	end_monitor

	;;;;;;; Sacrifice Settlement (Exterminate) ;;;;;;;
	monitor_event ExterminatePopulation FactionType aztecs
		change_population_religion aztecs pagan 3 catholic
		change_population_religion aztecs pagan 3 islam
	end_monitor

	monitor_event ExterminatePopulation FactionType mayans
		change_population_religion mayans pagan 3 catholic
		change_population_religion mayans pagan 3 islam
	end_monitor

	monitor_event ExterminatePopulation FactionType tlaxcalans
		change_population_religion tlaxcalans pagan 3 catholic
		change_population_religion tlaxcalans pagan 3 islam
	end_monitor

	monitor_event ExterminatePopulation FactionType tarascans
		change_population_religion tarascans pagan 3 catholic
		change_population_religion tarascans pagan 3 islam
	end_monitor

	monitor_event ExterminatePopulation FactionType chichimeca
		change_population_religion chichimeca pagan 3 catholic
		change_population_religion chichimeca pagan 3 islam
	end_monitor

	;;;;;;; Raid Settlement (Sack) ;;;;;;;
	monitor_event SackSettlement FactionType aztecs
		change_population_religion aztecs pagan 1 catholic
		change_population_religion aztecs pagan 1 islam
	end_monitor

	monitor_event SackSettlement FactionType mayans
		change_population_religion mayans pagan 1 catholic
		change_population_religion mayans pagan 1 islam
	end_monitor

	monitor_event SackSettlement FactionType tlaxcalans
		change_population_religion tlaxcalans pagan 1 catholic
		change_population_religion tlaxcalans pagan 1 islam
	end_monitor

	monitor_event SackSettlement FactionType tarascans
		change_population_religion tarascans pagan 1 catholic
		change_population_religion tarascans pagan 1 islam
	end_monitor

	monitor_event SackSettlement FactionType chichimeca
		change_population_religion chichimeca pagan 1 catholic
		change_population_religion chichimeca pagan 1 islam
	end_monitor
	
	;;;;;;; Sacrifice Unit (Disband) ;;;;;;;
	
	monitor_event UnitDisbanded FactionType aztecs
		change_population_religion aztecs pagan 3 catholic
		change_population_religion aztecs pagan 3 islam
	end_monitor

	monitor_event UnitDisbanded FactionType mayans
		change_population_religion mayans pagan 3 catholic
		change_population_religion mayans pagan 3 islam
	end_monitor

	monitor_event UnitDisbanded FactionType tlaxcalans
		change_population_religion tlaxcalans pagan 3 catholic
		change_population_religion tlaxcalans pagan 3 islam
	end_monitor

	monitor_event UnitDisbanded FactionType tarascans
		change_population_religion tarascans pagan 3 catholic
		change_population_religion tarascans pagan 3 islam
	end_monitor

	monitor_event UnitDisbanded FactionType chichimeca
		change_population_religion chichimeca pagan 3 catholic
		change_population_religion chichimeca pagan 3 islam
	end_monitor
		
	;;;;;;; Hold Sacrifices (Races) ;;;;;;;
	monitor_event GovernorThrowRaces FactionType aztecs
		change_population_religion aztecs pagan 1 catholic
		change_population_religion aztecs pagan 1 islam
	end_monitor

	monitor_event GovernorThrowRaces FactionType mayans
		change_population_religion mayans pagan 1 catholic
		change_population_religion mayans pagan 1 islam
	end_monitor

	monitor_event GovernorThrowRaces FactionType tlaxcalans
		change_population_religion tlaxcalans pagan 1 catholic
		change_population_religion tlaxcalans pagan 1 islam
	end_monitor

	monitor_event GovernorThrowRaces FactionType tarascans
		change_population_religion tarascans pagan 1 catholic
		change_population_religion tarascans pagan 1 islam
	end_monitor

	monitor_event GovernorThrowRaces FactionType chichimeca
		change_population_religion chichimeca pagan 1 catholic
		change_population_religion chichimeca pagan 1 islam
	end_monitor
	
	;;;;;;; Hold Dances (Games) ;;;;;;;
	monitor_event GovernorThrowGames FactionType apachean
		change_population_religion apachean islam 1 pagan
		change_population_religion apachean islam 1 catholic
	end_monitor
	
	;;;;;;; Sacrifice Enemies (Execute) ;;;;;;;
	monitor_event GeneralPrisonersRansomedCaptor RansomType execute
		and FactionType aztecs
		change_population_religion aztecs pagan 1 catholic
		change_population_religion aztecs pagan 1 islam
	end_monitor
	
	monitor_event FactionLeaderPrisonersRansomedCaptor RansomType execute
		and FactionType aztecs
		change_population_religion aztecs pagan 3 catholic
		change_population_religion aztecs pagan 3 islam
	end_monitor
	
	monitor_event GeneralPrisonersRansomedCaptor RansomType execute
		and FactionType mayans
		change_population_religion mayans pagan 1 catholic
		change_population_religion mayans pagan 1 islam
	end_monitor
	
	monitor_event FactionLeaderPrisonersRansomedCaptor RansomType execute
		and FactionType mayans
		change_population_religion mayans pagan 3 catholic
		change_population_religion mayans pagan 3 islam
	end_monitor

	monitor_event GeneralPrisonersRansomedCaptor RansomType execute
		and FactionType tlaxcalans
		change_population_religion tlaxcalans pagan 1 catholic
		change_population_religion tlaxcalans pagan 1 islam
	end_monitor
	
	monitor_event FactionLeaderPrisonersRansomedCaptor RansomType execute
		and FactionType tlaxcalans
		change_population_religion tlaxcalans pagan 3 catholic
		change_population_religion tlaxcalans pagan 3 islam
	end_monitor

	monitor_event GeneralPrisonersRansomedCaptor RansomType execute
		and FactionType tarascans
		change_population_religion tarascans pagan 1 catholic
		change_population_religion tarascans pagan 1 islam
	end_monitor
	
	monitor_event FactionLeaderPrisonersRansomedCaptor RansomType execute
		and FactionType tarascans
		change_population_religion tarascans pagan 3 catholic
		change_population_religion tarascans pagan 3 islam
	end_monitor

	monitor_event GeneralPrisonersRansomedCaptor RansomType execute
		and FactionType chichimeca
		change_population_religion chichimeca pagan 1 catholic
		change_population_religion chichimeca pagan 1 islam
	end_monitor
	
	monitor_event FactionLeaderPrisonersRansomedCaptor RansomType execute
		and FactionType chichimeca
		change_population_religion chichimeca pagan 3 catholic
		change_population_religion chichimeca pagan 3 islam
	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; Smallpox ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	;;;;Spain captures Vera Cruz	-	Outbreak
	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Vera_Cruz = spain

		add_events
			event	counter	plague_spain
	 		date	6 12
	 	end_add_events
		
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType spain
		and I_EventCounter plague_spain == 1
		
		add_events
			event	plague
	 		date	0
			position	103, 33		;Vera Cruz
	 	end_add_events

		if I_LocalFaction spain
			historic_event outbreak factions { spain, }
		end_if

		if I_LocalFaction tlaxcalans
			historic_event outbreak factions { tlaxcalans, }
		end_if
	 	
		terminate_monitor
	 end_monitor
	
	;;;;Spain captures Tenochtitlan	-	Outbreak
	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Tenochtitlan = spain

		if I_LocalFaction aztecs
			add_events
				event	historic outbreak factions { aztecs, }
				date 2
		 	end_add_events
		end_if
		
		add_events
			event	plague
	 		date	2
			position	85, 33		;Tenochtitlan
			position	87, 28		;Huaxtepec
			position	83, 41		;Tula
			position	79, 32		;Toluca
			position	91, 29		;Cholua
			position	92, 33		;Tlaxcala
			position	83, 21		;Tixtla
			position	103, 33		;Vera Cruz
	 	end_add_events
		
		terminate_monitor
	end_monitor
 	
	;;;;Spain captures Apatzignan	-	Outbreak
	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Apatzignan = spain

		if I_LocalFaction tarascans
			add_events
				event	historic outbreak factions { tarascans, }
				date 2
		 	end_add_events
		end_if
		
		add_events
			event	plague
	 		date	2
			position	55, 36		;Apatzignan
			position	58, 41		;Zacapu
			position	52, 47		;Ocotlan
			position	47, 36		;Tecoman
	 	end_add_events
		
		terminate_monitor
	end_monitor

	;;;;Spain captures Zacatecas	-	Outbreak
	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Zacatecas = spain
		
		if I_LocalFaction chichimeca
			add_events
				event	historic outbreak factions { chichimeca, }
				date 2
		 	end_add_events
		end_if
		
		add_events
			event	plague
	 		date	2
			position	55, 68		;Zacatecas
			position	49, 62		;Colotan
	 	end_add_events
		
		terminate_monitor
	end_monitor

	;;;;Spain captures Canpech	-	Outbreak
	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Canpech = spain
		
		if I_LocalFaction mayans
			add_events
				event	historic outbreak factions { mayans, }
				date 2
		 	end_add_events
		end_if
		
		add_events
			event	plague
	 		date	2
			position	141, 42		;Canpech
			position	147, 46		;Uxmal
			position	156, 50		;Chichen Itza
			position	160, 31		;Chetumal
			position	160, 24		;Althun Ha
			position	147, 21		;Tikal
			position	134, 33		;Xicalango
			position	138, 30		;Yaxchilan
	 	end_add_events
		
		terminate_monitor
	end_monitor
	 	
	 	
;;;;;;;;;;;;;;;;;;;;;;;; Prestige Points ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	;;;;;;; Easy Mission ;;;;;;;
	monitor_event LeaderMissionSuccess FactionType spain
		and PaybackID consulate_minor
		inc_counter prestige_points 2
	end_monitor

	monitor_event LeaderMissionSuccess FactionType spain
		and PaybackID consulate_minor_units
		inc_counter prestige_points 2
	end_monitor

	monitor_event LeaderMissionFailed FactionType spain
		and PaybackID consulate_minor
		inc_counter prestige_points -2
	end_monitor

	monitor_event LeaderMissionFailed FactionType spain
		and PaybackID consulate_minor_units
		inc_counter prestige_points -2
	end_monitor
	
	;;;;;;; Moderate Mission ;;;;;;;
	monitor_event LeaderMissionSuccess FactionType spain
		and PaybackID consulate_mod
		inc_counter prestige_points 5
	end_monitor

	monitor_event LeaderMissionSuccess FactionType spain
		and PaybackID consulate_mod_units
		inc_counter prestige_points 5
	end_monitor

	monitor_event LeaderMissionFailed FactionType spain
		and PaybackID consulate_mod
		inc_counter prestige_points -5
	end_monitor

	monitor_event LeaderMissionFailed FactionType spain
		and PaybackID consulate_mod_units
		inc_counter prestige_points -5
	end_monitor
	
	;;;;;;; Hard Mission ;;;;;;;
	monitor_event LeaderMissionSuccess FactionType spain
		and PaybackID consulate_major
		inc_counter prestige_points 10
	end_monitor

	monitor_event LeaderMissionSuccess FactionType spain
		and PaybackID consulate_major_units
		inc_counter prestige_points 10
	end_monitor
	
	monitor_event LeaderMissionFailed FactionType spain
		and PaybackID consulate_major
		inc_counter prestige_points -10
	end_monitor

	monitor_event LeaderMissionFailed FactionType spain
		and PaybackID consulate_major_units
		inc_counter prestige_points -10
	end_monitor

	;;;;;;; Victory (Odds >=1) ;;;;;;;
	monitor_event PostBattle FactionType spain
		and WonBattle
		and BattleOdds >= 1
		inc_counter prestige_points 1
	end_monitor
	
	;;;;;;; Victory (Odds 0.5-1) ;;;;;;;
	monitor_event PostBattle FactionType spain
		and WonBattle
		and BattleOdds >= 0.5
		and BattleOdds < 1
		inc_counter prestige_points 2
	end_monitor
	
	;;;;;;; Victory (Odds <0.5) ;;;;;;;
	monitor_event PostBattle FactionType spain
		and WonBattle
		and BattleOdds < 0.5
		inc_counter prestige_points 3
	end_monitor
	
	;;;;;;; Defeat (Odds < 0.5) ;;;;;;;
	monitor_event PostBattle FactionType spain
		and not WonBattle
		and BattleOdds < 0.5
		inc_counter prestige_points -1
	end_monitor

	;;;;;;; Defeat (Odds 0.5-1) ;;;;;;;
	monitor_event PostBattle FactionType spain
		and not WonBattle
		and BattleOdds >= 0.5
		and BattleOdds < 1
		inc_counter prestige_points -2
	end_monitor
	
	;;;;;;; Defeat (Odds >= 1) ;;;;;;;
	monitor_event PostBattle FactionType spain
		and not WonBattle
		and BattleOdds >= 1
		inc_counter prestige_points -3
	end_monitor
	
	;;;;;;; Capture Settlement ;;;;;;;
	monitor_event OccupySettlement FactionType spain
		inc_counter prestige_points 3
	end_monitor

	monitor_event SackSettlement FactionType spain
		inc_counter prestige_points 3
	end_monitor

	monitor_event ExterminatePopulation FactionType spain
		inc_counter prestige_points 3
	end_monitor
	
	;;;;;;; Lose Settlement ;;;;;;;
	monitor_event OccupySettlement TargetFactionType spain
		inc_counter prestige_points -3
	end_monitor

	monitor_event SackSettlement TargetFactionType spain
		inc_counter prestige_points -3
	end_monitor

	monitor_event ExterminatePopulation TargetFactionType spain
		inc_counter prestige_points -3
	end_monitor
	
	;;;;;;; Capture Capital ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Tenochtitlan = spain
		inc_counter prestige_points 5
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Apache = spain
		inc_counter prestige_points 5
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Chichen_Itza = spain
		inc_counter prestige_points 5
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Tlaxcala = spain
		inc_counter prestige_points 5
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Zacatecas = spain
		inc_counter prestige_points 5
		terminate_monitor
	end_monitor

	monitor_event FactionTurnStart FactionType spain
		and I_SettlementOwner Apatzignan = spain
		inc_counter prestige_points 5
		terminate_monitor
	end_monitor
	
	;;;;;;; Destroy Faction ;;;;;;;
	monitor_event LeaderDestroyedFaction FactionType spain
		inc_counter prestige_points 10
	end_monitor
	
	;;;;;;; Kill Family Member ;;;;;;;
	monitor_event AssassinationMission MissionSucceeded
		and FactionType spain
		and AgentType = family
		inc_counter prestige_points 3
	end_monitor
	
	;;;;;;; Trade Agreement Made ;;;;;;;
	monitor_event FactionTradeAgreementMade FactionType spain
		inc_counter prestige_points 3
	end_monitor
	
	;;;;;;; Treasury >50000 ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and Treasury > 50000
		inc_counter prestige_points 1
	end_monitor

	;;;;;;; Treasury >100000 ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and Treasury > 100000
		inc_counter prestige_points 2
	end_monitor
	
	;;;;;;; Passive Increase ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		inc_counter prestige_points 1
	end_monitor

	;;;;;;; AI Passive Increase ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_IsFactionAIControlled spain
		inc_counter prestige_points 3
	end_monitor

;;;;;;;;;;;;;;;;;;;;;;;; Prestige Ranks ;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	;;;;;;; Lord ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_CompareCounter prestige_points >= 25
		
		add_events
			event	counter	prestige_rank
	 		date	0
	 	end_add_events

	 	add_money spain 5000
        
		add_events
			event	historic prestige_lord factions { spain, england, france, }
			date	1
		end_add_events

		
		terminate_monitor
	end_monitor

	monitor_event CharacterTurnEnd IsFactionLeader 
		and Trait Prestige = 1
		
		set_event_counter prestige_rank 0
		
		add_events
			event	counter	prestige_rank_lord
	 		date	0
	 	end_add_events
		
		terminate_monitor
	end_monitor

	;;;;;;; Baron ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_CompareCounter prestige_points >= 50
	
		add_events
			event	counter	prestige_rank
	 		date	0
	 	end_add_events
		
	 	add_money spain 10000
		
		if not I_IsFactionAIControlled spain
			increment_kings_purse spain -1000
		end_if
		
		if not I_IsFactionAIControlled england
			increment_kings_purse england -1000
		end_if
		
        increment_kings_purse france -1000

		add_events
			event	historic prestige_baron factions { spain, england, france, }
			date	1
		end_add_events

		
		terminate_monitor
	end_monitor

	monitor_event CharacterTurnEnd IsFactionLeader 
		and Trait Prestige = 2
		
		set_event_counter prestige_rank 0
		
		add_events
			event	counter	prestige_rank_baron
	 		date	0
	 	end_add_events

		terminate_monitor
	end_monitor

	;;;;;;; Viscount ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_CompareCounter prestige_points >= 100
	
		add_events
			event	counter	prestige_rank
	 		date	0
	 	end_add_events
		
	 	add_money spain 15000
		
		if not I_IsFactionAIControlled spain
			increment_kings_purse spain -1500
		end_if
		
		if not I_IsFactionAIControlled france
			increment_kings_purse france -1500
		end_if
		
		if not I_IsFactionAIControlled england
			increment_kings_purse england -1500
		end_if

		add_events
			event	historic prestige_viscount factions { spain, england, france, }
			date	1
		end_add_events

		
		terminate_monitor
	end_monitor

	monitor_event CharacterTurnEnd IsFactionLeader 
		and Trait Prestige = 3
		
		set_event_counter prestige_rank 0
		
		add_events
			event	counter	prestige_rank_viscount
	 		date	0
	 	end_add_events
		
		terminate_monitor
	end_monitor

	;;;;;;; Count ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_CompareCounter prestige_points >= 150
	
		add_events
			event	counter	prestige_rank
	 		date	0
	 	end_add_events
		
	 	add_money spain 20000
		
		if not I_IsFactionAIControlled spain
			increment_kings_purse spain -2000
		end_if
		
		if not I_IsFactionAIControlled france
			increment_kings_purse france -2000
		end_if
		
		if not I_IsFactionAIControlled england
			increment_kings_purse england -2000
		end_if
		
		add_events
			event	historic prestige_count factions { spain, england, france, }
			date	1
		end_add_events

		
		terminate_monitor
	end_monitor

	monitor_event CharacterTurnEnd IsFactionLeader 
		and Trait Prestige = 4
		
		set_event_counter prestige_rank 0
		
		add_events
			event	counter	prestige_rank_count
	 		date	0
	 	end_add_events
		
		terminate_monitor
	end_monitor

	;;;;;;; Marquis ;;;;;;;
	monitor_event FactionTurnStart FactionType spain
		and I_CompareCounter prestige_points >= 200
	
		add_events
			event	counter	prestige_rank
	 		date	0
	 	end_add_events
		
	 	add_money spain 25000
	 	

		add_events
			event	historic prestige_marquis factions { spain, england, france, }
			date	1
		end_add_events

		
		terminate_monitor
	end_monitor

	monitor_event CharacterTurnEnd IsFactionLeader
		and Trait Prestige = 5
		
		set_event_counter prestige_rank 0
		
		add_events
			event	counter	prestige_rank_marquis
	 		date	0
	 	end_add_events
		
		terminate_monitor
	end_monitor

;----------------- CASH FOR AI ----------------;
	
	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType spain
		and LosingMoney
		and Treasury < 0
	
		add_money spain 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType aztecs
		and LosingMoney
		and Treasury < 0
	
		add_money aztecs 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType mayans
		and LosingMoney
		and Treasury < 0
	
		add_money mayans 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType apachean
		and LosingMoney
		and Treasury < 0
	
		add_money apachean 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType chichimeca
		and LosingMoney
		and Treasury < 0
	
		add_money chichimeca 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType tlaxcalans
		and LosingMoney
		and Treasury < 0
	
		add_money tlaxcalans 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType tarascans
		and LosingMoney
		and Treasury < 0
	
		add_money tarascans 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType england
		and LosingMoney
		and Treasury < 0
	
		add_money england 2000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType france
		and LosingMoney
		and Treasury < 0
	
		add_money france 2000
	
	end_monitor

;----------------- MORE CASH FOR AI ----------------;
	
	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType spain
		and LosingMoney
		and Treasury < -5000
	
		add_money spain 6000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType aztecs
		and LosingMoney
		and Treasury < -5000
	
		add_money aztecs 6000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType mayans
		and LosingMoney
		and Treasury < -5000
	
		add_money mayans 6000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType apachean
		and LosingMoney
		and Treasury < -5000
	
		add_money apachean 6000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType chichimeca
		and LosingMoney
		and Treasury < -5000
	
		add_money chichimeca 6000
	
	end_monitor
	
	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType tlaxcalans
		and LosingMoney
		and Treasury < -5000
	
		add_money tlaxcalans 6000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType tarascans
		and LosingMoney
		and Treasury < -5000
	
		add_money tarascans 6000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType england
		and LosingMoney
		and Treasury < -5000
	
		add_money england 6000
	
	end_monitor

	monitor_event FactionTurnStart not FactionIsLocal
		and FactionType france
		and LosingMoney
		and Treasury < -5000
	
		add_money france 6000
	
	end_monitor	
	
	
	;----------- Balancing Statistics ------------
	
	monitor_event FactionTurnStart FactionType spain
	and Treasury > 130000
	
		add_money spain -20000
	
	end_monitor
	
	monitor_event FactionTurnStart FactionType chichimeca
	and Treasury > 130000
	
		add_money chichimeca -20000
	
	end_monitor
	
	monitor_event FactionTurnStart FactionType england
	and Treasury > 130000
	
		add_money england -20000
	
	end_monitor
	
	monitor_event FactionTurnStart FactionType france
	and Treasury > 130000
	
		add_money france -20000
	
	end_monitor
	
	monitor_event FactionTurnStart FactionType apachean
	and Treasury > 130000
	
		add_money apachean -20000
	
	end_monitor
	
	monitor_event FactionTurnStart FactionType tarascans
	and Treasury > 130000
	
		add_money tarascans -20000
	
	end_monitor
	
	monitor_event FactionTurnStart FactionType tlaxcalans
	and Treasury > 130000
	
		add_money tlaxcalans -20000
	
	end_monitor
	
	monitor_event FactionTurnStart FactionType aztecs
	and Treasury > 130000
	
		add_money aztecs -20000
	
	end_monitor
	
	;------------------------------------------------
	
	;----------For Debug AI - show all info about AI in the game ----------
	;------------ https://www.twcenter.net/forums/showthread.php?653352-Automatically-testing-your-mod-s-campaign&p=14394843&viewfull=1#post14394843 ---------------
	
	
	monitor_event RequestTrainingAdvice
		console_command toggle_fow
		console_command toggle_perfect_spy
	end_monitor
 
	;--------------------------------------
	
	

	;------------------- AI KINGS PURSE BONUS -------------------;
	;money granted to AI as they do not carry out missions

	monitor_event FactionTurnStart I_TurnNumber >= 0
		and CampaignDifficulty = easy
		
			if I_IsFactionAIControlled spain
				increment_kings_purse spain 500
			end_if
			
			if I_IsFactionAIControlled aztecs
				increment_kings_purse aztecs 250
			end_if
			
			if I_IsFactionAIControlled mayans
				increment_kings_purse mayans 200
			end_if
			
			if I_IsFactionAIControlled apachean
				increment_kings_purse apachean 250
			end_if
			
			if I_IsFactionAIControlled tarascans
				increment_kings_purse tarascans 2000
			end_if
			
			if I_IsFactionAIControlled tlaxcalans
				increment_kings_purse tlaxcalans 500
			end_if
			
			if I_IsFactionAIControlled chichimeca
				increment_kings_purse chichimeca 200
			end_if

			
			;;give player more money on easy
			if not I_IsFactionAIControlled spain
				increment_kings_purse spain 2000
			end_if
			
			if not I_IsFactionAIControlled aztecs
				increment_kings_purse aztecs 500
			end_if
			
			if not I_IsFactionAIControlled mayans
				increment_kings_purse mayans 500
			end_if
			
			if not I_IsFactionAIControlled apachean
				increment_kings_purse apachean 500
			end_if
			
			if not I_IsFactionAIControlled tarascans
				increment_kings_purse tarascans 1000
			end_if
			
			if not I_IsFactionAIControlled tlaxcalans
				increment_kings_purse tlaxcalans 1000
			end_if
			
			if not I_IsFactionAIControlled chichimeca
				increment_kings_purse chichimeca 1000
			end_if
			
		terminate_monitor
	end_monitor
	
	monitor_event FactionTurnStart I_TurnNumber >= 0
		and CampaignDifficulty = medium
		
			if I_IsFactionAIControlled spain
				increment_kings_purse spain 2500
			end_if
			
			if I_IsFactionAIControlled france
				increment_kings_purse france 1500
			end_if
			
			if I_IsFactionAIControlled england
				increment_kings_purse england 1500
			end_if
			
			if I_IsFactionAIControlled aztecs
				increment_kings_purse aztecs 1000
			end_if
			
			if I_IsFactionAIControlled mayans
				increment_kings_purse mayans 1000
			end_if
			
			if I_IsFactionAIControlled apachean
				increment_kings_purse apachean 500
			end_if
			
			if I_IsFactionAIControlled tarascans
				increment_kings_purse tarascans 1000
			end_if
			
			if I_IsFactionAIControlled tlaxcalans
				increment_kings_purse tlaxcalans 1500
			end_if
			
			if I_IsFactionAIControlled chichimeca
				increment_kings_purse chichimeca 1000
			end_if
			
		terminate_monitor
	end_monitor
	
	monitor_event FactionTurnStart I_TurnNumber >= 0
		and CampaignDifficulty = hard
		
			if I_IsFactionAIControlled spain
				increment_kings_purse spain 4000
			end_if
			
			if I_IsFactionAIControlled france
				increment_kings_purse france 2000
			end_if
			
			if I_IsFactionAIControlled england
				increment_kings_purse england 3000
			end_if
			
			if I_IsFactionAIControlled aztecs
				increment_kings_purse aztecs 4000
			end_if
			
			if I_IsFactionAIControlled mayans
				increment_kings_purse mayans 1000
			end_if
			
			if I_IsFactionAIControlled apachean
				increment_kings_purse apachean 2000
			end_if
			
			if I_IsFactionAIControlled tarascans
				increment_kings_purse tarascans 2500
			end_if
			
			if I_IsFactionAIControlled tlaxcalans
				increment_kings_purse tlaxcalans 3000
			end_if
			
			if I_IsFactionAIControlled chichimeca
				increment_kings_purse chichimeca 2500
			end_if
			
		terminate_monitor
	end_monitor
	
	monitor_event FactionTurnStart I_TurnNumber >= 0
		and CampaignDifficulty = very_hard
		
			if I_IsFactionAIControlled spain
				increment_kings_purse spain 6000
			end_if
			
			if I_IsFactionAIControlled france
				increment_kings_purse france 3000
			end_if
			
			if I_IsFactionAIControlled england
				increment_kings_purse england 4000
			end_if
			
			if I_IsFactionAIControlled aztecs
				increment_kings_purse aztecs 6000
			end_if
			
			if I_IsFactionAIControlled mayans
				increment_kings_purse mayans 2000
			end_if
			
			if I_IsFactionAIControlled apachean
				increment_kings_purse apachean 3000
			end_if
			
			if I_IsFactionAIControlled tarascans
				increment_kings_purse tarascans 3500
			end_if
			
			if I_IsFactionAIControlled tlaxcalans
				increment_kings_purse tlaxcalans 4000
			end_if
			
			if I_IsFactionAIControlled chichimeca
				increment_kings_purse chichimeca 3500
			end_if
			
		terminate_monitor
	end_monitor
	
	monitor_event FactionTurnStart FactionType aztecs
		and I_IsFactionAIControlled aztecs
	
		add_money aztecs 10000
		 	
		spawn_army 
			faction aztecs
			character	random_name, named character, age 46, x 78, y 36
			traits LoyaltyStarter 1 , GoodCommander 1 , ReligionStarter 1 
				unit		Aztec Bodyguard				exp 1 armour 0 weapon_lvl 0
				unit		Coyote Priests				exp 1 armour 0 weapon_lvl 0
				unit		Cuahchiqueh				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Eagle Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Eagle Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Jaguar Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Jaguar Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Arrow Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Arrow Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Spearmen				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Spearmen				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Archers				exp 0 armour 0 weapon_lvl 0
				unit		Aztec Archers				exp 0 armour 0 weapon_lvl 0
				unit		Aztec Spear Throwers				exp 0 armour 0 weapon_lvl 0
				unit		Aztec Spear Throwers				exp 0 armour 0 weapon_lvl 0
		end

		spawn_army 
			faction aztecs
			character	random_name, named character, age 32, x 97, y 25
			traits LoyaltyStarter 1 , GoodCommander 1 , ReligionStarter 1 
				unit		Aztec Bodyguard				exp 1 armour 0 weapon_lvl 0
				unit		Coyote Priests				exp 1 armour 0 weapon_lvl 0
				unit		Cuahchiqueh				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Eagle Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Eagle Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Jaguar Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Jaguar Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Arrow Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Arrow Warriors				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Spearmen				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Spearmen				exp 1 armour 0 weapon_lvl 0
				unit		Aztec Archers				exp 0 armour 0 weapon_lvl 0
				unit		Aztec Archers				exp 0 armour 0 weapon_lvl 0
				unit		Aztec Spear Throwers				exp 0 armour 0 weapon_lvl 0
				unit		Aztec Spear Throwers				exp 0 armour 0 weapon_lvl 0
		end

		terminate_monitor
	end_monitor
	
	;========================================================
;===================== G5 BAI STUFF =====================
;========================================================

;### Germanicu5 ReallyBadAI Battle System Scrips v5.x
;### This file contains manually programmed AI behaviour eliminating previously unfixable, hardcoded bugs and greatly influences battle performance
;### Support available at http://www.twcenter.net/forums/forumdisplay.php?f=1745 , http://www.twcenter.net/forums/showthread.php?t=257970 and http://www.twcenter.net/forums/showthread.php?t=253132
;### Non-private use of code only by permission,
;### coded by Germanicu5

;;;;;;;Print Info
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
monitor_event GameReloaded
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
end_monitor

;;;;;;;
declare_counter g5_battle_difficulty_high
;;;;;;;
declare_counter fire_labels
declare_counter panel_check
declare_counter player_unit_count
declare_counter enemy_unit_count
declare_counter open_battle
declare_counter labels_only
declare_counter stakes_lock
;;;;;;;
declare_counter pu1_missile
declare_counter pu2_missile
declare_counter pu3_missile
declare_counter pu4_missile
declare_counter pu5_missile
declare_counter pu6_missile
declare_counter pu7_missile
declare_counter pu8_missile
declare_counter pu9_missile
declare_counter pu10_missile
declare_counter pu11_missile
declare_counter pu12_missile
declare_counter pu13_missile
declare_counter pu14_missile
declare_counter pu15_missile
declare_counter pu16_missile
declare_counter pu17_missile
declare_counter pu18_missile
declare_counter pu19_missile
declare_counter pu20_missile
;;;;;;;Checks
declare_counter check_timer
declare_counter elephant_fix_check
declare_counter elephant_fix_check_sally
declare_counter script_delay
declare_counter reinf_check
declare_counter sally_defense_check
declare_counter sally_check
;;;;;;;Stakes
declare_counter label_ready
declare_counter stakes_on
;;;;;;;Reinforcements
declare_counter army4_ready
declare_counter reinf_late

declare_counter distance_trigger1
declare_counter distance_trigger2
declare_counter distance_trigger3
declare_counter distance_trigger4
declare_counter distance_trigger5

declare_counter kill_labelling_reinf_allied
declare_counter army3_reinf_allied
declare_counter army4_reinf_allied
declare_counter army5_reinf_allied
declare_counter army6_reinf_allied
declare_counter army7_reinf_allied
declare_counter army8_reinf_allied
declare_counter army9_reinf_allied
declare_counter army10_reinf_allied
declare_counter army11_reinf_allied
declare_counter army12_reinf_allied
declare_counter army13_reinf_allied
declare_counter army14_reinf_allied
declare_counter army15_reinf_allied
declare_counter army16_reinf_allied
declare_counter launch_alliance_0
declare_counter launch_alliance_1

declare_counter apply_strategy
declare_counter relaunch_movement

declare_counter att_alliance_ready
declare_counter def_alliance_ready
declare_counter def_alliance_ready_siege

declare_counter army3_moving
declare_counter army3_run
declare_counter army3_reinf_late
declare_counter army4_moving
declare_counter army4_run
declare_counter army4_reinf_late
declare_counter army5_moving
declare_counter army5_run
declare_counter army5_reinf_late
declare_counter army6_moving
declare_counter army6_run
declare_counter army6_reinf_late
declare_counter army7_moving
declare_counter army7_run
declare_counter army7_reinf_late
declare_counter army8_moving
declare_counter army8_run
declare_counter army8_reinf_late
declare_counter army9_moving
declare_counter army9_run
declare_counter army9_reinf_late
declare_counter army10_moving
declare_counter army10_run
declare_counter army10_reinf_late
declare_counter army11_moving
declare_counter army11_run
declare_counter army11_reinf_late
declare_counter army12_moving
declare_counter army12_run
declare_counter army12_reinf_late
declare_counter army13_moving
declare_counter army13_run
declare_counter army13_reinf_late
declare_counter army14_moving
declare_counter army14_run
declare_counter army14_reinf_late
declare_counter army15_moving
declare_counter army15_run
declare_counter army15_reinf_late
declare_counter army16_moving
declare_counter army16_run
declare_counter army16_reinf_late

declare_counter army4_ready_siege ; acts as launching counter
declare_counter army4_moving_siege
declare_counter army4_run_siege
declare_counter reinf_check_interval

;;;;;;;HA Fix
declare_counter ha_fix
;;;;;;;Elephant Fix
declare_counter elephant_fix
declare_counter elephant_gate
declare_counter elephant_gate_s
declare_counter elephant_gate_tier2
declare_counter elephant_gate_tier3
declare_counter elephant_gate_tier2s
declare_counter elephant_gate_tier3s
declare_counter rally_walls
declare_counter rally_walls_s
declare_counter second_ring
declare_counter third_ring
declare_counter second_ring_s
declare_counter third_ring_s
declare_counter del_objective
declare_counter del_objective_s
;;;;;;;Sally-out
declare_counter sally-out_fix
declare_counter sally_defense
declare_counter reform_back
declare_counter reform_multi
declare_counter unit_under_fire
declare_counter kill_sally
declare_counter sally_reinf
declare_counter reset_position
declare_counter defend_location
declare_counter reset_army2
declare_counter assign_labels
;;;;;;;Siege
declare_counter siege_fix
declare_counter army_sieging
declare_counter army_south
declare_counter army_north
declare_counter army_east
declare_counter army_west
declare_counter emergency_stop
declare_counter omfg_cannon_tower
declare_counter army2_sally
declare_counter wall_advance_s
;;;;;;;Protect General
declare_counter protect_general
declare_counter general_wait
declare_counter protect_siege
declare_counter g_stop
;;;;;;;Sally-out, AI defending
declare_counter army4_ready_sally
declare_counter army4_location
declare_counter path_n
declare_counter path_ne
declare_counter path_e
declare_counter path_se
declare_counter path_s
declare_counter path_sw
declare_counter path_w
declare_counter path_nw
declare_counter obstacle_check
declare_counter label_army4
declare_counter army4_moving_s
declare_counter army4_idle_s
declare_counter line_passed
declare_counter army2_idle_s
declare_counter army4_idle_r
declare_counter wall_line_passed
declare_counter reset_position_s
declare_counter repeat_test1
declare_counter repeat_test2
declare_counter repeat_test3
declare_counter repeat_test4
declare_counter repeat_test5
declare_counter repeat_test6
;;;;;;;Open Battles
declare_counter ob_defense_launch
declare_counter ob_defend
declare_counter ob_siege_attack
declare_counter ob_under_fire
declare_counter ob_repeat_test
declare_counter ob_engaged
declare_counter player_units_closing
declare_counter player_enveloping
declare_counter player_engaged_reinf
;;;;;;;AI Stuck Fix
declare_counter ai_stuck_launch
declare_counter a2u1_stuck
declare_counter a2u2_stuck
declare_counter a2u3_stuck
declare_counter a2u4_stuck
declare_counter a2u5_stuck
declare_counter a2u6_stuck
declare_counter a2u7_stuck
declare_counter a2u8_stuck
declare_counter a2u9_stuck
declare_counter a2u10_stuck
declare_counter a2u11_stuck
declare_counter a2u12_stuck
declare_counter a2u13_stuck
declare_counter a2u14_stuck
declare_counter a2u15_stuck
declare_counter a2u16_stuck
declare_counter a2u17_stuck
declare_counter a2u18_stuck
declare_counter a2u19_stuck
declare_counter a2u20_stuck
declare_counter a2u1_status
declare_counter a2u2_status
declare_counter a2u3_status
declare_counter a2u4_status
declare_counter a2u5_status
declare_counter a2u6_status
declare_counter a2u7_status
declare_counter a2u8_status
declare_counter a2u9_status
declare_counter a2u10_status
declare_counter a2u11_status
declare_counter a2u12_status
declare_counter a2u13_status
declare_counter a2u14_status
declare_counter a2u15_status
declare_counter a2u16_status
declare_counter a2u17_status
declare_counter a2u18_status
declare_counter a2u19_status
declare_counter a2u20_status
declare_counter a2u1_distance
declare_counter a2u2_distance
declare_counter a2u3_distance
declare_counter a2u4_distance
declare_counter a2u5_distance
declare_counter a2u6_distance
declare_counter a2u7_distance
declare_counter a2u8_distance
declare_counter a2u9_distance
declare_counter a2u10_distance
declare_counter a2u11_distance
declare_counter a2u12_distance
declare_counter a2u13_distance
declare_counter a2u14_distance
declare_counter a2u15_distance
declare_counter a2u16_distance
declare_counter a2u17_distance
declare_counter a2u18_distance
declare_counter a2u19_distance
declare_counter a2u20_distance
;;;;;;;
set_event_counter no_advice 1

monitor_event PreFactionTurnStart FactionIsLocal
    and BattleDifficulty > medium

    set_counter g5_battle_difficulty_high 1
    terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral ! FactionIsLocal
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event GeneralAssaultsResidence TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsResidence ! FactionIsLocal
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event ButtonPressed ButtonPressed prebattle_fight_button
    and I_CompareCounter panel_check = 1

;    suspend_unscripted_advice true
    set_counter fire_labels 10
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
    prepare_for_battle
end_monitor

monitor_conditions I_InBattle
    and I_CompareCounter fire_labels = 10

    set_counter fire_labels 0
    battle_wait 0.1

    if ! I_BattleIsSiegeBattle
    set_counter fire_labels 1
    end_if

    if I_BattleIsSiegeBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter fire_labels 1
    end_if

if I_BattlePlayerArmyIsAttacker

    ;;;Army 1
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    ;;;Army 2
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_BattlePlayerArmyIsAttacker

    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if
if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 1
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ;;;Army 2
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a1u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a1u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a1u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a1u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a1u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a1u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a1u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a1u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a1u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a1u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a1u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a1u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a1u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a1u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a1u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a1u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a1u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a1u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a1u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a1u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if ! I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a2u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a2u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a2u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a2u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a2u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a2u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a2u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a2u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a2u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a2u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a2u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a2u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a2u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a2u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a2u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a2u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a2u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a2u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a2u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a2u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
;    battle_wait 0.1
;    ai_active_set off
    battle_wait 0.1
    ai_active_set on
    set_counter labels_only 1

    if I_BattleIsSiegeBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter ai_stuck_launch 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattlePlayerArmyNumberOfAttribute stakes > 0
    set_counter stakes_lock 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    set_counter protect_siege 1
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    set_counter open_battle 1
    end_if

if I_CompareCounter fire_labels = 1
    if I_BattleIsSiegeBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    label_location -470, -470, sw
    label_location 470, -470, se
    label_location -470, 470, nw
    label_location 470, 470, ne
    label_location -400, -400, sw_wall
    label_location 400, -400, se_wall
    label_location -400, 400, nw_wall
    label_location 400, 400, ne_wall
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side < -200
    set_counter army_west 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side < -200
    set_counter army_west 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally-out_fix 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter siege_fix 1
    end_if

    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_BattleIsSiegeBattle
    set_counter elephant_fix 1
    end_if

end_if
end_monitor

monitor_event BattleConflictPhaseCommenced FactionIsLocal
    and I_CompareCounter panel_check = 1

    set_counter script_delay 1
    battle_wait 15
    if I_CompareCounter script_delay = 1

    if I_CompareCounter fire_labels = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_CompareCounter fire_labels = 1
    if I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and ! I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1
    ai_gta_plan_set 1 DEFEND_FEATURE
    battle_wait 1
    ai_active_set on
    set_counter ob_defense_launch 1
    end_if
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    and I_BattleEnemyArmyNumberOfUnits > 2
    set_counter g_stop 1
    end_if

    if I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter fire_labels = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally_defense 1
    set_counter assign_labels 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_CompareCounter open_battle = 1
    set_counter ha_fix 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter ha_fix 1
    end_if
    set_counter script_delay 0
    end_if
end_monitor

monitor_event BattleReinforcementsArrive ! ArmyIsLocal
    and I_CompareCounter panel_check = 1
    and I_CompareCounter fire_labels = 1

    set_counter reinf_check 1
    battle_wait 15
if I_CompareCounter reinf_check = 1
    set_counter reinf_check 2
    battle_wait 15
if I_CompareCounter reinf_check = 2
    set_counter reinf_check 3
    battle_wait 15
if I_CompareCounter reinf_check = 3
 if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 3
    label_unit 0 1 0 a3u1
    define_unit_group army3a a3u1
    if ! I_PercentageUnitGroupKilled army3a = 100
    undefine_unit_group army3a
    ;;;Army 3
    label_unit 0 1 0 a3u1
    label_unit 0 1 1 a3u2
    label_unit 0 1 2 a3u3
    label_unit 0 1 3 a3u4
    label_unit 0 1 4 a3u5
    label_unit 0 1 5 a3u6
    label_unit 0 1 6 a3u7
    label_unit 0 1 7 a3u8
    label_unit 0 1 8 a3u9
    label_unit 0 1 9 a3u10
    label_unit 0 1 10 a3u11
    label_unit 0 1 11 a3u12
    label_unit 0 1 12 a3u13
    label_unit 0 1 13 a3u14
    label_unit 0 1 14 a3u15
    label_unit 0 1 15 a3u16
    label_unit 0 1 16 a3u17
    label_unit 0 1 17 a3u18
    label_unit 0 1 18 a3u19
    label_unit 0 1 19 a3u20

    define_unit_group army3 a3u1 a3u2 a3u3 a3u4 a3u5 a3u6 a3u7 a3u8 a3u9 a3u10 a3u11 a3u12 a3u13 a3u14 a3u15 a3u16 a3u17 a3u18 a3u19 a3u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker

    ;;;Army 4
    label_unit 1 1 0 a4u1
    define_unit_group army4a a4u1
    if ! I_PercentageUnitGroupKilled army4a = 100
    undefine_unit_group army4a
    ;;;Army 4
    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

    define_unit_group army4 a4u1 a4u2 a4u3 a4u4 a4u5 a4u6 a4u7 a4u8 a4u9 a4u10 a4u11 a4u12 a4u13 a4u14 a4u15 a4u16 a4u17 a4u18 a4u19 a4u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army3 = 100
    set_counter army3_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army4 = 100
    set_counter army4_reinf_allied 1
    end_if

    if I_PercentageUnitGroupKilled army3 = 100
    and I_PercentageUnitGroupKilled army4 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

if ! I_BattleIsSallyOutBattle

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 5
    label_unit 0 2 0 a5u1
    define_unit_group army5a a5u1
    if ! I_PercentageUnitGroupKilled army5a = 100
    undefine_unit_group army5a
    ;;;Army 5
    label_unit 0 2 0 a5u1
    label_unit 0 2 1 a5u2
    label_unit 0 2 2 a5u3
    label_unit 0 2 3 a5u4
    label_unit 0 2 4 a5u5
    label_unit 0 2 5 a5u6
    label_unit 0 2 6 a5u7
    label_unit 0 2 7 a5u8
    label_unit 0 2 8 a5u9
    label_unit 0 2 9 a5u10
    label_unit 0 2 10 a5u11
    label_unit 0 2 11 a5u12
    label_unit 0 2 12 a5u13
    label_unit 0 2 13 a5u14
    label_unit 0 2 14 a5u15
    label_unit 0 2 15 a5u16
    label_unit 0 2 16 a5u17
    label_unit 0 2 17 a5u18
    label_unit 0 2 18 a5u19
    label_unit 0 2 19 a5u20

    define_unit_group army5 a5u1 a5u2 a5u3 a5u4 a5u5 a5u6 a5u7 a5u8 a5u9 a5u10 a5u11 a5u12 a5u13 a5u14 a5u15 a5u16 a5u17 a5u18 a5u19 a5u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
    ;;;Army 6
    label_unit 1 2 0 a6u1
    define_unit_group army6a a6u1
    if ! I_PercentageUnitGroupKilled army6a = 100
    undefine_unit_group army6a 	
    ;;;Army 6
    label_unit 1 2 0 a6u1
    label_unit 1 2 1 a6u2
    label_unit 1 2 2 a6u3
    label_unit 1 2 3 a6u4
    label_unit 1 2 4 a6u5
    label_unit 1 2 5 a6u6
    label_unit 1 2 6 a6u7
    label_unit 1 2 7 a6u8
    label_unit 1 2 8 a6u9
    label_unit 1 2 9 a6u10
    label_unit 1 2 10 a6u11
    label_unit 1 2 11 a6u12
    label_unit 1 2 12 a6u13
    label_unit 1 2 13 a6u14
    label_unit 1 2 14 a6u15
    label_unit 1 2 15 a6u16
    label_unit 1 2 16 a6u17
    label_unit 1 2 17 a6u18
    label_unit 1 2 18 a6u19
    label_unit 1 2 19 a6u20

    define_unit_group army6 a6u1 a6u2 a6u3 a6u4 a6u5 a6u6 a6u7 a6u8 a6u9 a6u10 a6u11 a6u12 a6u13 a6u14 a6u15 a6u16 a6u17 a6u18 a6u19 a6u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army5 = 100
    set_counter army5_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army6 = 100
    set_counter army6_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army5 = 100
    and I_PercentageUnitGroupKilled army6 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 7
    label_unit 0 3 0 a7u1
    define_unit_group army7a a7u1
    if ! I_PercentageUnitGroupKilled army7a = 100
    undefine_unit_group army7a 	
    ;;;Army 7
    label_unit 0 3 0 a7u1
    label_unit 0 3 1 a7u2
    label_unit 0 3 2 a7u3
    label_unit 0 3 3 a7u4
    label_unit 0 3 4 a7u5
    label_unit 0 3 5 a7u6
    label_unit 0 3 6 a7u7
    label_unit 0 3 7 a7u8
    label_unit 0 3 8 a7u9
    label_unit 0 3 9 a7u10
    label_unit 0 3 10 a7u11
    label_unit 0 3 11 a7u12
    label_unit 0 3 12 a7u13
    label_unit 0 3 13 a7u14
    label_unit 0 3 14 a7u15
    label_unit 0 3 15 a7u16
    label_unit 0 3 16 a7u17
    label_unit 0 3 17 a7u18
    label_unit 0 3 18 a7u19
    label_unit 0 3 19 a7u20

    define_unit_group army7 a7u1 a7u2 a7u3 a7u4 a7u5 a7u6 a7u7 a7u8 a7u9 a7u10 a7u11 a7u12 a7u13 a7u14 a7u15 a7u16 a7u17 a7u18 a7u19 a7u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    define_unit_group army8a a8u1
    if ! I_PercentageUnitGroupKilled army8a = 100
    undefine_unit_group army8a 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    label_unit 1 3 1 a8u2
    label_unit 1 3 2 a8u3
    label_unit 1 3 3 a8u4
    label_unit 1 3 4 a8u5
    label_unit 1 3 5 a8u6
    label_unit 1 3 6 a8u7
    label_unit 1 3 7 a8u8
    label_unit 1 3 8 a8u9
    label_unit 1 3 9 a8u10
    label_unit 1 3 10 a8u11
    label_unit 1 3 11 a8u12
    label_unit 1 3 12 a8u13
    label_unit 1 3 13 a8u14
    label_unit 1 3 14 a8u15
    label_unit 1 3 15 a8u16
    label_unit 1 3 16 a8u17
    label_unit 1 3 17 a8u18
    label_unit 1 3 18 a8u19
    label_unit 1 3 19 a8u20

    define_unit_group army8 a8u1 a8u2 a8u3 a8u4 a8u5 a8u6 a8u7 a8u8 a8u9 a8u10 a8u11 a8u12 a8u13 a8u14 a8u15 a8u16 a8u17 a8u18 a8u19 a8u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army7 = 100
    set_counter army7_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army8 = 100
    set_counter army8_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army7 = 100
    and I_PercentageUnitGroupKilled army8 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 9
    label_unit 0 4 0 a9u1
    define_unit_group army9a a9u1
    if ! I_PercentageUnitGroupKilled army9a = 100
    undefine_unit_group army9a 	
    ;;;Army 9
    label_unit 0 4 0 a9u1
    label_unit 0 4 1 a9u2
    label_unit 0 4 2 a9u3
    label_unit 0 4 3 a9u4
    label_unit 0 4 4 a9u5
    label_unit 0 4 5 a9u6
    label_unit 0 4 6 a9u7
    label_unit 0 4 7 a9u8
    label_unit 0 4 8 a9u9
    label_unit 0 4 9 a9u10
    label_unit 0 4 10 a9u11
    label_unit 0 4 11 a9u12
    label_unit 0 4 12 a9u13
    label_unit 0 4 13 a9u14
    label_unit 0 4 14 a9u15
    label_unit 0 4 15 a9u16
    label_unit 0 4 16 a9u17
    label_unit 0 4 17 a9u18
    label_unit 0 4 18 a9u19
    label_unit 0 4 19 a9u20

    define_unit_group army9 a9u1 a9u2 a9u3 a9u4 a9u5 a9u6 a9u7 a9u8 a9u9 a9u10 a9u11 a9u12 a9u13 a9u14 a9u15 a9u16 a9u17 a9u18 a9u19 a9u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    define_unit_group army10a a10u1
    if ! I_PercentageUnitGroupKilled army10a = 100
    undefine_unit_group army10a 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    label_unit 1 4 1 a10u2
    label_unit 1 4 2 a10u3
    label_unit 1 4 3 a10u4
    label_unit 1 4 4 a10u5
    label_unit 1 4 5 a10u6
    label_unit 1 4 6 a10u7
    label_unit 1 4 7 a10u8
    label_unit 1 4 8 a10u9
    label_unit 1 4 9 a10u10
    label_unit 1 4 10 a10u11
    label_unit 1 4 11 a10u12
    label_unit 1 4 12 a10u13
    label_unit 1 4 13 a10u14
    label_unit 1 4 14 a10u15
    label_unit 1 4 15 a10u16
    label_unit 1 4 16 a10u17
    label_unit 1 4 17 a10u18
    label_unit 1 4 18 a10u19
    label_unit 1 4 19 a10u20

    define_unit_group army10 a10u1 a10u2 a10u3 a10u4 a10u5 a10u6 a10u7 a10u8 a10u9 a10u10 a10u11 a10u12 a10u13 a10u14 a10u15 a10u16 a10u17 a10u18 a10u19 a10u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army9 = 100
    set_counter army9_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army10 = 100
    set_counter army10_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army9 = 100
    and I_PercentageUnitGroupKilled army10 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 11
    label_unit 0 5 0 a11u1
    define_unit_group army11a a11u1
    if ! I_PercentageUnitGroupKilled army11a = 100
    undefine_unit_group army11a 	
    ;;;Army 11
    label_unit 0 5 0 a11u1
    label_unit 0 5 1 a11u2
    label_unit 0 5 2 a11u3
    label_unit 0 5 3 a11u4
    label_unit 0 5 4 a11u5
    label_unit 0 5 5 a11u6
    label_unit 0 5 6 a11u7
    label_unit 0 5 7 a11u8
    label_unit 0 5 8 a11u9
    label_unit 0 5 9 a11u10
    label_unit 0 5 10 a11u11
    label_unit 0 5 11 a11u12
    label_unit 0 5 12 a11u13
    label_unit 0 5 13 a11u14
    label_unit 0 5 14 a11u15
    label_unit 0 5 15 a11u16
    label_unit 0 5 16 a11u17
    label_unit 0 5 17 a11u18
    label_unit 0 5 18 a11u19
    label_unit 0 5 19 a11u20

    define_unit_group army11 a11u1 a11u2 a11u3 a11u4 a11u5 a11u6 a11u7 a11u8 a11u9 a11u10 a11u11 a11u12 a11u13 a11u14 a11u15 a11u16 a11u17 a11u18 a11u19 a11u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    define_unit_group army12a a12u1
    if ! I_PercentageUnitGroupKilled army12a = 100
    undefine_unit_group army12a 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    label_unit 1 5 1 a12u2
    label_unit 1 5 2 a12u3
    label_unit 1 5 3 a12u4
    label_unit 1 5 4 a12u5
    label_unit 1 5 5 a12u6
    label_unit 1 5 6 a12u7
    label_unit 1 5 7 a12u8
    label_unit 1 5 8 a12u9
    label_unit 1 5 9 a12u10
    label_unit 1 5 10 a12u11
    label_unit 1 5 11 a12u12
    label_unit 1 5 12 a12u13
    label_unit 1 5 13 a12u14
    label_unit 1 5 14 a12u15
    label_unit 1 5 15 a12u16
    label_unit 1 5 16 a12u17
    label_unit 1 5 17 a12u18
    label_unit 1 5 18 a12u19
    label_unit 1 5 19 a12u20

    define_unit_group army12 a12u1 a12u2 a12u3 a12u4 a12u5 a12u6 a12u7 a12u8 a12u9 a12u10 a12u11 a12u12 a12u13 a12u14 a12u15 a12u16 a12u17 a12u18 a12u19 a12u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army11 = 100
    set_counter army11_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army12 = 100
    set_counter army12_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army11 = 100
    and I_PercentageUnitGroupKilled army12 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 13
    label_unit 0 6 0 a13u1
    define_unit_group army13a a13u1
    if ! I_PercentageUnitGroupKilled army13a = 100
    undefine_unit_group army13a 	
    ;;;Army 13
    label_unit 0 6 0 a13u1
    label_unit 0 6 1 a13u2
    label_unit 0 6 2 a13u3
    label_unit 0 6 3 a13u4
    label_unit 0 6 4 a13u5
    label_unit 0 6 5 a13u6
    label_unit 0 6 6 a13u7
    label_unit 0 6 7 a13u8
    label_unit 0 6 8 a13u9
    label_unit 0 6 9 a13u10
    label_unit 0 6 10 a13u11
    label_unit 0 6 11 a13u12
    label_unit 0 6 12 a13u13
    label_unit 0 6 13 a13u14
    label_unit 0 6 14 a13u15
    label_unit 0 6 15 a13u16
    label_unit 0 6 16 a13u17
    label_unit 0 6 17 a13u18
    label_unit 0 6 18 a13u19
    label_unit 0 6 19 a13u20

    define_unit_group army13 a13u1 a13u2 a13u3 a13u4 a13u5 a13u6 a13u7 a13u8 a13u9 a13u10 a13u11 a13u12 a13u13 a13u14 a13u15 a13u16 a13u17 a13u18 a13u19 a13u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    define_unit_group army14a a14u1
    if ! I_PercentageUnitGroupKilled army14a = 100
    undefine_unit_group army14a 	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    label_unit 1 6 1 a14u2
    label_unit 1 6 2 a14u3
    label_unit 1 6 3 a14u4
    label_unit 1 6 4 a14u5
    label_unit 1 6 5 a14u6
    label_unit 1 6 6 a14u7
    label_unit 1 6 7 a14u8
    label_unit 1 6 8 a14u9
    label_unit 1 6 9 a14u10
    label_unit 1 6 10 a14u11
    label_unit 1 6 11 a14u12
    label_unit 1 6 12 a14u13
    label_unit 1 6 13 a14u14
    label_unit 1 6 14 a14u15
    label_unit 1 6 15 a14u16
    label_unit 1 6 16 a14u17
    label_unit 1 6 17 a14u18
    label_unit 1 6 18 a14u19
    label_unit 1 6 19 a14u20

    define_unit_group army14 a14u1 a14u2 a14u3 a14u4 a14u5 a14u6 a14u7 a14u8 a14u9 a14u10 a14u11 a14u12 a14u13 a14u14 a14u15 a14u16 a14u17 a14u18 a14u19 a14u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army13 = 100
    set_counter army13_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army14 = 100
    set_counter army14_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army13 = 100
    and I_PercentageUnitGroupKilled army14 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 15
    label_unit 0 7 0 a15u1
    define_unit_group army15a a15u1
    if ! I_PercentageUnitGroupKilled army15a = 100
    undefine_unit_group army15a 	
    ;;;Army 15
    label_unit 0 7 0 a15u1
    label_unit 0 7 1 a15u2
    label_unit 0 7 2 a15u3
    label_unit 0 7 3 a15u4
    label_unit 0 7 4 a15u5
    label_unit 0 7 5 a15u6
    label_unit 0 7 6 a15u7
    label_unit 0 7 7 a15u8
    label_unit 0 7 8 a15u9
    label_unit 0 7 9 a15u10
    label_unit 0 7 10 a15u11
    label_unit 0 7 11 a15u12
    label_unit 0 7 12 a15u13
    label_unit 0 7 13 a15u14
    label_unit 0 7 14 a15u15
    label_unit 0 7 15 a15u16
    label_unit 0 7 16 a15u17
    label_unit 0 7 17 a15u18
    label_unit 0 7 18 a15u19
    label_unit 0 7 19 a15u20

    define_unit_group army15 a15u1 a15u2 a15u3 a15u4 a15u5 a15u6 a15u7 a15u8 a15u9 a15u10 a15u11 a15u12 a15u13 a15u14 a15u15 a15u16 a15u17 a15u18 a15u19 a15u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    define_unit_group army16a a16u1
    if ! I_PercentageUnitGroupKilled army16a = 100
    undefine_unit_group army16a 	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    label_unit 1 7 1 a16u2
    label_unit 1 7 2 a16u3
    label_unit 1 7 3 a16u4
    label_unit 1 7 4 a16u5
    label_unit 1 7 5 a16u6
    label_unit 1 7 6 a16u7
    label_unit 1 7 7 a16u8
    label_unit 1 7 8 a16u9
    label_unit 1 7 9 a16u10
    label_unit 1 7 10 a16u11
    label_unit 1 7 11 a16u12
    label_unit 1 7 12 a16u13
    label_unit 1 7 13 a16u14
    label_unit 1 7 14 a16u15
    label_unit 1 7 15 a16u16
    label_unit 1 7 16 a16u17
    label_unit 1 7 17 a16u18
    label_unit 1 7 18 a16u19
    label_unit 1 7 19 a16u20

    define_unit_group army16 a16u1 a16u2 a16u3 a16u4 a16u5 a16u6 a16u7 a16u8 a16u9 a16u10 a16u11 a16u12 a16u13 a16u14 a16u15 a16u16 a16u17 a16u18 a16u19 a16u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army15 = 100
    set_counter army15_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army16 = 100
    set_counter army16_reinf_allied 1
    end_if
end_if

end_if
battle_wait 0.5
ai_active_set on

;;;;;;;Reinforcements

    ;;;;;;; Attacking
    if ! I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and ! I_BattleIsSiegeBattle
    and I_CompareCounter army3_reinf_allied = 1

    set_counter apply_strategy 1
;    battle_wait 1
;    set_counter att_alliance_ready 1
    end_if

    ;;;;;;; Defending
    if I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and I_CompareCounter army4_reinf_allied = 1

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    set_counter army4_ready 1
    set_counter def_alliance_ready 1
    end_if
    if ! I_BattleIsSiegeBattle
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 1
    set_counter sally_reinf 1
    end_if

    ;;;;;;; Siege
    if I_BattleIsSiegeBattle
    set_counter def_alliance_ready_siege 1
    end_if
    end_if
end_if
end_if
end_if
end_monitor

;Apply Strategy

monitor_conditions I_BattleStarted
    and I_CompareCounter apply_strategy = 1

if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 0 ATTACK_ALL
    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_0 1
end_if

if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 1 ATTACK_ALL
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_1 1
end_if

if I_CompareCounter launch_alliance_0 = 1
    and I_CompareCounter army3_reinf_allied = 1

    ;;;Army 1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u20
    ;;;Army 3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u20
if I_CompareCounter army5_reinf_allied = 1
    ;;;Army 5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u20
if I_CompareCounter army7_reinf_allied = 1
    ;;;Army 7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u20
if I_CompareCounter army9_reinf_allied = 1
     ;;;Army 9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u20
if I_CompareCounter army11_reinf_allied = 1
    ;;;Army 11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u20
if I_CompareCounter army13_reinf_allied = 1
    ;;;Army 13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u20
if I_CompareCounter army15_reinf_allied = 1
    ;;;Army 15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if

if I_CompareCounter launch_alliance_1 = 1
    and I_CompareCounter army4_reinf_allied = 1

    ;;;Army 2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u20
    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20
if I_CompareCounter army6_reinf_allied = 1
    ;;;Army 6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u20
if I_CompareCounter army8_reinf_allied = 1
    ;;;Army 8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u20
if I_CompareCounter army10_reinf_allied = 1
     ;;;Army 10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u20
if I_CompareCounter army12_reinf_allied = 1
    ;;;Army 12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u20
if I_CompareCounter army14_reinf_allied = 1
    ;;;Army 14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u20
if I_CompareCounter army16_reinf_allied = 1
    ;;;Army 16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if
battle_wait 0.5
ai_active_set on
set_counter apply_strategy 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter relaunch_movement = 1

    ai_active_set on
    battle_wait 0.5
    set_counter army3_moving 0
    set_counter army4_moving 0
    set_counter army5_moving 0
    set_counter army6_moving 0
    set_counter army7_moving 0
    set_counter army8_moving 0
    set_counter army9_moving 0
    set_counter army10_moving 0
    set_counter army11_moving 0
    set_counter army12_moving 0
    set_counter army13_moving 0
    set_counter army14_moving 0
    set_counter army15_moving 0
    set_counter army16_moving 0

    battle_wait 5
    set_counter relaunch_movement 0
end_monitor

;;;;;;; Attacking

monitor_conditions I_BattleStarted
    and I_CompareCounter att_alliance_ready = 1
    and ! I_BattlePlayerArmyIsAttacker
 ;    inc_counter reinf_check_interval 1
 if I_CompareCounter army3_reinf_allied = 1

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army3_moving 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and I_UnitDistanceFromUnit a1u1 a3u1 > 150
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_late 1
    battle_wait 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 0
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 1000

    set_counter army3_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 750

    set_counter army3_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 500

    set_counter army3_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 300

    set_counter army3_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 200

    set_counter army3_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    battle_wait 0.5
    set_counter army3_moving 1
    set_counter army3_reinf_late 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a3u1 > 60

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitGroupKilled army3 > 50

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army3 a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitUnderFire a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_run = 1

;    unit_group_order_halt army3
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army3 a1u1 run
    battle_wait 0.5
    set_counter army3_run 0
    end_if

end_if

if I_CompareCounter army5_reinf_allied = 1

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army5_moving 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and I_UnitDistanceFromUnit a1u1 a5u1 > 150
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_late 1
    battle_wait 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 0
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 1000

    set_counter army5_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 750

    set_counter army5_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 500

    set_counter army5_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 300

    set_counter army5_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 200

    set_counter army5_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    battle_wait 0.5
    set_counter army5_moving 1
    set_counter army5_reinf_late 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a5u1 > 60

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitGroupKilled army5 > 50

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army5 a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitUnderFire a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_run = 1

;    unit_group_order_halt army5
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army5 a1u1 run
    battle_wait 0.5
    set_counter army5_run 0
    end_if

end_if

if I_CompareCounter army7_reinf_allied = 1

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army7_moving 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and I_UnitDistanceFromUnit a1u1 a7u1 > 150
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_late 1
    battle_wait 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 0
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 1000

    set_counter army7_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 750

    set_counter army7_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 500

    set_counter army7_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 300

    set_counter army7_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 200

    set_counter army7_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    battle_wait 0.5
    set_counter army7_moving 1
    set_counter army7_reinf_late 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a7u1 > 60

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitGroupKilled army7 > 50

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army7 a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitUnderFire a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_run = 1

;    unit_group_order_halt army7
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army7 a1u1 run
    battle_wait 0.5
    set_counter army7_run 0
    end_if

end_if

if I_CompareCounter army9_reinf_allied = 1

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army9_moving 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and I_UnitDistanceFromUnit a1u1 a9u1 > 150
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_late 1
    battle_wait 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 0
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 1000

    set_counter army9_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 750

    set_counter army9_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 500

    set_counter army9_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 300

    set_counter army9_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 200

    set_counter army9_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    battle_wait 0.5
    set_counter army9_moving 1
    set_counter army9_reinf_late 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a9u1 > 60

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitGroupKilled army9 > 50

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army9 a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitUnderFire a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_run = 1

;    unit_group_order_halt army9
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army9 a1u1 run
    battle_wait 0.5
    set_counter army9_run 0
    end_if

end_if

if I_CompareCounter army11_reinf_allied = 1

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army11_moving 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and I_UnitDistanceFromUnit a1u1 a11u1 > 150
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_late 1
    battle_wait 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 0
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 1000

    set_counter army11_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 750

    set_counter army11_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 500

    set_counter army11_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 300

    set_counter army11_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 200

    set_counter army11_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    battle_wait 0.5
    set_counter army11_moving 1
    set_counter army11_reinf_late 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a11u1 > 60

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitGroupKilled army11 > 50

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army11 a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitUnderFire a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_run = 1

;    unit_group_order_halt army11
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army11 a1u1 run
    battle_wait 0.5
    set_counter army11_run 0
    end_if

end_if

if I_CompareCounter army13_reinf_allied = 1

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army13_moving 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and I_UnitDistanceFromUnit a1u1 a13u1 > 150
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_late 1
    battle_wait 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 0
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 1000

    set_counter army13_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 750

    set_counter army13_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 500

    set_counter army13_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 300

    set_counter army13_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 200

    set_counter army13_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    battle_wait 0.5
    set_counter army13_moving 1
    set_counter army13_reinf_late 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a13u1 > 60

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitGroupKilled army13 > 50

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army13 a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitUnderFire a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_run = 1

;    unit_group_order_halt army13
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army13 a1u1 run
    battle_wait 0.5
    set_counter army13_run 0
    end_if

end_if

if I_CompareCounter army15_reinf_allied = 1

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army15_moving 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and I_UnitDistanceFromUnit a1u1 a15u1 > 150
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_late 1
    battle_wait 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 0
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 1000

    set_counter army15_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 750

    set_counter army15_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 500

    set_counter army15_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 300

    set_counter army15_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 200

    set_counter army15_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    battle_wait 0.5
    set_counter army15_moving 1
    set_counter army15_reinf_late 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a15u1 > 60

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitGroupKilled army15 > 50

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army15 a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitUnderFire a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_run = 1

;    unit_group_order_halt army15
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army15 a1u1 run
    battle_wait 0.5
    set_counter army15_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_BattlePlayerArmyIsAttacker

;    inc_counter reinf_check_interval 1

if I_CompareCounter army4_reinf_allied = 1

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army4_moving 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_late 1
    battle_wait 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 1000

    set_counter army4_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 750

    set_counter army4_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 500

    set_counter army4_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300

    set_counter army4_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    battle_wait 0.5
    set_counter army4_moving 1
    set_counter army4_reinf_late 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a4u1 > 60

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army4 a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_run = 1

;    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army4 a2u1 run
    battle_wait 0.5
    set_counter army4_run 0
    end_if

end_if

if I_CompareCounter army6_reinf_allied = 1

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army6_moving 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and I_UnitDistanceFromUnit a2u1 a6u1 > 150
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_late 1
    battle_wait 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 0
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 1000

    set_counter army6_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 750

    set_counter army6_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 500

    set_counter army6_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 300

    set_counter army6_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200

    set_counter army6_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    battle_wait 0.5
    set_counter army6_moving 1
    set_counter army6_reinf_late 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a6u1 > 60

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitGroupKilled army6 > 50

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army6 a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitUnderFire a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_run = 1

;    unit_group_order_halt army6
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army6 a2u1 run
    battle_wait 0.5
    set_counter army6_run 0
    end_if

end_if

if I_CompareCounter army8_reinf_allied = 1

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army8_moving 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and I_UnitDistanceFromUnit a2u1 a8u1 > 150
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_late 1
    battle_wait 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 0
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 1000

    set_counter army8_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 750

    set_counter army8_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 500

    set_counter army8_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 300

    set_counter army8_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200

    set_counter army8_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    battle_wait 0.5
    set_counter army8_moving 1
    set_counter army8_reinf_late 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a8u1 > 60

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitGroupKilled army8 > 50

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army8 a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitUnderFire a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_run = 1

;    unit_group_order_halt army8
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army8 a2u1 run
    battle_wait 0.5
    set_counter army8_run 0
    end_if

end_if

if I_CompareCounter army10_reinf_allied = 1

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army10_moving 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and I_UnitDistanceFromUnit a2u1 a10u1 > 150
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_late 1
    battle_wait 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 0
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 1000

    set_counter army10_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 750

    set_counter army10_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 500

    set_counter army10_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 300

    set_counter army10_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200

    set_counter army10_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    battle_wait 0.5
    set_counter army10_moving 1
    set_counter army10_reinf_late 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a10u1 > 60

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitGroupKilled army10 > 50

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army10 a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitUnderFire a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_run = 1

;    unit_group_order_halt army10
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army10 a2u1 run
    battle_wait 0.5
    set_counter army10_run 0
    end_if

end_if

if I_CompareCounter army12_reinf_allied = 1

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army12_moving 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and I_UnitDistanceFromUnit a2u1 a12u1 > 150
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_late 1
    battle_wait 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 0
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 1000

    set_counter army12_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 750

    set_counter army12_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 500

    set_counter army12_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 300

    set_counter army12_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200

    set_counter army12_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    battle_wait 0.5
    set_counter army12_moving 1
    set_counter army12_reinf_late 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a12u1 > 60

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitGroupKilled army12 > 50

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army12 a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitUnderFire a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_run = 1

;    unit_group_order_halt army12
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army12 a2u1 run
    battle_wait 0.5
    set_counter army12_run 0
    end_if

end_if

if I_CompareCounter army14_reinf_allied = 1

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army14_moving 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and I_UnitDistanceFromUnit a2u1 a14u1 > 150
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_late 1
    battle_wait 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 0
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 1000

    set_counter army14_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 750

    set_counter army14_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 500

    set_counter army14_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 300

    set_counter army14_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200

    set_counter army14_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    battle_wait 0.5
    set_counter army14_moving 1
    set_counter army14_reinf_late 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a14u1 > 60

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitGroupKilled army14 > 50

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army14 a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitUnderFire a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_run = 1

;    unit_group_order_halt army14
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army14 a2u1 run
    battle_wait 0.5
    set_counter army14_run 0
    end_if

end_if

if I_CompareCounter army16_reinf_allied = 1

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army16_moving 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and I_UnitDistanceFromUnit a2u1 a16u1 > 150
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_late 1
    battle_wait 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 0
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 1000

    set_counter army16_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 750

    set_counter army16_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 500

    set_counter army16_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 300

    set_counter army16_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200

    set_counter army16_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    battle_wait 0.5
    set_counter army16_moving 1
    set_counter army16_reinf_late 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a16u1 > 60

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitGroupKilled army16 > 50

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army16 a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitUnderFire a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_run = 1

;    unit_group_order_halt army16
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army16 a2u1 run
    battle_wait 0.5
    set_counter army16_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending Siege

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready_siege = 1
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter army4_ready_siege = 1

;    inc_counter reinf_check_interval 1

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and I_UnitEnemyUnitInRadius a4u1 160

    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    set_counter army4_moving_siege 0
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_run_siege 1
    battle_wait 2
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run_siege 1
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromPosition a4u1 1 1 < 150

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_run_siege = 1

    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_move_formed army4 1 1 run
    set_counter army4_run_siege 0
    end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;;;;;;Sally-out, AI defending

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 1

    if I_UnitDistanceFromPosition a4u1 0 850 < 200
    set_counter army4_location 1 ;north
    end_if
    if I_UnitDistanceFromPosition a4u1 0 -850 < 200
    set_counter army4_location 2 ;south
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 0 < 200
    set_counter army4_location 3 ;west
    end_if
    if I_UnitDistanceFromPosition a4u1 850 0 < 200
    set_counter army4_location 4 ;east
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 5 ;nw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 850 < 200
    set_counter army4_location 6 ;ne
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 7 ;sw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 -850 < 200
    set_counter army4_location 8 ;se
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    set_counter	path_s 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    set_counter	path_sw 4
    set_counter	path_s 5
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    set_counter	path_n 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    set_counter	path_nw 4
    set_counter	path_n 5
    end_if
    end_if

    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    set_counter	path_e 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    set_counter	path_ne 4
    set_counter	path_e 5
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    set_counter	path_w 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    set_counter	path_sw 4
    set_counter	path_w 5
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if

    if I_CompareCounter army4_location = 5 ;nw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if

    if I_CompareCounter army4_location = 6 ;ne
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7 ;sw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if

    if I_CompareCounter army4_location = 8 ;se
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_north = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_south = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_west = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_east = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_ready_sally = 1
    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_change_group_formation army4 ai_infantry_protecting
;	battle_wait 45
    battle_wait 20
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    battle_wait 25
    end_if
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 2
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter label_army4 = 1

    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

;    unit_group_order_halt army4
    set_counter label_army4 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter army4_moving_s = 1
    and I_UnitEnemyUnitInRadius a4u1 130
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on

    set_counter army4_moving_s 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_n = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    set_counter path_n 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_ne = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    set_counter path_n 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 30
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_s = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 -700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    set_counter path_s 0
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_sw = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    set_counter path_s 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_w = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_sw = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_e = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_ne = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_nw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    set_counter path_nw 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_w = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_ne = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    set_counter path_ne 0
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_e = 0
    and I_CompareCounter path_n = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_sw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    set_counter path_sw 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_se = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    set_counter path_se 0
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_s = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 3

    set_counter army4_ready_sally 0
    unit_group_order_halt army4
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_IsUnitRouting a4u1

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_PercentageUnitKilled a4u1 > 80

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2

    if I_IsUnitGroupIdle army4
    inc_counter army4_idle_r 1
    end_if

    if ! I_IsUnitGroupIdle army4
    set_counter army4_idle_r 0
    end_if

    if I_CompareCounter army4_idle_r > 12
    set_counter army4_ready_sally 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_n = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_n 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_s = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_s 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_w = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_w 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_e = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_e 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_nw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_nw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_ne = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_ne 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_sw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_sw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_se = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_se 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;################## Germanicu5 Integrated Stakes script ###########################

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
    and ! I_ConflictType SuccessfulAmbush
    and ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.0
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.5
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 4
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 1.7
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 2.2
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter stakes_on = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    and I_UnitEnemyUnitInRadius a2u1 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    and I_UnitEnemyUnitInRadius a2u2 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    and I_UnitEnemyUnitInRadius a2u3 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    and I_UnitEnemyUnitInRadius a2u4 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    and I_UnitEnemyUnitInRadius a2u5 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    and I_UnitEnemyUnitInRadius a2u6 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    and I_UnitEnemyUnitInRadius a2u7 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    and I_UnitEnemyUnitInRadius a2u8 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    and I_UnitEnemyUnitInRadius a2u9 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    and I_UnitEnemyUnitInRadius a2u10 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    and I_UnitEnemyUnitInRadius a2u11 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    and I_UnitEnemyUnitInRadius a2u12 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    and I_UnitEnemyUnitInRadius a2u13 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    and I_UnitEnemyUnitInRadius a2u14 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    and I_UnitEnemyUnitInRadius a2u15 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    and I_UnitEnemyUnitInRadius a2u16 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    and I_UnitEnemyUnitInRadius a2u17 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    and I_UnitEnemyUnitInRadius a2u18 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    and I_UnitEnemyUnitInRadius a2u19 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    and I_UnitEnemyUnitInRadius a2u20 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

if I_CompareCounter stakes_on = 2
;    ai_active_set off
    unit_group_order_halt army2

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    unit_deploy_stakes a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    unit_deploy_stakes a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    unit_deploy_stakes a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    unit_deploy_stakes a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    unit_deploy_stakes a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    unit_deploy_stakes a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    unit_deploy_stakes a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    unit_deploy_stakes a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    unit_deploy_stakes a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    unit_deploy_stakes a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    unit_deploy_stakes a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    unit_deploy_stakes a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    unit_deploy_stakes a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    unit_deploy_stakes a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    unit_deploy_stakes a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    unit_deploy_stakes a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    unit_deploy_stakes a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    unit_deploy_stakes a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    unit_deploy_stakes a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter stakes_on 0
end_if
    battle_wait 1.5
end_monitor

monitor_event BattleDeploymentPhaseCommenced FactionIsLocal
    and I_BattlePlayerArmyIsAttacker
    and I_BattleIsSiegeBattle
    and I_CompareCounter panel_check = 1
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    unit_deploy_stakes a2u1

    if I_CompareCounter enemy_unit_count > 1
    unit_deploy_stakes a2u2

    if I_CompareCounter enemy_unit_count > 2
    unit_deploy_stakes a2u3

    if I_CompareCounter enemy_unit_count > 3
    unit_deploy_stakes a2u4

    if I_CompareCounter enemy_unit_count > 4
    unit_deploy_stakes a2u5

    if I_CompareCounter enemy_unit_count > 5
    unit_deploy_stakes a2u6

    if I_CompareCounter enemy_unit_count > 6
    unit_deploy_stakes a2u7

    if I_CompareCounter enemy_unit_count > 7
    unit_deploy_stakes a2u8

    if I_CompareCounter enemy_unit_count > 8
    unit_deploy_stakes a2u9

    if I_CompareCounter enemy_unit_count > 9
    unit_deploy_stakes a2u10

    if I_CompareCounter enemy_unit_count > 10
    unit_deploy_stakes a2u11

    if I_CompareCounter enemy_unit_count > 11
    unit_deploy_stakes a2u12

    if I_CompareCounter enemy_unit_count > 12
    unit_deploy_stakes a2u13

    if I_CompareCounter enemy_unit_count > 13
    unit_deploy_stakes a2u14

    if I_CompareCounter enemy_unit_count > 14
    unit_deploy_stakes a2u15

    if I_CompareCounter enemy_unit_count > 15
    unit_deploy_stakes a2u16

    if I_CompareCounter enemy_unit_count > 16
    unit_deploy_stakes a2u17

    if I_CompareCounter enemy_unit_count > 17
    unit_deploy_stakes a2u18

    if I_CompareCounter enemy_unit_count > 18
    unit_deploy_stakes a2u19

    if I_CompareCounter enemy_unit_count = 20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter label_ready 0
end_monitor

;;;;;;;;HA fix;;;;;;;;;;;;

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ha_fix = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
;    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
;    and I_UnitEnemyUnitInRadius a2u1 250
;    ai_gta_plan_set 1 ATTACK_ALL
;    set_counter ha_fix 0
;    set_counter ob_defense_launch 0
;    set_counter ob_defend 4
;end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60

    ai_gta_plan_set 0 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ha_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAssaultingCrossing
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry >= 60

    ai_gta_add_objective 0 ASSAULT_CROSSING 999

;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 0 0 a1u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 0 0 a1u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 0 0 a1u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 0 0 a1u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 0 0 a1u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 0 0 a1u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 0 0 a1u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 0 0 a1u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 0 0 a1u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 0 0 a1u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 0 0 a1u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 0 0 a1u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 0 0 a1u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 0 0 a1u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 0 0 a1u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 0 0 a1u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 0 0 a1u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 0 0 a1u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 0 0 a1u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    battle_wait 0.5
    ai_active_set on

    set_counter ha_fix 0
end_monitor

;;;;;;;;Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off
    unit_group_order_halt army1

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    unit_group_order_halt army1
    battle_wait 0.5
    unit_group_order_change_group_formation army1 ai_wall_assault
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective = 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective 2
    battle_wait 15
    if I_CompareCounter del_objective = 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2 = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSiegeBattle
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 1
    set_counter elephant_gate_tier2 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3 = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring 1
    set_counter elephant_gate_tier3 0
end_monitor

;;;;;;;;Sally-Out Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective_s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective_s 2
    battle_wait 15
    if I_CompareCounter del_objective_s = 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter second_ring_s 1
    set_counter elephant_gate_tier2s 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring_s 1
    set_counter elephant_gate_tier3s 0
end_monitor

;;;;;;;Elephants Gate and Walls
monitor_event BattleBattleGatesDestroyedByEngine TrueCondition ;wtf
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 2
    set_counter rally_walls 0
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 2
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate_s 2
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring_s 2
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

;;;;;;;Sally Out Assault
monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.0

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 3
    and I_BattlePlayerAllianceOddsAgainst > 2.5

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.7

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.2

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.8

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

;;;;;;;Sally Out Defense

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 1 0 a2u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 1 0 a2u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 1 0 a2u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 1 0 a2u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 1 0 a2u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 1 0 a2u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 1 0 a2u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 1 0 a2u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 1 0 a2u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 1 0 a2u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 1 0 a2u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 1 0 a2u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 1 0 a2u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 1 0 a2u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 1 0 a2u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 1 0 a2u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 1 0 a2u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 1 0 a2u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 1 0 a2u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    set_counter sally_defense 2
    set_counter defend_location 1
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter repeat_test1 = 1
set_counter repeat_test1 2
end_if
if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 0

set_counter unit_under_fire 0
set_counter repeat_test1 1
;battle_wait 10
end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_BattleIsSallyOutBattle
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi < 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 660
    and I_UnitGroupDistanceFromPosition army2 1 1 < 630
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test2 = 1
    set_counter repeat_test2 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test2 = 0

    set_counter repeat_test2 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test2 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reform_multi 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if
set_counter reform_back 0
if I_CompareCounter repeat_test2 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 620
    and I_UnitGroupDistanceFromPosition army2 1 1 < 600
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test3 = 1
    set_counter repeat_test3 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test3 = 0

    set_counter repeat_test3 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test3 = 2

    if ! I_UnitEnemyUnitInRadius a2u1 150
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, -100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, -100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if
    set_counter reform_multi 1

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_UnitEnemyUnitInRadius a2u1 150
    set_counter sally_defense 3
    battle_wait 7
    end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test3 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 3
;	and I_UnitDistanceFromPosition a2u1 1 1 < 580
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test4 = 1
    set_counter repeat_test4 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test4 = 0

    set_counter repeat_test4 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test4 = 2

    if I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -700, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 700, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 700, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -700, 0, 100
    end_if
    set_counter reform_multi 2
    end_if
    if ! I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if
    set_counter reform_multi 1
    end_if
    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test4 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6
    if I_CompareCounter army_south = 1
    and I_UnitDistanceFromLine a2u1 sw se < 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_north = 1
    and I_UnitDistanceFromLine a2u1 nw ne > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_west = 1
    and I_UnitDistanceFromLine a2u1 sw nw > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_east = 1
    and I_UnitDistanceFromLine a2u1 se ne < 0
    set_counter line_passed 1
    end_if

if I_CompareCounter line_passed = 1

    set_counter line_passed 0

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test5 = 1
    set_counter repeat_test5 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test5 = 0

    set_counter repeat_test5 1
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test5 = 2

if ! I_UnitEnemyUnitInRadius a2u1 20

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if
if I_UnitEnemyUnitInRadius a2u1 20
set_counter sally_defense 3
battle_wait 20
end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test5 = 1
battle_wait 10
end_if
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0  ;check
    and I_CompareCounter reform_multi > 2
    and ! I_IsUnitGroupEngaged army2
    and I_UnitEnemyUnitInRadius a2u1 160
;	and I_UnitDistanceFromPosition a2u1 1 1 < 560
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
;	and I_BattleSettlementFortificationLevel > 2

    if I_CompareCounter enemy_unit_count > 0
    and I_IsUnitUnderFire a2u1
    and ! I_IsUnitEngaged a2u1
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging
    and ! I_UnitStatus a2u1 moving
    inc_counter reset_position 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_IsUnitUnderFire a2u2
    and ! I_IsUnitEngaged a2u2
    and ! I_UnitStatus a2u2 pursuing
    and ! I_UnitStatus a2u2 charging
    and ! I_UnitStatus a2u2 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_IsUnitUnderFire a2u3
    and ! I_IsUnitEngaged a2u3
    and ! I_UnitStatus a2u3 pursuing
    and ! I_UnitStatus a2u3 charging
    and ! I_UnitStatus a2u3 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_IsUnitUnderFire a2u4
    and ! I_IsUnitEngaged a2u4
    and ! I_UnitStatus a2u4 pursuing
    and ! I_UnitStatus a2u4 charging
    and ! I_UnitStatus a2u4 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_IsUnitUnderFire a2u5
    and ! I_IsUnitEngaged a2u5
    and ! I_UnitStatus a2u5 pursuing
    and ! I_UnitStatus a2u5 charging
    and ! I_UnitStatus a2u5 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_IsUnitUnderFire a2u6
    and ! I_IsUnitEngaged a2u6
    and ! I_UnitStatus a2u6 pursuing
    and ! I_UnitStatus a2u6 charging
    and ! I_UnitStatus a2u6 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_IsUnitUnderFire a2u7
    and ! I_IsUnitEngaged a2u7
    and ! I_UnitStatus a2u7 pursuing
    and ! I_UnitStatus a2u7 charging
    and ! I_UnitStatus a2u7 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_IsUnitUnderFire a2u8
    and ! I_IsUnitEngaged a2u8
    and ! I_UnitStatus a2u8 pursuing
    and ! I_UnitStatus a2u8 charging
    and ! I_UnitStatus a2u8 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_IsUnitUnderFire a2u9
    and ! I_IsUnitEngaged a2u9
    and ! I_UnitStatus a2u9 pursuing
    and ! I_UnitStatus a2u9 charging
    and ! I_UnitStatus a2u9 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_IsUnitUnderFire a2u10
    and ! I_IsUnitEngaged a2u10
    and ! I_UnitStatus a2u10 pursuing
    and ! I_UnitStatus a2u10 charging
    and ! I_UnitStatus a2u10 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_IsUnitUnderFire a2u11
    and ! I_IsUnitEngaged a2u11
    and ! I_UnitStatus a2u11 pursuing
    and ! I_UnitStatus a2u11 charging
    and ! I_UnitStatus a2u11 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_IsUnitUnderFire a2u12
    and ! I_IsUnitEngaged a2u12
    and ! I_UnitStatus a2u12 pursuing
    and ! I_UnitStatus a2u12 charging
    and ! I_UnitStatus a2u12 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_IsUnitUnderFire a2u13
    and ! I_IsUnitEngaged a2u13
    and ! I_UnitStatus a2u13 pursuing
    and ! I_UnitStatus a2u13 charging
    and ! I_UnitStatus a2u13 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_IsUnitUnderFire a2u14
    and ! I_IsUnitEngaged a2u14
    and ! I_UnitStatus a2u14 pursuing
    and ! I_UnitStatus a2u14 charging
    and ! I_UnitStatus a2u14 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_IsUnitUnderFire a2u15
    and ! I_IsUnitEngaged a2u15
    and ! I_UnitStatus a2u15 pursuing
    and ! I_UnitStatus a2u15 charging
    and ! I_UnitStatus a2u15 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_IsUnitUnderFire a2u16
    and ! I_IsUnitEngaged a2u16
    and ! I_UnitStatus a2u16 pursuing
    and ! I_UnitStatus a2u16 charging
    and ! I_UnitStatus a2u16 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_IsUnitUnderFire a2u17
    and ! I_IsUnitEngaged a2u17
    and ! I_UnitStatus a2u17 pursuing
    and ! I_UnitStatus a2u17 charging
    and ! I_UnitStatus a2u17 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_IsUnitUnderFire a2u18
    and ! I_IsUnitEngaged a2u18
    and ! I_UnitStatus a2u18 pursuing
    and ! I_UnitStatus a2u18 charging
    and ! I_UnitStatus a2u18 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_IsUnitUnderFire a2u19
    and ! I_IsUnitEngaged a2u19
    and ! I_UnitStatus a2u19 pursuing
    and ! I_UnitStatus a2u19 charging
    and ! I_UnitStatus a2u19 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_IsUnitUnderFire a2u20
    and ! I_IsUnitEngaged a2u20
    and ! I_UnitStatus a2u20 pursuing
    and ! I_UnitStatus a2u20 charging
    and ! I_UnitStatus a2u20 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitUnderFire a4u1
    and ! I_IsUnitEngaged a4u1
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitStatus a4u1 moving
    inc_counter reset_position 2
    end_if

if I_CompareCounter reset_position > 3

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 1
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
end_if

if I_CompareCounter sally_defense != 2
set_counter sally_defense 3
battle_wait 15
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_defense > 0
    and I_UnitEnemyUnitInRadius a2u1 200

    if ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupMoving army2
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging

    inc_counter army2_idle_s 1
    end_if

    if I_CompareCounter army2_idle_s > 5
    set_counter army2_idle_s 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
    end_if

    if I_IsUnitGroupEngaged army2
    set_counter army2_idle_s 0
    end_if
    if I_IsUnitGroupMoving army2
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 pursuing
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 charging
    set_counter army2_idle_s 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 2
    and I_BattleSettlementFortificationLevel > 2
;	and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitEnemyUnitInRadius a2u1 80

    set_counter sally_defense 6
    set_counter wall_line_passed 0
    set_counter reset_position_s 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitEngaged a2u1
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reset_position_s 2
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitEngaged a2u2
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitEngaged a2u3
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitEngaged a2u4
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitEngaged a2u5
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitEngaged a2u6
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitEngaged a2u7
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitEngaged a2u8
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitEngaged a2u9
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitEngaged a2u10
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitEngaged a2u11
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitEngaged a2u12
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitEngaged a2u13
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitEngaged a2u14
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitEngaged a2u15
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitEngaged a2u16
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitEngaged a2u17
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitEngaged a2u18
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitEngaged a2u19
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitEngaged a2u20
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reset_position_s 1
    end_if
    end_if

if I_CompareCounter reset_position_s = 0
    if I_CompareCounter army_south = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
end_if

    if I_CompareCounter repeat_test6 = 1
    set_counter repeat_test6 2
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 0

    set_counter repeat_test6 1
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position_s 0
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_CompareCounter sally_defense != 2
    set_counter sally_defense 3
    end_if
    if I_CompareCounter wall_line_passed > 0
    battle_wait 15
    end_if
    if I_CompareCounter reset_position_s > 0
    battle_wait 15
    end_if
    if I_CompareCounter repeat_test6 = 1
    battle_wait 20
    end_if
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0
    and I_CompareCounter kill_sally = 0
    and I_IsUnitRouting a2u1
    and ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupDestroyed army2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if

    set_counter sally_defense 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 1
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter reset_army2 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter assign_labels 2
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 2
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter assign_labels 1
end_monitor

;;;Sally Reinforcements

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_reinf = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsUnitEngaged a4u1

    if I_CompareCounter sally_defense < 3
    set_counter defend_location 1
    set_counter sally_reinf 2
    end_if

    if I_CompareCounter sally_defense > 2

    set_counter defend_location 2
    set_counter sally_reinf 2
    end_if

end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense < 3
    and I_CompareCounter sally_defense != 1
    and I_CompareCounter defend_location = 1
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitEnemyUnitInRadius a4u1 20

     ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

    battle_wait 0.5
    ai_active_set on

    set_counter defend_location 0
;	set_counter army4_idle_s 0
battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense > 2
    and I_CompareCounter defend_location = 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0

    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter defend_location 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
;	and I_CompareCounter sally_defense > 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_CompareCounter defend_location = 0
;    and I_UnitEnemyUnitInRadius a4u1 200

    if ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupMoving army4
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging

    inc_counter army4_idle_s 1
    end_if
    if I_CompareCounter army4_idle_s > 5
    set_counter defend_location 1
    set_counter sally_defense 2
    end_if

    if I_IsUnitGroupEngaged army4
    set_counter army4_idle_s 0
    end_if
    if I_IsUnitGroupMoving army4
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 pursuing
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 charging
    set_counter army4_idle_s 0
    end_if
    battle_wait 10
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitGroupDestroyed army4
    and I_BattleIsSallyOutBattle

    set_counter sally_reinf 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_UnitDestroyed a4u1
    and I_BattleIsSallyOutBattle

    set_counter label_army4 1
;    battle_wait 0.5
;    unit_group_enable_automation army4 false
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_reinf 0
end_monitor

;################## Germanicu5 Integrated Protect General script ###########################

monitor_event BattleConflictPhaseCommenced FactionIsLocal
    and I_CompareCounter panel_check = 1
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_CompareCounter enemy_unit_count > 4

    battle_wait 10

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    and I_CompareCounter protect_siege = 1
    set_counter protect_general 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1
    set_counter protect_general 1
    end_if
end_monitor

monitor_event BattleBattleGatesDestroyedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter kill_sally = 1
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a1u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a1u1
    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 3
    release_unit a1u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a2u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a2u1

    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 3
    release_unit a2u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    set_counter general_wait 0
    release_unit a1u1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    set_counter general_wait 0
    release_unit a2u1
end_monitor

;################## Germanicu5 Integrated Siege script ###########################

monitor_conditions I_BattleStarted
    and ! I_BattleIsFortBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_BattleSettlementFortificationLevel > 0
    and I_CompareCounter siege_fix = 1

    set_counter siege_fix 0

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    set_counter army_sieging 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
end_monitor

;;;;;;;Sally Out

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter reset_army2 = 1

    set_counter reset_army2 0
    set_counter enemy_unit_count 0

    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;;;;;;;Huge City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 35

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 10
    battle_wait 30

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 10
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 14
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 14
    set_counter sally_check 15
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 15
    set_counter sally_check 16
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 16
    set_counter sally_check 17
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 17
    set_counter sally_check 18
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 18
    set_counter sally_check 19
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 19
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 80

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 60
    set_counter sally_check 20
    battle_wait 30
if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 20
    set_counter sally_check 21
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 21
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 24
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 24
    set_counter sally_check 25
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 25
    set_counter sally_check 26
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 26
    set_counter sally_check 27
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 27
    set_counter sally_check 28
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 28
    set_counter sally_check 29
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 29
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_if
end_monitor

;;;;;;;Large City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 45

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 30
    battle_wait 37

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 30
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 34
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 34
    set_counter sally_check 35
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 35
    set_counter sally_check 36
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 36
    set_counter sally_check 37
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 37
    set_counter sally_check 38
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 38
    set_counter sally_check 39
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 39
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 90

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 70
    set_counter sally_check 40
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 40
    set_counter sally_check 41
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 41
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 44
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 44
    set_counter sally_check 45
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 45
    set_counter sally_check 46
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 46
    set_counter sally_check 47
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 47
    set_counter sally_check 48
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 48
    set_counter sally_check 49
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 49
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Castle, Citadel and Fortress

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 100

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 75
    set_counter sally_check 50
    battle_wait 15
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 50
    set_counter sally_check 51
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 51
    set_counter sally_check 52
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 52
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 54
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 54
    set_counter sally_check 55
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 55
    set_counter sally_check 56
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 56
    set_counter sally_check 57
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 57
    set_counter sally_check 58
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 58
    set_counter sally_check 59
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 59
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 170

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 125
    set_counter sally_check 60
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 60
    set_counter sally_check 61
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 61
    set_counter sally_check 62
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 62
    set_counter sally_check 63
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 63
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 64
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 64
    set_counter sally_check 65
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 65
    set_counter sally_check 66
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 66
    set_counter sally_check 67
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 67
    set_counter sally_check 68
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 68
    set_counter sally_check 69
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 69
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Wall Advance

monitor_conditions I_BattleStarted
    and I_CompareCounter wall_advance_s = 1
    and I_CompareCounter kill_sally = 1
    and I_BattleIsSallyOutBattle

    battle_wait 2
    if I_BattleSettlementFortificationLevel < 3
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 95
    end_if

    if I_BattleSettlementFortificationLevel > 2
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 200
    end_if

    set_counter emergency_stop 1
    if I_BattleSettlementFortificationLevel < 3
;	battle_wait 72
    set_counter sally_check 113
    battle_wait 36
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 36
    end_if
    end_if
    if I_BattleSettlementFortificationLevel > 2
;	battle_wait 145
    set_counter sally_check 110
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 110
    set_counter sally_check 111
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 111
    set_counter sally_check 112
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 112
    set_counter sally_check 113
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 30
    end_if
    end_if

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 114
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1

    set_counter emergency_stop 0
    unit_group_order_halt army2
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    set_counter wall_advance_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter omfg_cannon_tower > 0

    set_counter omfg_cannon_tower 2
if I_CompareCounter player_unit_count > 0
    if I_UnitStatus a1u1 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u1 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u2 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u2 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u3 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u3 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u4 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u4 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u5 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u5 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u6 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u6 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u7 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u7 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u8 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u8 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u9 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u9 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u10 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u10 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u11 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u11 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u12 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u12 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u13 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u13 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u14 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u14 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u15 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u15 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u16 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u16 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u17 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u17 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u18 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u18 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u19 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u19 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 19
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u20 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u20 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_CompareCounter omfg_cannon_tower = 2

    if I_CompareCounter enemy_unit_count > 0
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u1
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u2
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u3
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u4
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u5
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u6
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u7
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u8
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u9
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u10
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u11
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u12
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u13
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u14
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u15
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u16
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u17
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u18
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u19
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u20
    set_counter omfg_cannon_tower 3
    end_if
end_if

    if I_CompareCounter omfg_cannon_tower = 3
    set_counter omfg_cannon_tower 0
    set_counter emergency_stop 0
;    ai_active_set off
;    battle_wait 0.5
    ai_active_set on
    end_if
    battle_wait 7
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter emergency_stop = 1
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1

    if I_BattleIsSiegeBattle
    unit_group_order_halt army1
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
    if I_BattleIsSallyOutBattle
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
end_monitor

;################## Open Battles #################

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 0
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 2

    if I_UnitDistanceFromUnit a1u1 a2u1 < 220
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitDistanceFromUnit a1u1 a2u1 < 270
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattlePlayerAllianceOddsInFavour > 1.7
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    set_counter ob_repeat_test 1
    end_if
;    if I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
;    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleEnemyUnitClass != missile
    and BattleEnemyUnitClass != skirmish
    and BattleDirectionOfAttack != front
    and BattleRangeOfAttack < 200

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and BattleDirectionOfAttack != rear
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleRangeOfAttack < 200
    and BattlePlayerUnitCategory infantry

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a2u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitEnemyUnitInRadius a2u1 250
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4

    set_counter player_units_closing 0

    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromUnit a1u1 a2u1 < 180
    and ! I_UnitStatus a1u1 missiles_firing
    and ! I_UnitStatus a1u1 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromUnit a1u2 a2u1 < 180
    and ! I_UnitStatus a1u2 missiles_firing
    and ! I_UnitStatus a1u2 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromUnit a1u3 a2u1 < 180
    and ! I_UnitStatus a1u3 missiles_firing
    and ! I_UnitStatus a1u3 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromUnit a1u4 a2u1 < 180
    and ! I_UnitStatus a1u4 missiles_firing
    and ! I_UnitStatus a1u4 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromUnit a1u5 a2u1 < 180
    and ! I_UnitStatus a1u5 missiles_firing
    and ! I_UnitStatus a1u5 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromUnit a1u6 a2u1 < 180
    and ! I_UnitStatus a1u6 missiles_firing
    and ! I_UnitStatus a1u6 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromUnit a1u7 a2u1 < 180
    and ! I_UnitStatus a1u7 missiles_firing
    and ! I_UnitStatus a1u7 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromUnit a1u8 a2u1 < 180
    and ! I_UnitStatus a1u8 missiles_firing
    and ! I_UnitStatus a1u8 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromUnit a1u9 a2u1 < 180
    and ! I_UnitStatus a1u9 missiles_firing
    and ! I_UnitStatus a1u9 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromUnit a1u10 a2u1 < 180
    and ! I_UnitStatus a1u10 missiles_firing
    and ! I_UnitStatus a1u10 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromUnit a1u11 a2u1 < 180
    and ! I_UnitStatus a1u11 missiles_firing
    and ! I_UnitStatus a1u11 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromUnit a1u12 a2u1 < 180
    and ! I_UnitStatus a1u12 missiles_firing
    and ! I_UnitStatus a1u12 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromUnit a1u13 a2u1 < 180
    and ! I_UnitStatus a1u13 missiles_firing
    and ! I_UnitStatus a1u13 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromUnit a1u14 a2u1 < 180
    and ! I_UnitStatus a1u14 missiles_firing
    and ! I_UnitStatus a1u14 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromUnit a1u15 a2u1 < 180
    and ! I_UnitStatus a1u15 missiles_firing
    and ! I_UnitStatus a1u15 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromUnit a1u16 a2u1 < 180
    and ! I_UnitStatus a1u16 missiles_firing
    and ! I_UnitStatus a1u16 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromUnit a1u17 a2u1 < 180
    and ! I_UnitStatus a1u17 missiles_firing
    and ! I_UnitStatus a1u17 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromUnit a1u18 a2u1 < 180
    and ! I_UnitStatus a1u18 missiles_firing
    and ! I_UnitStatus a1u18 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromUnit a1u19 a2u1 < 180
    and ! I_UnitStatus a1u19 missiles_firing
    and ! I_UnitStatus a1u19 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromUnit a1u20 a2u1 < 180
    and ! I_UnitStatus a1u20 missiles_firing
    and ! I_UnitStatus a1u20 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_units_closing > 1
    inc_counter player_enveloping 1
    end_if
    if I_CompareCounter player_units_closing < 1
    set_counter player_enveloping 0
    end_if
    if I_CompareCounter player_enveloping > 5
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    battle_wait 10
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and BattleIsMeleeAttack
    and BattleEnemyUnitClass heavy
    and BattleEnemyUnitCategory cavalry
    and ! BattlePlayerUnitClass heavy
    and ! BattlePlayerUnitClass heavy
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    inc_counter ob_engaged -1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    if I_PercentageOfArmyKilled 0 0 < 5
    and I_PercentageOfArmyKilled 1 0 > 10
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 10
    and I_PercentageOfArmyKilled 1 0 > 20
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 15
    and I_PercentageOfArmyKilled 1 0 > 25
    set_counter ob_repeat_test 4
    end_if
    battle_wait 30
end_monitor

;monitor_event BattlePlayerUnitAttacksEnemyUnit TrueCondition
;    and I_CompareCounter panel_check = 1
;    and I_CompareCounter ob_defense_launch = 1
;    and ! I_CompareCounter ob_defend > 1
;    and BattlePlayerUnitCategory siege
;    and BattlePlayerUnitClass missile
;    and BattleRangeOfAttack < 400
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    set_counter ob_siege_attack 1
;end_monitor

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ob_defense_launch = 1
;    and I_CompareCounter ob_siege_attack = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    if I_PercentageOfArmyKilled 0 0 < 3
;    and I_PercentageOfArmyKilled 1 0 > 5
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    if I_PercentageOfArmyKilled 0 0 < 5
;    and I_PercentageOfArmyKilled 1 0 > 10
;    if I_CompareCounter ob_repeat_test < 2
;    set_counter ob_repeat_test 2
;    end_if
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    battle_wait 30
;end_monitor

;;;;;; Reinf triggers

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter player_engaged_reinf = 4
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
    end_if

    if I_IsUnitGroupEngaged army1
    inc_counter player_engaged_reinf 1
    end_if

    if I_CompareCounter player_engaged_reinf > 0
    and ! I_IsUnitGroupEngaged army1
    set_counter player_engaged_reinf 0
    end_if

    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_PercentageUnitGroupKilled army4 > 10
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a4u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

;;;;;; Main monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 3

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter ob_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u1 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u2 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u3 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u4 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u5 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u6 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u7 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u8 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u9 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u10 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u11 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u12 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u13 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u14 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u15 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u16 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u17 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u18 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u19 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u20 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter ob_under_fire < 1
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if

    if I_CompareCounter ob_repeat_test < 3
    set_counter ob_repeat_test 1
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if
    end_if

    end_if

    if I_CompareCounter ob_under_fire > 0
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if
    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test < 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    set_counter ob_repeat_test 2
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    end_if
    if I_CompareCounter ob_repeat_test = 4
    if I_CompareCounter ob_under_fire < 1
    and I_CompareCounter ob_engaged < 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 3
        set_counter ob_repeat_test 2
    end_if
    if I_CompareCounter ob_under_fire > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if
    if I_CompareCounter ob_engaged > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if

    end_if

        if I_CompareCounter ob_defend = 3
        set_counter ob_defend 2
        end_if
        battle_wait 15
end_monitor

;;;;;;;General Stop

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and I_BattleEnemyArmyNumberOfUnits > 2
    and I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a2u1 120

    set_counter g_stop 2
    label_unit 1 0 0 a2u1
    battle_wait 0.1
    unit_order_halt a2u1
    if I_BattleEnemyArmyNumberOfUnits > 5
    battle_wait 30
    end_if
    if I_BattleEnemyArmyNumberOfUnits < 6
    battle_wait 15
    end_if
    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 2
    and I_BattleAiAttacking
    release_unit a2u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a1u1 120

    set_counter g_stop 3
    label_unit 0 0 0 a1u1
    battle_wait 0.1
    unit_order_halt a1u1
    battle_wait 30
    if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 3
    and I_BattleAiAttacking
    release_unit a1u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    release_unit a2u1
    set_counter g_stop 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 3
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    release_unit a1u1
    set_counter g_stop 0
end_monitor

;;;;;;;AI Stuck Fix

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter ai_stuck_launch = 1
    and BattleIsMeleeAttack
    and I_BattleIsSiegeBattle
    set_counter ai_stuck_launch 2
end_monitor

monitor_conditions I_CompareCounter ai_stuck_launch = 2
    and I_BattleIsSiegeBattle

if I_CompareCounter enemy_unit_count > 0
and ! I_UnitDestroyed a2u1

    if I_UnitStatus a2u1 moving
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 1
    end_if
    if I_CompareCounter a2u1_status != 1
    set_counter a2u1_status 0
    end_if
    end_if

    if I_UnitStatus a2u1 routing
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 2
    end_if
    if I_CompareCounter a2u1_status != 2
    set_counter a2u1_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u1 moving
    and ! I_UnitStatus a2u1 routing
    set_counter a2u1_status 0
    end_if

    if I_CompareCounter a2u1_status > 0

    if I_UnitDistanceFromPosition a2u1 0,0 >= 150
    and I_UnitDistanceFromPosition a2u1 0,0 < 175
    if I_CompareCounter a2u1_distance != 1
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 1
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 175
    and I_UnitDistanceFromPosition a2u1 0,0 < 200
    if I_CompareCounter a2u1_distance != 2
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 2
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 200
    and I_UnitDistanceFromPosition a2u1 0,0 < 225
    if I_CompareCounter a2u1_distance != 3
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 3
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 225
    and I_UnitDistanceFromPosition a2u1 0,0 < 250
    if I_CompareCounter a2u1_distance != 4
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 4
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 250
    and I_UnitDistanceFromPosition a2u1 0,0 < 275
    if I_CompareCounter a2u1_distance != 5
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 5
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 275
    and I_UnitDistanceFromPosition a2u1 0,0 < 300
    if I_CompareCounter a2u1_distance != 6
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 6
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 300
    and I_UnitDistanceFromPosition a2u1 0,0 < 325
    if I_CompareCounter a2u1_distance != 7
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 7
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 325
    and I_UnitDistanceFromPosition a2u1 0,0 < 350
    if I_CompareCounter a2u1_distance != 8
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 8
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 350
    and I_UnitDistanceFromPosition a2u1 0,0 < 375
    if I_CompareCounter a2u1_distance != 9
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 9
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 375
    and I_UnitDistanceFromPosition a2u1 0,0 < 400
    if I_CompareCounter a2u1_distance != 10
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 10
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 400
    and I_UnitDistanceFromPosition a2u1 0,0 < 425
    if I_CompareCounter a2u1_distance != 11
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 11
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 425
    and I_UnitDistanceFromPosition a2u1 0,0 < 450
    if I_CompareCounter a2u1_distance != 12
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 12
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 450
    and I_UnitDistanceFromPosition a2u1 0,0 < 500
    if I_CompareCounter a2u1_distance != 13
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 13
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 500
    and I_UnitDistanceFromPosition a2u1 0,0 < 550
    if I_CompareCounter a2u1_distance != 14
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 14
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 550
    and I_UnitDistanceFromPosition a2u1 0,0 < 600
    if I_CompareCounter a2u1_distance != 15
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 15
    inc_counter a2u1_stuck 1
    end_if

    if I_CompareCounter a2u1_stuck = 4
    unit_order_halt a2u1
    unit_set_morale a2u1 wavering
    battle_wait 0.1
    unit_unset_morale a2u1
    release_unit a2u1
    set_counter a2u1_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 1
and ! I_UnitDestroyed a2u2

    if I_UnitStatus a2u2 moving
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 1
    end_if
    if I_CompareCounter a2u2_status != 1
    set_counter a2u2_status 0
    end_if
    end_if

    if I_UnitStatus a2u2 routing
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 2
    end_if
    if I_CompareCounter a2u2_status != 2
    set_counter a2u2_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u2 moving
    and ! I_UnitStatus a2u2 routing
    set_counter a2u2_status 0
    end_if

    if I_CompareCounter a2u2_status > 0

    if I_UnitDistanceFromPosition a2u2 0,0 >= 150
    and I_UnitDistanceFromPosition a2u2 0,0 < 175
    if I_CompareCounter a2u2_distance != 1
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 1
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 175
    and I_UnitDistanceFromPosition a2u2 0,0 < 200
    if I_CompareCounter a2u2_distance != 2
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 2
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 200
    and I_UnitDistanceFromPosition a2u2 0,0 < 225
    if I_CompareCounter a2u2_distance != 3
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 3
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 225
    and I_UnitDistanceFromPosition a2u2 0,0 < 250
    if I_CompareCounter a2u2_distance != 4
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 4
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 250
    and I_UnitDistanceFromPosition a2u2 0,0 < 275
    if I_CompareCounter a2u2_distance != 5
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 5
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 275
    and I_UnitDistanceFromPosition a2u2 0,0 < 300
    if I_CompareCounter a2u2_distance != 6
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 6
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 300
    and I_UnitDistanceFromPosition a2u2 0,0 < 325
    if I_CompareCounter a2u2_distance != 7
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 7
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 325
    and I_UnitDistanceFromPosition a2u2 0,0 < 350
    if I_CompareCounter a2u2_distance != 8
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 8
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 350
    and I_UnitDistanceFromPosition a2u2 0,0 < 375
    if I_CompareCounter a2u2_distance != 9
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 9
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 375
    and I_UnitDistanceFromPosition a2u2 0,0 < 400
    if I_CompareCounter a2u2_distance != 10
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 10
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 400
    and I_UnitDistanceFromPosition a2u2 0,0 < 425
    if I_CompareCounter a2u2_distance != 11
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 11
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 425
    and I_UnitDistanceFromPosition a2u2 0,0 < 450
    if I_CompareCounter a2u2_distance != 12
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 12
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 450
    and I_UnitDistanceFromPosition a2u2 0,0 < 500
    if I_CompareCounter a2u2_distance != 13
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 13
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 500
    and I_UnitDistanceFromPosition a2u2 0,0 < 550
    if I_CompareCounter a2u2_distance != 14
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 14
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 550
    and I_UnitDistanceFromPosition a2u2 0,0 < 600
    if I_CompareCounter a2u2_distance != 15
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 15
    inc_counter a2u2_stuck 1
    end_if

    if I_CompareCounter a2u2_stuck = 4
    unit_order_halt a2u2
    unit_set_morale a2u2 wavering
    battle_wait 0.1
    unit_unset_morale a2u2
    release_unit a2u2
    set_counter a2u2_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 2
and ! I_UnitDestroyed a2u3

    if I_UnitStatus a2u3 moving
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 1
    end_if
    if I_CompareCounter a2u3_status != 1
    set_counter a2u3_status 0
    end_if
    end_if

    if I_UnitStatus a2u3 routing
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 2
    end_if
    if I_CompareCounter a2u3_status != 2
    set_counter a2u3_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u3 moving
    and ! I_UnitStatus a2u3 routing
    set_counter a2u3_status 0
    end_if

    if I_CompareCounter a2u3_status > 0

    if I_UnitDistanceFromPosition a2u3 0,0 >= 150
    and I_UnitDistanceFromPosition a2u3 0,0 < 175
    if I_CompareCounter a2u3_distance != 1
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 1
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 175
    and I_UnitDistanceFromPosition a2u3 0,0 < 200
    if I_CompareCounter a2u3_distance != 2
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 2
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 200
    and I_UnitDistanceFromPosition a2u3 0,0 < 225
    if I_CompareCounter a2u3_distance != 3
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 3
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 225
    and I_UnitDistanceFromPosition a2u3 0,0 < 250
    if I_CompareCounter a2u3_distance != 4
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 4
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 250
    and I_UnitDistanceFromPosition a2u3 0,0 < 275
    if I_CompareCounter a2u3_distance != 5
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 5
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 275
    and I_UnitDistanceFromPosition a2u3 0,0 < 300
    if I_CompareCounter a2u3_distance != 6
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 6
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 300
    and I_UnitDistanceFromPosition a2u3 0,0 < 325
    if I_CompareCounter a2u3_distance != 7
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 7
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 325
    and I_UnitDistanceFromPosition a2u3 0,0 < 350
    if I_CompareCounter a2u3_distance != 8
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 8
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 350
    and I_UnitDistanceFromPosition a2u3 0,0 < 375
    if I_CompareCounter a2u3_distance != 9
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 9
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 375
    and I_UnitDistanceFromPosition a2u3 0,0 < 400
    if I_CompareCounter a2u3_distance != 10
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 10
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 400
    and I_UnitDistanceFromPosition a2u3 0,0 < 425
    if I_CompareCounter a2u3_distance != 11
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 11
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 425
    and I_UnitDistanceFromPosition a2u3 0,0 < 450
    if I_CompareCounter a2u3_distance != 12
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 12
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 450
    and I_UnitDistanceFromPosition a2u3 0,0 < 500
    if I_CompareCounter a2u3_distance != 13
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 13
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 500
    and I_UnitDistanceFromPosition a2u3 0,0 < 550
    if I_CompareCounter a2u3_distance != 14
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 14
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 550
    and I_UnitDistanceFromPosition a2u3 0,0 < 600
    if I_CompareCounter a2u3_distance != 15
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 15
    inc_counter a2u3_stuck 1
    end_if

    if I_CompareCounter a2u3_stuck = 4
    unit_order_halt a2u3
    unit_set_morale a2u3 wavering
    battle_wait 0.1
    unit_unset_morale a2u3
    release_unit a2u3
    set_counter a2u3_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 3
and ! I_UnitDestroyed a2u4

    if I_UnitStatus a2u4 moving
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 1
    end_if
    if I_CompareCounter a2u4_status != 1
    set_counter a2u4_status 0
    end_if
    end_if

    if I_UnitStatus a2u4 routing
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 2
    end_if
    if I_CompareCounter a2u4_status != 2
    set_counter a2u4_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u4 moving
    and ! I_UnitStatus a2u4 routing
    set_counter a2u4_status 0
    end_if

    if I_CompareCounter a2u4_status > 0

    if I_UnitDistanceFromPosition a2u4 0,0 >= 150
    and I_UnitDistanceFromPosition a2u4 0,0 < 175
    if I_CompareCounter a2u4_distance != 1
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 1
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 175
    and I_UnitDistanceFromPosition a2u4 0,0 < 200
    if I_CompareCounter a2u4_distance != 2
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 2
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 200
    and I_UnitDistanceFromPosition a2u4 0,0 < 225
    if I_CompareCounter a2u4_distance != 3
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 3
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 225
    and I_UnitDistanceFromPosition a2u4 0,0 < 250
    if I_CompareCounter a2u4_distance != 4
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 4
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 250
    and I_UnitDistanceFromPosition a2u4 0,0 < 275
    if I_CompareCounter a2u4_distance != 5
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 5
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 275
    and I_UnitDistanceFromPosition a2u4 0,0 < 300
    if I_CompareCounter a2u4_distance != 6
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 6
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 300
    and I_UnitDistanceFromPosition a2u4 0,0 < 325
    if I_CompareCounter a2u4_distance != 7
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 7
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 325
    and I_UnitDistanceFromPosition a2u4 0,0 < 350
    if I_CompareCounter a2u4_distance != 8
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 8
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 350
    and I_UnitDistanceFromPosition a2u4 0,0 < 375
    if I_CompareCounter a2u4_distance != 9
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 9
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 375
    and I_UnitDistanceFromPosition a2u4 0,0 < 400
    if I_CompareCounter a2u4_distance != 10
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 10
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 400
    and I_UnitDistanceFromPosition a2u4 0,0 < 425
    if I_CompareCounter a2u4_distance != 11
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 11
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 425
    and I_UnitDistanceFromPosition a2u4 0,0 < 450
    if I_CompareCounter a2u4_distance != 12
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 12
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 450
    and I_UnitDistanceFromPosition a2u4 0,0 < 500
    if I_CompareCounter a2u4_distance != 13
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 13
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 500
    and I_UnitDistanceFromPosition a2u4 0,0 < 550
    if I_CompareCounter a2u4_distance != 14
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 14
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 550
    and I_UnitDistanceFromPosition a2u4 0,0 < 600
    if I_CompareCounter a2u4_distance != 15
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 15
    inc_counter a2u4_stuck 1
    end_if

    if I_CompareCounter a2u4_stuck = 4
    unit_order_halt a2u4
    unit_set_morale a2u4 wavering
    battle_wait 0.1
    unit_unset_morale a2u4
    release_unit a2u4
    set_counter a2u4_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 4
and ! I_UnitDestroyed a2u5

    if I_UnitStatus a2u5 moving
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 1
    end_if
    if I_CompareCounter a2u5_status != 1
    set_counter a2u5_status 0
    end_if
    end_if

    if I_UnitStatus a2u5 routing
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 2
    end_if
    if I_CompareCounter a2u5_status != 2
    set_counter a2u5_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u5 moving
    and ! I_UnitStatus a2u5 routing
    set_counter a2u5_status 0
    end_if

    if I_CompareCounter a2u5_status > 0

    if I_UnitDistanceFromPosition a2u5 0,0 >= 150
    and I_UnitDistanceFromPosition a2u5 0,0 < 175
    if I_CompareCounter a2u5_distance != 1
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 1
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 175
    and I_UnitDistanceFromPosition a2u5 0,0 < 200
    if I_CompareCounter a2u5_distance != 2
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 2
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 200
    and I_UnitDistanceFromPosition a2u5 0,0 < 225
    if I_CompareCounter a2u5_distance != 3
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 3
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 225
    and I_UnitDistanceFromPosition a2u5 0,0 < 250
    if I_CompareCounter a2u5_distance != 4
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 4
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 250
    and I_UnitDistanceFromPosition a2u5 0,0 < 275
    if I_CompareCounter a2u5_distance != 5
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 5
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 275
    and I_UnitDistanceFromPosition a2u5 0,0 < 300
    if I_CompareCounter a2u5_distance != 6
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 6
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 300
    and I_UnitDistanceFromPosition a2u5 0,0 < 325
    if I_CompareCounter a2u5_distance != 7
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 7
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 325
    and I_UnitDistanceFromPosition a2u5 0,0 < 350
    if I_CompareCounter a2u5_distance != 8
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 8
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 350
    and I_UnitDistanceFromPosition a2u5 0,0 < 375
    if I_CompareCounter a2u5_distance != 9
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 9
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 375
    and I_UnitDistanceFromPosition a2u5 0,0 < 400
    if I_CompareCounter a2u5_distance != 10
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 10
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 400
    and I_UnitDistanceFromPosition a2u5 0,0 < 425
    if I_CompareCounter a2u5_distance != 11
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 11
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 425
    and I_UnitDistanceFromPosition a2u5 0,0 < 450
    if I_CompareCounter a2u5_distance != 12
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 12
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 450
    and I_UnitDistanceFromPosition a2u5 0,0 < 500
    if I_CompareCounter a2u5_distance != 13
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 13
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 500
    and I_UnitDistanceFromPosition a2u5 0,0 < 550
    if I_CompareCounter a2u5_distance != 14
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 14
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 550
    and I_UnitDistanceFromPosition a2u5 0,0 < 600
    if I_CompareCounter a2u5_distance != 15
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 15
    inc_counter a2u5_stuck 1
    end_if

    if I_CompareCounter a2u5_stuck = 4
    unit_order_halt a2u5
    unit_set_morale a2u5 wavering
    battle_wait 0.1
    unit_unset_morale a2u5
    release_unit a2u5
    set_counter a2u5_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 5
and ! I_UnitDestroyed a2u6

    if I_UnitStatus a2u6 moving
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 1
    end_if
    if I_CompareCounter a2u6_status != 1
    set_counter a2u6_status 0
    end_if
    end_if

    if I_UnitStatus a2u6 routing
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 2
    end_if
    if I_CompareCounter a2u6_status != 2
    set_counter a2u6_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u6 moving
    and ! I_UnitStatus a2u6 routing
    set_counter a2u6_status 0
    end_if

    if I_CompareCounter a2u6_status > 0

    if I_UnitDistanceFromPosition a2u6 0,0 >= 150
    and I_UnitDistanceFromPosition a2u6 0,0 < 175
    if I_CompareCounter a2u6_distance != 1
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 1
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 175
    and I_UnitDistanceFromPosition a2u6 0,0 < 200
    if I_CompareCounter a2u6_distance != 2
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 2
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 200
    and I_UnitDistanceFromPosition a2u6 0,0 < 225
    if I_CompareCounter a2u6_distance != 3
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 3
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 225
    and I_UnitDistanceFromPosition a2u6 0,0 < 250
    if I_CompareCounter a2u6_distance != 4
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 4
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 250
    and I_UnitDistanceFromPosition a2u6 0,0 < 275
    if I_CompareCounter a2u6_distance != 5
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 5
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 275
    and I_UnitDistanceFromPosition a2u6 0,0 < 300
    if I_CompareCounter a2u6_distance != 6
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 6
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 300
    and I_UnitDistanceFromPosition a2u6 0,0 < 325
    if I_CompareCounter a2u6_distance != 7
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 7
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 325
    and I_UnitDistanceFromPosition a2u6 0,0 < 350
    if I_CompareCounter a2u6_distance != 8
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 8
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 350
    and I_UnitDistanceFromPosition a2u6 0,0 < 375
    if I_CompareCounter a2u6_distance != 9
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 9
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 375
    and I_UnitDistanceFromPosition a2u6 0,0 < 400
    if I_CompareCounter a2u6_distance != 10
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 10
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 400
    and I_UnitDistanceFromPosition a2u6 0,0 < 425
    if I_CompareCounter a2u6_distance != 11
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 11
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 425
    and I_UnitDistanceFromPosition a2u6 0,0 < 450
    if I_CompareCounter a2u6_distance != 12
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 12
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 450
    and I_UnitDistanceFromPosition a2u6 0,0 < 500
    if I_CompareCounter a2u6_distance != 13
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 13
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 500
    and I_UnitDistanceFromPosition a2u6 0,0 < 550
    if I_CompareCounter a2u6_distance != 14
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 14
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 550
    and I_UnitDistanceFromPosition a2u6 0,0 < 600
    if I_CompareCounter a2u6_distance != 15
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 15
    inc_counter a2u6_stuck 1
    end_if

    if I_CompareCounter a2u6_stuck = 4
    unit_order_halt a2u6
    unit_set_morale a2u6 wavering
    battle_wait 0.1
    unit_unset_morale a2u6
    release_unit a2u6
    set_counter a2u6_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 6
and ! I_UnitDestroyed a2u7

    if I_UnitStatus a2u7 moving
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 1
    end_if
    if I_CompareCounter a2u7_status != 1
    set_counter a2u7_status 0
    end_if
    end_if

    if I_UnitStatus a2u7 routing
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 2
    end_if
    if I_CompareCounter a2u7_status != 2
    set_counter a2u7_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u7 moving
    and ! I_UnitStatus a2u7 routing
    set_counter a2u7_status 0
    end_if

    if I_CompareCounter a2u7_status > 0

    if I_UnitDistanceFromPosition a2u7 0,0 >= 150
    and I_UnitDistanceFromPosition a2u7 0,0 < 175
    if I_CompareCounter a2u7_distance != 1
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 1
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 175
    and I_UnitDistanceFromPosition a2u7 0,0 < 200
    if I_CompareCounter a2u7_distance != 2
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 2
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 200
    and I_UnitDistanceFromPosition a2u7 0,0 < 225
    if I_CompareCounter a2u7_distance != 3
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 3
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 225
    and I_UnitDistanceFromPosition a2u7 0,0 < 250
    if I_CompareCounter a2u7_distance != 4
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 4
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 250
    and I_UnitDistanceFromPosition a2u7 0,0 < 275
    if I_CompareCounter a2u7_distance != 5
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 5
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 275
    and I_UnitDistanceFromPosition a2u7 0,0 < 300
    if I_CompareCounter a2u7_distance != 6
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 6
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 300
    and I_UnitDistanceFromPosition a2u7 0,0 < 325
    if I_CompareCounter a2u7_distance != 7
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 7
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 325
    and I_UnitDistanceFromPosition a2u7 0,0 < 350
    if I_CompareCounter a2u7_distance != 8
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 8
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 350
    and I_UnitDistanceFromPosition a2u7 0,0 < 375
    if I_CompareCounter a2u7_distance != 9
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 9
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 375
    and I_UnitDistanceFromPosition a2u7 0,0 < 400
    if I_CompareCounter a2u7_distance != 10
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 10
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 400
    and I_UnitDistanceFromPosition a2u7 0,0 < 425
    if I_CompareCounter a2u7_distance != 11
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 11
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 425
    and I_UnitDistanceFromPosition a2u7 0,0 < 450
    if I_CompareCounter a2u7_distance != 12
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 12
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 450
    and I_UnitDistanceFromPosition a2u7 0,0 < 500
    if I_CompareCounter a2u7_distance != 13
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 13
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 500
    and I_UnitDistanceFromPosition a2u7 0,0 < 550
    if I_CompareCounter a2u7_distance != 14
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 14
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 550
    and I_UnitDistanceFromPosition a2u7 0,0 < 600
    if I_CompareCounter a2u7_distance != 15
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 15
    inc_counter a2u7_stuck 1
    end_if

    if I_CompareCounter a2u7_stuck = 4
    unit_order_halt a2u7
    unit_set_morale a2u7 wavering
    battle_wait 0.1
    unit_unset_morale a2u7
    release_unit a2u7
    set_counter a2u7_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 7
and ! I_UnitDestroyed a2u8

    if I_UnitStatus a2u8 moving
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 1
    end_if
    if I_CompareCounter a2u8_status != 1
    set_counter a2u8_status 0
    end_if
    end_if

    if I_UnitStatus a2u8 routing
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 2
    end_if
    if I_CompareCounter a2u8_status != 2
    set_counter a2u8_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u8 moving
    and ! I_UnitStatus a2u8 routing
    set_counter a2u8_status 0
    end_if

    if I_CompareCounter a2u8_status > 0

    if I_UnitDistanceFromPosition a2u8 0,0 >= 150
    and I_UnitDistanceFromPosition a2u8 0,0 < 175
    if I_CompareCounter a2u8_distance != 1
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 1
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 175
    and I_UnitDistanceFromPosition a2u8 0,0 < 200
    if I_CompareCounter a2u8_distance != 2
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 2
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 200
    and I_UnitDistanceFromPosition a2u8 0,0 < 225
    if I_CompareCounter a2u8_distance != 3
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 3
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 225
    and I_UnitDistanceFromPosition a2u8 0,0 < 250
    if I_CompareCounter a2u8_distance != 4
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 4
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 250
    and I_UnitDistanceFromPosition a2u8 0,0 < 275
    if I_CompareCounter a2u8_distance != 5
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 5
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 275
    and I_UnitDistanceFromPosition a2u8 0,0 < 300
    if I_CompareCounter a2u8_distance != 6
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 6
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 300
    and I_UnitDistanceFromPosition a2u8 0,0 < 325
    if I_CompareCounter a2u8_distance != 7
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 7
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 325
    and I_UnitDistanceFromPosition a2u8 0,0 < 350
    if I_CompareCounter a2u8_distance != 8
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 8
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 350
    and I_UnitDistanceFromPosition a2u8 0,0 < 375
    if I_CompareCounter a2u8_distance != 9
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 9
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 375
    and I_UnitDistanceFromPosition a2u8 0,0 < 400
    if I_CompareCounter a2u8_distance != 10
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 10
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 400
    and I_UnitDistanceFromPosition a2u8 0,0 < 425
    if I_CompareCounter a2u8_distance != 11
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 11
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 425
    and I_UnitDistanceFromPosition a2u8 0,0 < 450
    if I_CompareCounter a2u8_distance != 12
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 12
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 450
    and I_UnitDistanceFromPosition a2u8 0,0 < 500
    if I_CompareCounter a2u8_distance != 13
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 13
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 500
    and I_UnitDistanceFromPosition a2u8 0,0 < 550
    if I_CompareCounter a2u8_distance != 14
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 14
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 550
    and I_UnitDistanceFromPosition a2u8 0,0 < 600
    if I_CompareCounter a2u8_distance != 15
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 15
    inc_counter a2u8_stuck 1
    end_if

    if I_CompareCounter a2u8_stuck = 4
    unit_order_halt a2u8
    unit_set_morale a2u8 wavering
    battle_wait 0.1
    unit_unset_morale a2u8
    release_unit a2u8
    set_counter a2u8_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 8
and ! I_UnitDestroyed a2u9

    if I_UnitStatus a2u9 moving
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 1
    end_if
    if I_CompareCounter a2u9_status != 1
    set_counter a2u9_status 0
    end_if
    end_if

    if I_UnitStatus a2u9 routing
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 2
    end_if
    if I_CompareCounter a2u9_status != 2
    set_counter a2u9_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u9 moving
    and ! I_UnitStatus a2u9 routing
    set_counter a2u9_status 0
    end_if

    if I_CompareCounter a2u9_status > 0

    if I_UnitDistanceFromPosition a2u9 0,0 >= 150
    and I_UnitDistanceFromPosition a2u9 0,0 < 175
    if I_CompareCounter a2u9_distance != 1
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 1
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 175
    and I_UnitDistanceFromPosition a2u9 0,0 < 200
    if I_CompareCounter a2u9_distance != 2
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 2
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 200
    and I_UnitDistanceFromPosition a2u9 0,0 < 225
    if I_CompareCounter a2u9_distance != 3
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 3
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 225
    and I_UnitDistanceFromPosition a2u9 0,0 < 250
    if I_CompareCounter a2u9_distance != 4
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 4
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 250
    and I_UnitDistanceFromPosition a2u9 0,0 < 275
    if I_CompareCounter a2u9_distance != 5
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 5
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 275
    and I_UnitDistanceFromPosition a2u9 0,0 < 300
    if I_CompareCounter a2u9_distance != 6
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 6
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 300
    and I_UnitDistanceFromPosition a2u9 0,0 < 325
    if I_CompareCounter a2u9_distance != 7
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 7
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 325
    and I_UnitDistanceFromPosition a2u9 0,0 < 350
    if I_CompareCounter a2u9_distance != 8
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 8
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 350
    and I_UnitDistanceFromPosition a2u9 0,0 < 375
    if I_CompareCounter a2u9_distance != 9
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 9
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 375
    and I_UnitDistanceFromPosition a2u9 0,0 < 400
    if I_CompareCounter a2u9_distance != 10
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 10
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 400
    and I_UnitDistanceFromPosition a2u9 0,0 < 425
    if I_CompareCounter a2u9_distance != 11
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 11
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 425
    and I_UnitDistanceFromPosition a2u9 0,0 < 450
    if I_CompareCounter a2u9_distance != 12
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 12
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 450
    and I_UnitDistanceFromPosition a2u9 0,0 < 500
    if I_CompareCounter a2u9_distance != 13
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 13
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 500
    and I_UnitDistanceFromPosition a2u9 0,0 < 550
    if I_CompareCounter a2u9_distance != 14
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 14
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 550
    and I_UnitDistanceFromPosition a2u9 0,0 < 600
    if I_CompareCounter a2u9_distance != 15
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 15
    inc_counter a2u9_stuck 1
    end_if

    if I_CompareCounter a2u9_stuck = 4
    unit_order_halt a2u9
    unit_set_morale a2u9 wavering
    battle_wait 0.1
    unit_unset_morale a2u9
    release_unit a2u9
    set_counter a2u9_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 9
and ! I_UnitDestroyed a2u10

    if I_UnitStatus a2u10 moving
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 1
    end_if
    if I_CompareCounter a2u10_status != 1
    set_counter a2u10_status 0
    end_if
    end_if

    if I_UnitStatus a2u10 routing
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 2
    end_if
    if I_CompareCounter a2u10_status != 2
    set_counter a2u10_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u10 moving
    and ! I_UnitStatus a2u10 routing
    set_counter a2u10_status 0
    end_if

    if I_CompareCounter a2u10_status > 0

    if I_UnitDistanceFromPosition a2u10 0,0 >= 150
    and I_UnitDistanceFromPosition a2u10 0,0 < 175
    if I_CompareCounter a2u10_distance != 1
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 1
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 175
    and I_UnitDistanceFromPosition a2u10 0,0 < 200
    if I_CompareCounter a2u10_distance != 2
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 2
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 200
    and I_UnitDistanceFromPosition a2u10 0,0 < 225
    if I_CompareCounter a2u10_distance != 3
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 3
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 225
    and I_UnitDistanceFromPosition a2u10 0,0 < 250
    if I_CompareCounter a2u10_distance != 4
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 4
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 250
    and I_UnitDistanceFromPosition a2u10 0,0 < 275
    if I_CompareCounter a2u10_distance != 5
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 5
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 275
    and I_UnitDistanceFromPosition a2u10 0,0 < 300
    if I_CompareCounter a2u10_distance != 6
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 6
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 300
    and I_UnitDistanceFromPosition a2u10 0,0 < 325
    if I_CompareCounter a2u10_distance != 7
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 7
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 325
    and I_UnitDistanceFromPosition a2u10 0,0 < 350
    if I_CompareCounter a2u10_distance != 8
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 8
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 350
    and I_UnitDistanceFromPosition a2u10 0,0 < 375
    if I_CompareCounter a2u10_distance != 9
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 9
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 375
    and I_UnitDistanceFromPosition a2u10 0,0 < 400
    if I_CompareCounter a2u10_distance != 10
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 10
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 400
    and I_UnitDistanceFromPosition a2u10 0,0 < 425
    if I_CompareCounter a2u10_distance != 11
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 11
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 425
    and I_UnitDistanceFromPosition a2u10 0,0 < 450
    if I_CompareCounter a2u10_distance != 12
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 12
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 450
    and I_UnitDistanceFromPosition a2u10 0,0 < 500
    if I_CompareCounter a2u10_distance != 13
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 13
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 500
    and I_UnitDistanceFromPosition a2u10 0,0 < 550
    if I_CompareCounter a2u10_distance != 14
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 14
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 550
    and I_UnitDistanceFromPosition a2u10 0,0 < 600
    if I_CompareCounter a2u10_distance != 15
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 15
    inc_counter a2u10_stuck 1
    end_if

    if I_CompareCounter a2u10_stuck = 4
    unit_order_halt a2u10
    unit_set_morale a2u10 wavering
    battle_wait 0.1
    unit_unset_morale a2u10
    release_unit a2u10
    set_counter a2u10_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 10
and ! I_UnitDestroyed a2u11

    if I_UnitStatus a2u11 moving
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 1
    end_if
    if I_CompareCounter a2u11_status != 1
    set_counter a2u11_status 0
    end_if
    end_if

    if I_UnitStatus a2u11 routing
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 2
    end_if
    if I_CompareCounter a2u11_status != 2
    set_counter a2u11_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u11 moving
    and ! I_UnitStatus a2u11 routing
    set_counter a2u11_status 0
    end_if

    if I_CompareCounter a2u11_status > 0

    if I_UnitDistanceFromPosition a2u11 0,0 >= 150
    and I_UnitDistanceFromPosition a2u11 0,0 < 175
    if I_CompareCounter a2u11_distance != 1
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 1
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 175
    and I_UnitDistanceFromPosition a2u11 0,0 < 200
    if I_CompareCounter a2u11_distance != 2
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 2
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 200
    and I_UnitDistanceFromPosition a2u11 0,0 < 225
    if I_CompareCounter a2u11_distance != 3
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 3
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 225
    and I_UnitDistanceFromPosition a2u11 0,0 < 250
    if I_CompareCounter a2u11_distance != 4
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 4
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 250
    and I_UnitDistanceFromPosition a2u11 0,0 < 275
    if I_CompareCounter a2u11_distance != 5
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 5
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 275
    and I_UnitDistanceFromPosition a2u11 0,0 < 300
    if I_CompareCounter a2u11_distance != 6
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 6
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 300
    and I_UnitDistanceFromPosition a2u11 0,0 < 325
    if I_CompareCounter a2u11_distance != 7
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 7
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 325
    and I_UnitDistanceFromPosition a2u11 0,0 < 350
    if I_CompareCounter a2u11_distance != 8
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 8
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 350
    and I_UnitDistanceFromPosition a2u11 0,0 < 375
    if I_CompareCounter a2u11_distance != 9
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 9
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 375
    and I_UnitDistanceFromPosition a2u11 0,0 < 400
    if I_CompareCounter a2u11_distance != 10
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 10
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 400
    and I_UnitDistanceFromPosition a2u11 0,0 < 425
    if I_CompareCounter a2u11_distance != 11
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 11
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 425
    and I_UnitDistanceFromPosition a2u11 0,0 < 450
    if I_CompareCounter a2u11_distance != 12
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 12
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 450
    and I_UnitDistanceFromPosition a2u11 0,0 < 500
    if I_CompareCounter a2u11_distance != 13
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 13
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 500
    and I_UnitDistanceFromPosition a2u11 0,0 < 550
    if I_CompareCounter a2u11_distance != 14
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 14
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 550
    and I_UnitDistanceFromPosition a2u11 0,0 < 600
    if I_CompareCounter a2u11_distance != 15
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 15
    inc_counter a2u11_stuck 1
    end_if

    if I_CompareCounter a2u11_stuck = 4
    unit_order_halt a2u11
    unit_set_morale a2u11 wavering
    battle_wait 0.1
    unit_unset_morale a2u11
    release_unit a2u11
    set_counter a2u11_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 11
and ! I_UnitDestroyed a2u12

    if I_UnitStatus a2u12 moving
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 1
    end_if
    if I_CompareCounter a2u12_status != 1
    set_counter a2u12_status 0
    end_if
    end_if

    if I_UnitStatus a2u12 routing
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 2
    end_if
    if I_CompareCounter a2u12_status != 2
    set_counter a2u12_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u12 moving
    and ! I_UnitStatus a2u12 routing
    set_counter a2u12_status 0
    end_if

    if I_CompareCounter a2u12_status > 0

    if I_UnitDistanceFromPosition a2u12 0,0 >= 150
    and I_UnitDistanceFromPosition a2u12 0,0 < 175
    if I_CompareCounter a2u12_distance != 1
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 1
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 175
    and I_UnitDistanceFromPosition a2u12 0,0 < 200
    if I_CompareCounter a2u12_distance != 2
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 2
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 200
    and I_UnitDistanceFromPosition a2u12 0,0 < 225
    if I_CompareCounter a2u12_distance != 3
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 3
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 225
    and I_UnitDistanceFromPosition a2u12 0,0 < 250
    if I_CompareCounter a2u12_distance != 4
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 4
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 250
    and I_UnitDistanceFromPosition a2u12 0,0 < 275
    if I_CompareCounter a2u12_distance != 5
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 5
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 275
    and I_UnitDistanceFromPosition a2u12 0,0 < 300
    if I_CompareCounter a2u12_distance != 6
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 6
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 300
    and I_UnitDistanceFromPosition a2u12 0,0 < 325
    if I_CompareCounter a2u12_distance != 7
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 7
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 325
    and I_UnitDistanceFromPosition a2u12 0,0 < 350
    if I_CompareCounter a2u12_distance != 8
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 8
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 350
    and I_UnitDistanceFromPosition a2u12 0,0 < 375
    if I_CompareCounter a2u12_distance != 9
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 9
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 375
    and I_UnitDistanceFromPosition a2u12 0,0 < 400
    if I_CompareCounter a2u12_distance != 10
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 10
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 400
    and I_UnitDistanceFromPosition a2u12 0,0 < 425
    if I_CompareCounter a2u12_distance != 11
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 11
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 425
    and I_UnitDistanceFromPosition a2u12 0,0 < 450
    if I_CompareCounter a2u12_distance != 12
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 12
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 450
    and I_UnitDistanceFromPosition a2u12 0,0 < 500
    if I_CompareCounter a2u12_distance != 13
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 13
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 500
    and I_UnitDistanceFromPosition a2u12 0,0 < 550
    if I_CompareCounter a2u12_distance != 14
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 14
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 550
    and I_UnitDistanceFromPosition a2u12 0,0 < 600
    if I_CompareCounter a2u12_distance != 15
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 15
    inc_counter a2u12_stuck 1
    end_if

    if I_CompareCounter a2u12_stuck = 4
    unit_order_halt a2u12
    unit_set_morale a2u12 wavering
    battle_wait 0.1
    unit_unset_morale a2u12
    release_unit a2u12
    set_counter a2u12_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 12
and ! I_UnitDestroyed a2u13

    if I_UnitStatus a2u13 moving
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 1
    end_if
    if I_CompareCounter a2u13_status != 1
    set_counter a2u13_status 0
    end_if
    end_if

    if I_UnitStatus a2u13 routing
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 2
    end_if
    if I_CompareCounter a2u13_status != 2
    set_counter a2u13_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u13 moving
    and ! I_UnitStatus a2u13 routing
    set_counter a2u13_status 0
    end_if

    if I_CompareCounter a2u13_status > 0

    if I_UnitDistanceFromPosition a2u13 0,0 >= 150
    and I_UnitDistanceFromPosition a2u13 0,0 < 175
    if I_CompareCounter a2u13_distance != 1
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 1
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 175
    and I_UnitDistanceFromPosition a2u13 0,0 < 200
    if I_CompareCounter a2u13_distance != 2
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 2
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 200
    and I_UnitDistanceFromPosition a2u13 0,0 < 225
    if I_CompareCounter a2u13_distance != 3
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 3
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 225
    and I_UnitDistanceFromPosition a2u13 0,0 < 250
    if I_CompareCounter a2u13_distance != 4
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 4
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 250
    and I_UnitDistanceFromPosition a2u13 0,0 < 275
    if I_CompareCounter a2u13_distance != 5
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 5
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 275
    and I_UnitDistanceFromPosition a2u13 0,0 < 300
    if I_CompareCounter a2u13_distance != 6
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 6
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 300
    and I_UnitDistanceFromPosition a2u13 0,0 < 325
    if I_CompareCounter a2u13_distance != 7
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 7
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 325
    and I_UnitDistanceFromPosition a2u13 0,0 < 350
    if I_CompareCounter a2u13_distance != 8
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 8
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 350
    and I_UnitDistanceFromPosition a2u13 0,0 < 375
    if I_CompareCounter a2u13_distance != 9
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 9
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 375
    and I_UnitDistanceFromPosition a2u13 0,0 < 400
    if I_CompareCounter a2u13_distance != 10
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 10
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 400
    and I_UnitDistanceFromPosition a2u13 0,0 < 425
    if I_CompareCounter a2u13_distance != 11
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 11
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 425
    and I_UnitDistanceFromPosition a2u13 0,0 < 450
    if I_CompareCounter a2u13_distance != 12
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 12
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 450
    and I_UnitDistanceFromPosition a2u13 0,0 < 500
    if I_CompareCounter a2u13_distance != 13
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 13
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 500
    and I_UnitDistanceFromPosition a2u13 0,0 < 550
    if I_CompareCounter a2u13_distance != 14
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 14
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 550
    and I_UnitDistanceFromPosition a2u13 0,0 < 600
    if I_CompareCounter a2u13_distance != 15
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 15
    inc_counter a2u13_stuck 1
    end_if

    if I_CompareCounter a2u13_stuck = 4
    unit_order_halt a2u13
    unit_set_morale a2u13 wavering
    battle_wait 0.1
    unit_unset_morale a2u13
    release_unit a2u13
    set_counter a2u13_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 13
and ! I_UnitDestroyed a2u14

    if I_UnitStatus a2u14 moving
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 1
    end_if
    if I_CompareCounter a2u14_status != 1
    set_counter a2u14_status 0
    end_if
    end_if

    if I_UnitStatus a2u14 routing
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 2
    end_if
    if I_CompareCounter a2u14_status != 2
    set_counter a2u14_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u14 moving
    and ! I_UnitStatus a2u14 routing
    set_counter a2u14_status 0
    end_if

    if I_CompareCounter a2u14_status > 0

    if I_UnitDistanceFromPosition a2u14 0,0 >= 150
    and I_UnitDistanceFromPosition a2u14 0,0 < 175
    if I_CompareCounter a2u14_distance != 1
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 1
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 175
    and I_UnitDistanceFromPosition a2u14 0,0 < 200
    if I_CompareCounter a2u14_distance != 2
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 2
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 200
    and I_UnitDistanceFromPosition a2u14 0,0 < 225
    if I_CompareCounter a2u14_distance != 3
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 3
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 225
    and I_UnitDistanceFromPosition a2u14 0,0 < 250
    if I_CompareCounter a2u14_distance != 4
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 4
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 250
    and I_UnitDistanceFromPosition a2u14 0,0 < 275
    if I_CompareCounter a2u14_distance != 5
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 5
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 275
    and I_UnitDistanceFromPosition a2u14 0,0 < 300
    if I_CompareCounter a2u14_distance != 6
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 6
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 300
    and I_UnitDistanceFromPosition a2u14 0,0 < 325
    if I_CompareCounter a2u14_distance != 7
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 7
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 325
    and I_UnitDistanceFromPosition a2u14 0,0 < 350
    if I_CompareCounter a2u14_distance != 8
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 8
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 350
    and I_UnitDistanceFromPosition a2u14 0,0 < 375
    if I_CompareCounter a2u14_distance != 9
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 9
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 375
    and I_UnitDistanceFromPosition a2u14 0,0 < 400
    if I_CompareCounter a2u14_distance != 10
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 10
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 400
    and I_UnitDistanceFromPosition a2u14 0,0 < 425
    if I_CompareCounter a2u14_distance != 11
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 11
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 425
    and I_UnitDistanceFromPosition a2u14 0,0 < 450
    if I_CompareCounter a2u14_distance != 12
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 12
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 450
    and I_UnitDistanceFromPosition a2u14 0,0 < 500
    if I_CompareCounter a2u14_distance != 13
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 13
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 500
    and I_UnitDistanceFromPosition a2u14 0,0 < 550
    if I_CompareCounter a2u14_distance != 14
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 14
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 550
    and I_UnitDistanceFromPosition a2u14 0,0 < 600
    if I_CompareCounter a2u14_distance != 15
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 15
    inc_counter a2u14_stuck 1
    end_if

    if I_CompareCounter a2u14_stuck = 4
    unit_order_halt a2u14
    unit_set_morale a2u14 wavering
    battle_wait 0.1
    unit_unset_morale a2u14
    release_unit a2u14
    set_counter a2u14_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 14
and ! I_UnitDestroyed a2u15

    if I_UnitStatus a2u15 moving
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 1
    end_if
    if I_CompareCounter a2u15_status != 1
    set_counter a2u15_status 0
    end_if
    end_if

    if I_UnitStatus a2u15 routing
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 2
    end_if
    if I_CompareCounter a2u15_status != 2
    set_counter a2u15_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u15 moving
    and ! I_UnitStatus a2u15 routing
    set_counter a2u15_status 0
    end_if

    if I_CompareCounter a2u15_status > 0

    if I_UnitDistanceFromPosition a2u15 0,0 >= 150
    and I_UnitDistanceFromPosition a2u15 0,0 < 175
    if I_CompareCounter a2u15_distance != 1
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 1
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 175
    and I_UnitDistanceFromPosition a2u15 0,0 < 200
    if I_CompareCounter a2u15_distance != 2
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 2
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 200
    and I_UnitDistanceFromPosition a2u15 0,0 < 225
    if I_CompareCounter a2u15_distance != 3
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 3
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 225
    and I_UnitDistanceFromPosition a2u15 0,0 < 250
    if I_CompareCounter a2u15_distance != 4
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 4
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 250
    and I_UnitDistanceFromPosition a2u15 0,0 < 275
    if I_CompareCounter a2u15_distance != 5
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 5
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 275
    and I_UnitDistanceFromPosition a2u15 0,0 < 300
    if I_CompareCounter a2u15_distance != 6
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 6
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 300
    and I_UnitDistanceFromPosition a2u15 0,0 < 325
    if I_CompareCounter a2u15_distance != 7
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 7
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 325
    and I_UnitDistanceFromPosition a2u15 0,0 < 350
    if I_CompareCounter a2u15_distance != 8
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 8
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 350
    and I_UnitDistanceFromPosition a2u15 0,0 < 375
    if I_CompareCounter a2u15_distance != 9
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 9
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 375
    and I_UnitDistanceFromPosition a2u15 0,0 < 400
    if I_CompareCounter a2u15_distance != 10
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 10
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 400
    and I_UnitDistanceFromPosition a2u15 0,0 < 425
    if I_CompareCounter a2u15_distance != 11
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 11
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 425
    and I_UnitDistanceFromPosition a2u15 0,0 < 450
    if I_CompareCounter a2u15_distance != 12
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 12
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 450
    and I_UnitDistanceFromPosition a2u15 0,0 < 500
    if I_CompareCounter a2u15_distance != 13
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 13
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 500
    and I_UnitDistanceFromPosition a2u15 0,0 < 550
    if I_CompareCounter a2u15_distance != 14
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 14
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 550
    and I_UnitDistanceFromPosition a2u15 0,0 < 600
    if I_CompareCounter a2u15_distance != 15
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 15
    inc_counter a2u15_stuck 1
    end_if

    if I_CompareCounter a2u15_stuck = 4
    unit_order_halt a2u15
    unit_set_morale a2u15 wavering
    battle_wait 0.1
    unit_unset_morale a2u15
    release_unit a2u15
    set_counter a2u15_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 15
and ! I_UnitDestroyed a2u16

    if I_UnitStatus a2u16 moving
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 1
    end_if
    if I_CompareCounter a2u16_status != 1
    set_counter a2u16_status 0
    end_if
    end_if

    if I_UnitStatus a2u16 routing
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 2
    end_if
    if I_CompareCounter a2u16_status != 2
    set_counter a2u16_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u16 moving
    and ! I_UnitStatus a2u16 routing
    set_counter a2u16_status 0
    end_if

    if I_CompareCounter a2u16_status > 0

    if I_UnitDistanceFromPosition a2u16 0,0 >= 150
    and I_UnitDistanceFromPosition a2u16 0,0 < 175
    if I_CompareCounter a2u16_distance != 1
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 1
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 175
    and I_UnitDistanceFromPosition a2u16 0,0 < 200
    if I_CompareCounter a2u16_distance != 2
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 2
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 200
    and I_UnitDistanceFromPosition a2u16 0,0 < 225
    if I_CompareCounter a2u16_distance != 3
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 3
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 225
    and I_UnitDistanceFromPosition a2u16 0,0 < 250
    if I_CompareCounter a2u16_distance != 4
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 4
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 250
    and I_UnitDistanceFromPosition a2u16 0,0 < 275
    if I_CompareCounter a2u16_distance != 5
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 5
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 275
    and I_UnitDistanceFromPosition a2u16 0,0 < 300
    if I_CompareCounter a2u16_distance != 6
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 6
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 300
    and I_UnitDistanceFromPosition a2u16 0,0 < 325
    if I_CompareCounter a2u16_distance != 7
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 7
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 325
    and I_UnitDistanceFromPosition a2u16 0,0 < 350
    if I_CompareCounter a2u16_distance != 8
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 8
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 350
    and I_UnitDistanceFromPosition a2u16 0,0 < 375
    if I_CompareCounter a2u16_distance != 9
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 9
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 375
    and I_UnitDistanceFromPosition a2u16 0,0 < 400
    if I_CompareCounter a2u16_distance != 10
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 10
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 400
    and I_UnitDistanceFromPosition a2u16 0,0 < 425
    if I_CompareCounter a2u16_distance != 11
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 11
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 425
    and I_UnitDistanceFromPosition a2u16 0,0 < 450
    if I_CompareCounter a2u16_distance != 12
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 12
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 450
    and I_UnitDistanceFromPosition a2u16 0,0 < 500
    if I_CompareCounter a2u16_distance != 13
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 13
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 500
    and I_UnitDistanceFromPosition a2u16 0,0 < 550
    if I_CompareCounter a2u16_distance != 14
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 14
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 550
    and I_UnitDistanceFromPosition a2u16 0,0 < 600
    if I_CompareCounter a2u16_distance != 15
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 15
    inc_counter a2u16_stuck 1
    end_if

    if I_CompareCounter a2u16_stuck = 4
    unit_order_halt a2u16
    unit_set_morale a2u16 wavering
    battle_wait 0.1
    unit_unset_morale a2u16
    release_unit a2u16
    set_counter a2u16_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 16
and ! I_UnitDestroyed a2u17

    if I_UnitStatus a2u17 moving
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 1
    end_if
    if I_CompareCounter a2u17_status != 1
    set_counter a2u17_status 0
    end_if
    end_if

    if I_UnitStatus a2u17 routing
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 2
    end_if
    if I_CompareCounter a2u17_status != 2
    set_counter a2u17_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u17 moving
    and ! I_UnitStatus a2u17 routing
    set_counter a2u17_status 0
    end_if

    if I_CompareCounter a2u17_status > 0

    if I_UnitDistanceFromPosition a2u17 0,0 >= 150
    and I_UnitDistanceFromPosition a2u17 0,0 < 175
    if I_CompareCounter a2u17_distance != 1
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 1
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 175
    and I_UnitDistanceFromPosition a2u17 0,0 < 200
    if I_CompareCounter a2u17_distance != 2
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 2
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 200
    and I_UnitDistanceFromPosition a2u17 0,0 < 225
    if I_CompareCounter a2u17_distance != 3
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 3
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 225
    and I_UnitDistanceFromPosition a2u17 0,0 < 250
    if I_CompareCounter a2u17_distance != 4
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 4
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 250
    and I_UnitDistanceFromPosition a2u17 0,0 < 275
    if I_CompareCounter a2u17_distance != 5
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 5
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 275
    and I_UnitDistanceFromPosition a2u17 0,0 < 300
    if I_CompareCounter a2u17_distance != 6
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 6
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 300
    and I_UnitDistanceFromPosition a2u17 0,0 < 325
    if I_CompareCounter a2u17_distance != 7
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 7
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 325
    and I_UnitDistanceFromPosition a2u17 0,0 < 350
    if I_CompareCounter a2u17_distance != 8
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 8
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 350
    and I_UnitDistanceFromPosition a2u17 0,0 < 375
    if I_CompareCounter a2u17_distance != 9
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 9
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 375
    and I_UnitDistanceFromPosition a2u17 0,0 < 400
    if I_CompareCounter a2u17_distance != 10
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 10
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 400
    and I_UnitDistanceFromPosition a2u17 0,0 < 425
    if I_CompareCounter a2u17_distance != 11
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 11
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 425
    and I_UnitDistanceFromPosition a2u17 0,0 < 450
    if I_CompareCounter a2u17_distance != 12
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 12
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 450
    and I_UnitDistanceFromPosition a2u17 0,0 < 500
    if I_CompareCounter a2u17_distance != 13
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 13
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 500
    and I_UnitDistanceFromPosition a2u17 0,0 < 550
    if I_CompareCounter a2u17_distance != 14
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 14
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 550
    and I_UnitDistanceFromPosition a2u17 0,0 < 600
    if I_CompareCounter a2u17_distance != 15
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 15
    inc_counter a2u17_stuck 1
    end_if

    if I_CompareCounter a2u17_stuck = 4
    unit_order_halt a2u17
    unit_set_morale a2u17 wavering
    battle_wait 0.1
    unit_unset_morale a2u17
    release_unit a2u17
    set_counter a2u17_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 17
and ! I_UnitDestroyed a2u18

    if I_UnitStatus a2u18 moving
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 1
    end_if
    if I_CompareCounter a2u18_status != 1
    set_counter a2u18_status 0
    end_if
    end_if

    if I_UnitStatus a2u18 routing
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 2
    end_if
    if I_CompareCounter a2u18_status != 2
    set_counter a2u18_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u18 moving
    and ! I_UnitStatus a2u18 routing
    set_counter a2u18_status 0
    end_if

    if I_CompareCounter a2u18_status > 0

    if I_UnitDistanceFromPosition a2u18 0,0 >= 150
    and I_UnitDistanceFromPosition a2u18 0,0 < 175
    if I_CompareCounter a2u18_distance != 1
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 1
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 175
    and I_UnitDistanceFromPosition a2u18 0,0 < 200
    if I_CompareCounter a2u18_distance != 2
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 2
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 200
    and I_UnitDistanceFromPosition a2u18 0,0 < 225
    if I_CompareCounter a2u18_distance != 3
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 3
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 225
    and I_UnitDistanceFromPosition a2u18 0,0 < 250
    if I_CompareCounter a2u18_distance != 4
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 4
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 250
    and I_UnitDistanceFromPosition a2u18 0,0 < 275
    if I_CompareCounter a2u18_distance != 5
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 5
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 275
    and I_UnitDistanceFromPosition a2u18 0,0 < 300
    if I_CompareCounter a2u18_distance != 6
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 6
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 300
    and I_UnitDistanceFromPosition a2u18 0,0 < 325
    if I_CompareCounter a2u18_distance != 7
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 7
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 325
    and I_UnitDistanceFromPosition a2u18 0,0 < 350
    if I_CompareCounter a2u18_distance != 8
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 8
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 350
    and I_UnitDistanceFromPosition a2u18 0,0 < 375
    if I_CompareCounter a2u18_distance != 9
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 9
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 375
    and I_UnitDistanceFromPosition a2u18 0,0 < 400
    if I_CompareCounter a2u18_distance != 10
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 10
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 400
    and I_UnitDistanceFromPosition a2u18 0,0 < 425
    if I_CompareCounter a2u18_distance != 11
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 11
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 425
    and I_UnitDistanceFromPosition a2u18 0,0 < 450
    if I_CompareCounter a2u18_distance != 12
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 12
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 450
    and I_UnitDistanceFromPosition a2u18 0,0 < 500
    if I_CompareCounter a2u18_distance != 13
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 13
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 500
    and I_UnitDistanceFromPosition a2u18 0,0 < 550
    if I_CompareCounter a2u18_distance != 14
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 14
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 550
    and I_UnitDistanceFromPosition a2u18 0,0 < 600
    if I_CompareCounter a2u18_distance != 15
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 15
    inc_counter a2u18_stuck 1
    end_if

    if I_CompareCounter a2u18_stuck = 4
    unit_order_halt a2u18
    unit_set_morale a2u18 wavering
    battle_wait 0.1
    unit_unset_morale a2u18
    release_unit a2u18
    set_counter a2u18_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 18
and ! I_UnitDestroyed a2u19

    if I_UnitStatus a2u19 moving
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 1
    end_if
    if I_CompareCounter a2u19_status != 1
    set_counter a2u19_status 0
    end_if
    end_if

    if I_UnitStatus a2u19 routing
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 2
    end_if
    if I_CompareCounter a2u19_status != 2
    set_counter a2u19_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u19 moving
    and ! I_UnitStatus a2u19 routing
    set_counter a2u19_status 0
    end_if

    if I_CompareCounter a2u19_status > 0

    if I_UnitDistanceFromPosition a2u19 0,0 >= 150
    and I_UnitDistanceFromPosition a2u19 0,0 < 175
    if I_CompareCounter a2u19_distance != 1
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 1
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 175
    and I_UnitDistanceFromPosition a2u19 0,0 < 200
    if I_CompareCounter a2u19_distance != 2
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 2
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 200
    and I_UnitDistanceFromPosition a2u19 0,0 < 225
    if I_CompareCounter a2u19_distance != 3
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 3
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 225
    and I_UnitDistanceFromPosition a2u19 0,0 < 250
    if I_CompareCounter a2u19_distance != 4
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 4
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 250
    and I_UnitDistanceFromPosition a2u19 0,0 < 275
    if I_CompareCounter a2u19_distance != 5
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 5
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 275
    and I_UnitDistanceFromPosition a2u19 0,0 < 300
    if I_CompareCounter a2u19_distance != 6
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 6
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 300
    and I_UnitDistanceFromPosition a2u19 0,0 < 325
    if I_CompareCounter a2u19_distance != 7
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 7
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 325
    and I_UnitDistanceFromPosition a2u19 0,0 < 350
    if I_CompareCounter a2u19_distance != 8
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 8
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 350
    and I_UnitDistanceFromPosition a2u19 0,0 < 375
    if I_CompareCounter a2u19_distance != 9
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 9
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 375
    and I_UnitDistanceFromPosition a2u19 0,0 < 400
    if I_CompareCounter a2u19_distance != 10
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 10
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 400
    and I_UnitDistanceFromPosition a2u19 0,0 < 425
    if I_CompareCounter a2u19_distance != 11
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 11
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 425
    and I_UnitDistanceFromPosition a2u19 0,0 < 450
    if I_CompareCounter a2u19_distance != 12
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 12
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 450
    and I_UnitDistanceFromPosition a2u19 0,0 < 500
    if I_CompareCounter a2u19_distance != 13
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 13
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 500
    and I_UnitDistanceFromPosition a2u19 0,0 < 550
    if I_CompareCounter a2u19_distance != 14
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 14
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 550
    and I_UnitDistanceFromPosition a2u19 0,0 < 600
    if I_CompareCounter a2u19_distance != 15
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 15
    inc_counter a2u19_stuck 1
    end_if

    if I_CompareCounter a2u19_stuck = 4
    unit_order_halt a2u19
    unit_set_morale a2u19 wavering
    battle_wait 0.1
    unit_unset_morale a2u19
    release_unit a2u19
    set_counter a2u19_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count = 20
and ! I_UnitDestroyed a2u20

    if I_UnitStatus a2u20 moving
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 1
    end_if
    if I_CompareCounter a2u20_status != 1
    set_counter a2u20_status 0
    end_if
    end_if

    if I_UnitStatus a2u20 routing
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 2
    end_if
    if I_CompareCounter a2u20_status != 2
    set_counter a2u20_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u20 moving
    and ! I_UnitStatus a2u20 routing
    set_counter a2u20_status 0
    end_if

    if I_CompareCounter a2u20_status > 0

    if I_UnitDistanceFromPosition a2u20 0,0 >= 150
    and I_UnitDistanceFromPosition a2u20 0,0 < 175
    if I_CompareCounter a2u20_distance != 1
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 1
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 175
    and I_UnitDistanceFromPosition a2u20 0,0 < 200
    if I_CompareCounter a2u20_distance != 2
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 2
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 200
    and I_UnitDistanceFromPosition a2u20 0,0 < 225
    if I_CompareCounter a2u20_distance != 3
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 3
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 225
    and I_UnitDistanceFromPosition a2u20 0,0 < 250
    if I_CompareCounter a2u20_distance != 4
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 4
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 250
    and I_UnitDistanceFromPosition a2u20 0,0 < 275
    if I_CompareCounter a2u20_distance != 5
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 5
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 275
    and I_UnitDistanceFromPosition a2u20 0,0 < 300
    if I_CompareCounter a2u20_distance != 6
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 6
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 300
    and I_UnitDistanceFromPosition a2u20 0,0 < 325
    if I_CompareCounter a2u20_distance != 7
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 7
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 325
    and I_UnitDistanceFromPosition a2u20 0,0 < 350
    if I_CompareCounter a2u20_distance != 8
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 8
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 350
    and I_UnitDistanceFromPosition a2u20 0,0 < 375
    if I_CompareCounter a2u20_distance != 9
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 9
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 375
    and I_UnitDistanceFromPosition a2u20 0,0 < 400
    if I_CompareCounter a2u20_distance != 10
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 10
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 400
    and I_UnitDistanceFromPosition a2u20 0,0 < 425
    if I_CompareCounter a2u20_distance != 11
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 11
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 425
    and I_UnitDistanceFromPosition a2u20 0,0 < 450
    if I_CompareCounter a2u20_distance != 12
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 12
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 450
    and I_UnitDistanceFromPosition a2u20 0,0 < 500
    if I_CompareCounter a2u20_distance != 13
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 13
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 500
    and I_UnitDistanceFromPosition a2u20 0,0 < 550
    if I_CompareCounter a2u20_distance != 14
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 14
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 550
    and I_UnitDistanceFromPosition a2u20 0,0 < 600
    if I_CompareCounter a2u20_distance != 15
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 15
    inc_counter a2u20_stuck 1
    end_if

    if I_CompareCounter a2u20_stuck = 4
    unit_order_halt a2u20
    unit_set_morale a2u20 wavering
    battle_wait 0.1
    unit_unset_morale a2u20
    release_unit a2u20
    set_counter a2u20_stuck 0
    end_if

    end_if
end_if

    battle_wait 10
end_monitor

;;;;;;;Anti-CTD
monitor_event BattleDeploymentPhaseCommenced FactionIsLocal
    wait 0.5
    simulate_mouse_click lclick_down
    simulate_mouse_click lclick_up
end_monitor

;################## Cleaning up ##################

monitor_event ScrollOpened ScrollOpened post_battle_scroll

    ;;;;;;;
    set_counter fire_labels 0
;    set_counter panel_check 0
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
;    suspend_unscripted_advice false
end_monitor

;=======================================================;
;================= ADDITIONAL SCRIPTS ==================;
;=======================================================;

	wait_monitors

end_script